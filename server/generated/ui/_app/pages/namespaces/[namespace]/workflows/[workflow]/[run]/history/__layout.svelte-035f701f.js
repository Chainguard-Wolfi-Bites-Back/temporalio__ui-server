var ue=Object.defineProperty,me=Object.defineProperties;var de=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var X=(n,t,e)=>t in n?ue(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,D=(n,t)=>{for(var e in t||(t={}))Q.call(t,e)&&X(n,e,t[e]);if(L)for(var e of L(t))U.call(t,e)&&X(n,e,t[e]);return n},Y=(n,t)=>me(n,de(t));var Z=(n,t)=>{var e={};for(var s in n)Q.call(n,s)&&t.indexOf(s)<0&&(e[s]=n[s]);if(n!=null&&L)for(var s of L(n))t.indexOf(s)<0&&U.call(n,s)&&(e[s]=n[s]);return e};import{az as ge,aA as he,S as W,i as V,s as B,O as pe,e as S,j as I,c as R,a as q,m as j,d as w,b as $,T as P,f as J,o as b,V as _e,x as v,u as k,v as E,G as x,H as we,ab as ve,aB as ke,R as ye,J as A,L as ee,M as te,N as ne,y as se,t as $e,k as C,g as Ie,n as F,K as O,aC as je,aD as be,aE as Ee}from"../../../../../../../chunks/vendor-c7e306c1.js";import{r as N}from"../../../../../../../chunks/route-for-c019a53c.js";import{h as Oe,b as G,r as re,a as ae}from"../../../../../../../chunks/route-for-api-aecf4d21.js";import{s as K,d as Se,a as Re}from"../../../../../../../chunks/data-converter-config-50757fb2.js";import{r as qe}from"../../../../../../../chunks/refreshable-129fa738.js";import{p as Pe}from"../../../../../../../chunks/stores-78628462.js";import{a as oe}from"../../../../../../../chunks/append-query-parameters-b8619cc0.js";import"../../../../../../../chunks/notifications-939cb4a5.js";const ce=(n={},t={})=>{const e=D({},n);for(const s of Object.keys(t)){const a=e[s];Array.isArray(a)?e[s]=e[s].concat(t[s]):typeof a=="object"&&!Array.isArray(a)?e[s]=ce(e[s],t[s]):e[s]=t[s]}return e},z=async(n,{onStart:t,onUpdate:e,onComplete:s,onError:a=Oe,token:o,previousProps:c}={})=>{!c&&G(t)&&t();try{const r=await n(o),{nextPageToken:l}=r,p=Z(r,["nextPageToken"]),d=ce(c,p);return G(e)&&e(d,p),l?z(n,{onStart:t,onUpdate:e,onComplete:s,token:l,previousProps:d}):(G(s)&&s(d),d)}catch(f){a(f)}},Ne=(n,t)=>{if(!n)return{hasWebsocket:!1,websocket:null,closeSocket:function(){return null}};try{T=new he(`ws://localhost:${n}/`,D({packMessage:e=>JSON.stringify(e),unpackMessage:e=>JSON.parse(e),attachRequestId:(e,s)=>Object.assign({requestId:s},e),extractRequestId:e=>e&&e.requestId},t)),T.onError(()=>{console.log("oh snap")})}catch{K()}return T.open(),{hasWebsocket:!0,websocket:T,closeSocket:function(){return T.close()}}};let T=null;var fe;const De=(fe=ge(Se))!=null?fe:null,Je=Ne(De);async function Ce(n,t){if(!t.isOpened)try{await t.open()}catch{K()}return t.isOpened?t.sendRequest({payload:JSON.stringify(n)}).then(s=>{Re();try{return JSON.parse(s.content)}catch{return s.content}}).catch(()=>{K()}):Promise.resolve(n)}function H(n){const t=window.atob(String(n.metadata.encoding));switch(n.metadata.encodingDecoded=t,t){case"json/plain":case"json/protobuf":try{return JSON.parse(window.atob(String(n.data)))}catch{}}return n}const Fe=async(n,t)=>{var a,o,c,r,f,l,p,d,y,m,i,g;const e=n,s=(r=(c=(a=e==null?void 0:e.input)==null?void 0:a.payloads)!=null?c:(o=e==null?void 0:e.result)==null?void 0:o.payloads)!=null?r:null;if(s){let u;const h=t!=null?t:Je;(t==null?void 0:t.hasWebsocket)?u=await Promise.all((s!=null?s:[]).map(async ie=>await Ce(ie,h.websocket))):u=s.map(H),((f=e==null?void 0:e.input)==null?void 0:f.payloads)&&(e.input.payloads=u),((l=e==null?void 0:e.result)==null?void 0:l.payloads)&&(e.result.payloads=u)}if((p=e==null?void 0:e.searchAttributes)==null?void 0:p.indexedFields){const u=(d=e==null?void 0:e.searchAttributes)==null?void 0:d.indexedFields;Object.entries(u).forEach(([h,_])=>{u[h]=H(_)})}if((y=e==null?void 0:e.memo)==null?void 0:y.fields){const u=(m=e==null?void 0:e.memo)==null?void 0:m.fields;Object.entries(u).forEach(([h,_])=>{u[h]=H(_)})}if((i=e==null?void 0:e.header)==null?void 0:i.fields){const u=(g=e==null?void 0:e.header)==null?void 0:g.fields;Object.entries(u).forEach(([h,_])=>{u[h]=H(_)})}if(e==null?void 0:e.queryResult){const u=e==null?void 0:e.queryResult;Object.entries(u).forEach(([h,_])=>{u[h]=H(_)})}return e};async function Te(n){const t=Object.keys(n).find(s=>s.includes("Attributes")),e=await Fe(n[t]);return D({type:t},e)}const He=async n=>Promise.all(n.history.events.map(async t=>Y(D({},t),{id:String(t.eventId),eventType:t.eventType,attributes:await Te(t)}))),le=async({namespace:n,executionId:t,runId:e,onStart:s,onUpdate:a,onComplete:o},c=fetch)=>await z(async f=>re(ae("events",{namespace:n,executionId:t,runId:e}),{token:f,request:c}),{onStart:s,onUpdate:a,onComplete:o}).then(He),Le=async({namespace:n,executionId:t,runId:e,onStart:s,onUpdate:a,onComplete:o},c=fetch)=>(await z(async f=>re(ae("events",{namespace:n,executionId:t,runId:e}),{token:f,request:c}),{onStart:s,onUpdate:a,onComplete:o})).history.events;function We(n){let t,e,s,a,o,c;return e=new pe({props:{icon:n[0],scale:n[2]}}),{c(){t=S("a"),I(e.$$.fragment),this.h()},l(r){t=R(r,"A",{class:!0,href:!0});var f=q(t);j(e.$$.fragment,f),f.forEach(w),this.h()},h(){$(t,"class","border-2 py-2 px-4 hover:text-white hover:bg-gray-600 flex items-center justify-center svelte-1t4vnef"),$(t,"href",s=oe(n[3],n[4].query)),P(t,"rounded-lg",!n[1]),P(t,"active",n[4].path.includes(n[3])),P(t,"group",n[1])},m(r,f){J(r,t,f),b(e,t,null),a=!0,o||(c=_e(t,"click",n[5]),o=!0)},p(r,[f]){const l={};f&1&&(l.icon=r[0]),f&4&&(l.scale=r[2]),e.$set(l),(!a||f&24&&s!==(s=oe(r[3],r[4].query)))&&$(t,"href",s),f&2&&P(t,"rounded-lg",!r[1]),f&24&&P(t,"active",r[4].path.includes(r[3])),f&2&&P(t,"group",r[1])},i(r){a||(v(e.$$.fragment,r),a=!0)},o(r){k(e.$$.fragment,r),a=!1},d(r){r&&w(t),E(e),o=!1,c()}}}function Ve(n,t,e){let s;x(n,Pe,l=>e(4,s=l));let{icon:a}=t,{group:o=we("group")}=t,{scale:c=1}=t,{href:r="#"}=t;function f(l){ve.call(this,n,l)}return n.$$set=l=>{"icon"in l&&e(0,a=l.icon),"group"in l&&e(1,o=l.group),"scale"in l&&e(2,c=l.scale),"href"in l&&e(3,r=l.href)},[a,o,c,r,s,f]}class M extends W{constructor(t){super();V(this,t,Ve,We,B,{icon:0,group:1,scale:2,href:3})}}function Be(n){let t,e;return t=new M({props:{icon:ke}}),t.$on("click",n[0]),{c(){I(t.$$.fragment)},l(s){j(t.$$.fragment,s)},m(s,a){b(t,s,a),e=!0},p:ye,i(s){e||(v(t.$$.fragment,s),e=!0)},o(s){k(t.$$.fragment,s),e=!1},d(s){E(t,s)}}}function Me(n,t,e){const s=async()=>{const r=await Le({namespace:a,executionId:o,runId:c}),f=JSON.stringify(r,null,2);l(f,`${c}/events.json`,"text/plain");function l(p,d,y){const m=document.createElement("a"),i=new Blob([p],{type:y});m.href=URL.createObjectURL(i),m.download=d,m.click()}};let{namespace:a}=t,{workflowId:o}=t,{runId:c}=t;return n.$$set=r=>{"namespace"in r&&e(1,a=r.namespace),"workflowId"in r&&e(2,o=r.workflowId),"runId"in r&&e(3,c=r.runId)},[s,a,o,c]}class Ge extends W{constructor(t){super();V(this,t,Me,Be,B,{namespace:1,workflowId:2,runId:3})}}function Ke(n){let t,e;const s=n[1].default,a=A(s,n,n[0],null);return{c(){t=S("div"),a&&a.c(),this.h()},l(o){t=R(o,"DIV",{class:!0});var c=q(t);a&&a.l(c),c.forEach(w),this.h()},h(){$(t,"class","flex")},m(o,c){J(o,t,c),a&&a.m(t,null),e=!0},p(o,[c]){a&&a.p&&(!e||c&1)&&ee(a,s,o,o[0],e?ne(s,o[0],c,null):te(o[0]),null)},i(o){e||(v(a,o),e=!0)},o(o){k(a,o),e=!1},d(o){o&&w(t),a&&a.d(o)}}}function ze(n,t,e){let{$$slots:s={},$$scope:a}=t;return se("group",!0),n.$$set=o=>{"$$scope"in o&&e(0,a=o.$$scope)},[a,s]}class Qe extends W{constructor(t){super();V(this,t,ze,Ke,B,{})}}function Ue(n){let t,e,s,a,o,c;return t=new M({props:{icon:je,href:N("workflow.events.full",n[0])}}),s=new M({props:{icon:be,href:N("workflow.events.compact",n[0])}}),o=new M({props:{icon:Ee,href:N("workflow.events.json",n[0])}}),{c(){I(t.$$.fragment),e=C(),I(s.$$.fragment),a=C(),I(o.$$.fragment)},l(r){j(t.$$.fragment,r),e=F(r),j(s.$$.fragment,r),a=F(r),j(o.$$.fragment,r)},m(r,f){b(t,r,f),J(r,e,f),b(s,r,f),J(r,a,f),b(o,r,f),c=!0},p(r,f){const l={};f&1&&(l.href=N("workflow.events.full",r[0])),t.$set(l);const p={};f&1&&(p.href=N("workflow.events.compact",r[0])),s.$set(p);const d={};f&1&&(d.href=N("workflow.events.json",r[0])),o.$set(d)},i(r){c||(v(t.$$.fragment,r),v(s.$$.fragment,r),v(o.$$.fragment,r),c=!0)},o(r){k(t.$$.fragment,r),k(s.$$.fragment,r),k(o.$$.fragment,r),c=!1},d(r){E(t,r),r&&w(e),E(s,r),r&&w(a),E(o,r)}}}function Xe(n){let t,e,s,a,o,c,r,f,l,p,d;r=new Qe({props:{$$slots:{default:[Ue]},$$scope:{ctx:n}}}),l=new Ge({props:{namespace:n[1].namespace,workflowId:n[1].executionId,runId:n[1].runId}});const y=n[4].default,m=A(y,n,n[5],null);return{c(){t=S("section"),e=S("nav"),s=S("h3"),a=$e("Event History"),o=C(),c=S("div"),I(r.$$.fragment),f=C(),I(l.$$.fragment),p=C(),m&&m.c(),this.h()},l(i){t=R(i,"SECTION",{class:!0});var g=q(t);e=R(g,"NAV",{class:!0});var u=q(e);s=R(u,"H3",{class:!0});var h=q(s);a=Ie(h,"Event History"),h.forEach(w),o=F(u),c=R(u,"DIV",{class:!0});var _=q(c);j(r.$$.fragment,_),f=F(_),j(l.$$.fragment,_),_.forEach(w),u.forEach(w),p=F(g),m&&m.l(g),g.forEach(w),this.h()},h(){$(s,"class","text-lg font-medium"),$(c,"class","flex gap-4"),$(e,"class","flex gap-4 justify-between items-end"),$(t,"class","flex flex-col gap-4")},m(i,g){J(i,t,g),O(t,e),O(e,s),O(s,a),O(e,o),O(e,c),b(r,c,null),O(c,f),b(l,c,null),O(t,p),m&&m.m(t,null),d=!0},p(i,[g]){const u={};g&33&&(u.$$scope={dirty:g,ctx:i}),r.$set(u);const h={};g&2&&(h.namespace=i[1].namespace),g&2&&(h.workflowId=i[1].executionId),g&2&&(h.runId=i[1].runId),l.$set(h),m&&m.p&&(!d||g&32)&&ee(m,y,i,i[5],d?ne(y,i[5],g,null):te(i[5]),null)},i(i){d||(v(r.$$.fragment,i),v(l.$$.fragment,i),v(m,i),d=!0)},o(i){k(r.$$.fragment,i),k(l.$$.fragment,i),k(m,i),d=!1},d(i){i&&w(t),E(r),E(l),m&&m.d(i)}}}async function ot({page:n}){const{workflow:t,run:e,namespace:s}=n.params,a={namespace:s,executionId:t,runId:e};return await le(a),{props:{workflow:{workflowId:t,runId:e,namespace:s},parameters:a}}}function Ye(n,t,e){let s,{$$slots:a={},$$scope:o}=t,{workflow:c}=t,{parameters:r}=t,f=qe(()=>le(r));return x(n,f,l=>e(3,s=l)),n.$$set=l=>{"workflow"in l&&e(0,c=l.workflow),"parameters"in l&&e(1,r=l.parameters),"$$scope"in l&&e(5,o=l.$$scope)},n.$$.update=()=>{n.$$.dirty&8&&se("events",s)},[c,r,f,s,a,o]}class ct extends W{constructor(t){super();V(this,t,Ye,Xe,B,{workflow:0,parameters:1})}}export{ct as default,ot as load};
