var _e=Object.defineProperty,$e=Object.defineProperties;var we=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var x=(n,e,t)=>e in n?_e(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,T=(n,e)=>{for(var t in e||(e={}))Y.call(e,t)&&x(n,t,e[t]);if(K)for(var t of K(e))Z.call(e,t)&&x(n,t,e[t]);return n},A=(n,e)=>$e(n,we(e));var ee=(n,e)=>{var t={};for(var s in n)Y.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&K)for(var s of K(n))e.indexOf(s)<0&&Z.call(n,s)&&(t[s]=n[s]);return t};import{aE as ke,aF as ve,S as L,i as W,s as V,N as be,e as R,j as E,c as C,a as N,m as j,d as h,b,R as F,f as q,o as I,U as ye,x as $,u as w,v as S,G as te,ad as Ee,aG as je,Q as _,I as ne,K as se,L as re,M as oe,y as Ie,ag as ae,ah as Se,t as ce,k as J,g as le,n as P,J as O,aH as Oe,aI as Re,aJ as Ce}from"../../../../../../../chunks/vendor-07bbbbe5.js";import{h as Ne,b as U,r as fe,a as ie}from"../../../../../../../chunks/route-for-api-46d29c40.js";import{s as z,d as qe,a as Je}from"../../../../../../../chunks/data-converter-config-ec74ef2e.js";import{f as Pe}from"../../../../../../../chunks/is-event-type-6f6767d3.js";import{r as H}from"../../../../../../../chunks/route-for-11851a4f.js";import{p as ue}from"../../../../../../../chunks/stores-053bb508.js";import{a as me}from"../../../../../../../chunks/append-query-parameters-b8619cc0.js";import{g as De}from"../../../../../../../chunks/get-context-637b8da5.js";import{C as pe}from"../../../../../../../chunks/code-block-1e64b406.js";import"../../../../../../../chunks/notifications-ff4076d0.js";import"../../../../../../../chunks/is-network-error-ac7c8caf.js";const de=(n={},e={})=>{const t=T({},n);for(const s of Object.keys(e)){const r=t[s];Array.isArray(r)?t[s]=t[s].concat(e[s]):typeof r=="object"&&!Array.isArray(r)?t[s]=de(t[s],e[s]):t[s]=e[s]}return t},X=async(n,{onStart:e,onUpdate:t,onComplete:s,onError:r=Ne,token:a,previousProps:l}={})=>{!l&&U(e)&&e();try{const o=await n(a),{nextPageToken:c}=o,m=ee(o,["nextPageToken"]),u=de(l,m);return U(t)&&t(u,m),c?X(n,{onStart:e,onUpdate:t,onComplete:s,token:c,previousProps:u}):(U(s)&&s(u),u)}catch(f){r(f)}},Fe=(n,e)=>{if(!n)return{hasWebsocket:!1,websocket:null,closeSocket:function(){return null}};try{G=new ve(`ws://localhost:${n}/`,T({packMessage:t=>JSON.stringify(t),unpackMessage:t=>JSON.parse(t),attachRequestId:(t,s)=>Object.assign({requestId:s},t),extractRequestId:t=>t&&t.requestId},e)),G.onError(()=>{console.log("oh snap")})}catch{z()}return G.open(),{hasWebsocket:!0,websocket:G,closeSocket:function(){return G.close()}}};let G=null;var ge;const He=(ge=ke(qe))!=null?ge:null,Te=Fe(He);async function Le(n,e){if(!e.isOpened)try{await e.open()}catch{z()}return e.isOpened?e.sendRequest({payload:JSON.stringify(n)}).then(s=>{Je();try{return JSON.parse(s.content)}catch{return s.content}}).catch(()=>{z()}):Promise.resolve(n)}function M(n){const e=window.atob(String(n.metadata.encoding));switch(n.metadata.encodingDecoded=e,e){case"json/plain":case"json/protobuf":try{return JSON.parse(window.atob(String(n.data)))}catch{}}return n}const We=async(n,e)=>{var r,a,l,o,f,c,m,u,k,v,y,d;const t=n,s=(o=(l=(r=t==null?void 0:t.input)==null?void 0:r.payloads)!=null?l:(a=t==null?void 0:t.result)==null?void 0:a.payloads)!=null?o:null;if(s){let i;const p=e!=null?e:Te;(e==null?void 0:e.hasWebsocket)?i=await Promise.all((s!=null?s:[]).map(async D=>await Le(D,p.websocket))):i=s.map(M),((f=t==null?void 0:t.input)==null?void 0:f.payloads)&&(t.input.payloads=i),((c=t==null?void 0:t.result)==null?void 0:c.payloads)&&(t.result.payloads=i)}if((m=t==null?void 0:t.searchAttributes)==null?void 0:m.indexedFields){const i=(u=t==null?void 0:t.searchAttributes)==null?void 0:u.indexedFields;Object.entries(i).forEach(([p,g])=>{i[p]=M(g)})}if((k=t==null?void 0:t.memo)==null?void 0:k.fields){const i=(v=t==null?void 0:t.memo)==null?void 0:v.fields;Object.entries(i).forEach(([p,g])=>{i[p]=M(g)})}if((y=t==null?void 0:t.header)==null?void 0:y.fields){const i=(d=t==null?void 0:t.header)==null?void 0:d.fields;Object.entries(i).forEach(([p,g])=>{i[p]=M(g)})}if(t==null?void 0:t.queryResult){const i=t==null?void 0:t.queryResult;Object.entries(i).forEach(([p,g])=>{i[p]=M(g)})}return t};async function Ve(n){const{key:e,attributes:t}=Pe(n),s=await We(t);return T({type:e},s)}const Ge=async n=>Promise.all(n.history.events.map(async e=>A(T({},e),{id:String(e.eventId),eventType:e.eventType,attributes:await Ve(e)}))),Me=async({namespace:n,executionId:e,runId:t,onStart:s,onUpdate:r,onComplete:a},l=fetch)=>await X(async f=>fe(ie("events",{namespace:n,executionId:e,runId:t}),{token:f,request:l}),{onStart:s,onUpdate:r,onComplete:a}).then(Ge),Be=async({namespace:n,executionId:e,runId:t,onStart:s,onUpdate:r,onComplete:a},l=fetch)=>(await X(async f=>fe(ie("events",{namespace:n,executionId:e,runId:t}),{token:f,request:l}),{onStart:s,onUpdate:r,onComplete:a})).history.events;function Ke(n){let e,t,s,r,a,l;return t=new be({props:{icon:n[0],scale:n[2]}}),{c(){e=R("a"),E(t.$$.fragment),this.h()},l(o){e=C(o,"A",{class:!0,href:!0});var f=N(e);j(t.$$.fragment,f),f.forEach(h),this.h()},h(){b(e,"class","border-2 py-2 px-4 hover:text-white hover:bg-gray-600 flex items-center justify-center svelte-1orl6nd"),b(e,"href",s=me(n[3],n[4].query)),F(e,"rounded-lg",!n[1]),F(e,"active",n[4].path.includes(n[3])),F(e,"group",n[1])},m(o,f){q(o,e,f),I(t,e,null),r=!0,a||(l=ye(e,"click",n[5]),a=!0)},p(o,[f]){const c={};f&1&&(c.icon=o[0]),f&4&&(c.scale=o[2]),t.$set(c),(!r||f&24&&s!==(s=me(o[3],o[4].query)))&&b(e,"href",s),f&2&&F(e,"rounded-lg",!o[1]),f&24&&F(e,"active",o[4].path.includes(o[3])),f&2&&F(e,"group",o[1])},i(o){r||($(t.$$.fragment,o),r=!0)},o(o){w(t.$$.fragment,o),r=!1},d(o){o&&h(e),S(t),a=!1,l()}}}function Qe(n,e,t){let s;te(n,ue,c=>t(4,s=c));let{icon:r}=e,{group:a=De("group")}=e,{scale:l=1}=e,{href:o="#"}=e;function f(c){Ee.call(this,n,c)}return n.$$set=c=>{"icon"in c&&t(0,r=c.icon),"group"in c&&t(1,a=c.group),"scale"in c&&t(2,l=c.scale),"href"in c&&t(3,o=c.href)},[r,a,l,o,s,f]}class Q extends L{constructor(e){super();W(this,e,Qe,Ke,V,{icon:0,group:1,scale:2,href:3})}}function Ue(n){let e,t;return e=new Q({props:{icon:je}}),e.$on("click",n[0]),{c(){E(e.$$.fragment)},l(s){j(e.$$.fragment,s)},m(s,r){I(e,s,r),t=!0},p:_,i(s){t||($(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){S(e,s)}}}function ze(n,e,t){let s;te(n,ue,f=>t(1,s=f));const{workflow:r,run:a,namespace:l}=s.params;return[async()=>{const f=await Be({namespace:l,executionId:r,runId:a}),c=JSON.stringify(f,null,2);m(c,`${a}/events.json`,"text/plain");function m(u,k,v){const y=document.createElement("a"),d=new Blob([u],{type:v});y.href=URL.createObjectURL(d),y.download=k,y.click()}}]}class Xe extends L{constructor(e){super();W(this,e,ze,Ue,V,{})}}function Ye(n){let e,t;const s=n[1].default,r=ne(s,n,n[0],null);return{c(){e=R("div"),r&&r.c(),this.h()},l(a){e=C(a,"DIV",{class:!0});var l=N(e);r&&r.l(l),l.forEach(h),this.h()},h(){b(e,"class","flex")},m(a,l){q(a,e,l),r&&r.m(e,null),t=!0},p(a,[l]){r&&r.p&&(!t||l&1)&&se(r,s,a,a[0],t?oe(s,a[0],l,null):re(a[0]),null)},i(a){t||($(r,a),t=!0)},o(a){w(r,a),t=!1},d(a){a&&h(e),r&&r.d(a)}}}function Ze(n,e,t){let{$$slots:s={},$$scope:r}=e;return Ie("group",!0),n.$$set=a=>{"$$scope"in a&&t(0,r=a.$$scope)},[r,s]}class xe extends L{constructor(e){super();W(this,e,Ze,Ye,V,{})}}const Ae=async n=>{var a,l,o,f,c,m;n=await n;let e,t;const s=n==null?void 0:n.find(u=>!!u.workflowExecutionStartedEventAttributes),r=n==null?void 0:n.find(u=>!!u.workflowExecutionCompletedEventAttributes);return s&&(e=JSON.stringify((o=(l=(a=s==null?void 0:s.workflowExecutionStartedEventAttributes)==null?void 0:a.input)==null?void 0:l.payloads)!=null?o:"")),r&&(t=JSON.stringify((m=(c=(f=r==null?void 0:r.workflowExecutionCompletedEventAttributes)==null?void 0:f.result)==null?void 0:c.payloads)!=null?m:"")),{input:e,result:t}};function he(n){n[2]=n[4].input,n[3]=n[4].result}function et(n){return{c:_,l:_,m:_,p:_,i:_,o:_,d:_}}function tt(n){he(n);let e,t,s,r,a,l,o,f;return a=new pe({props:{heading:"Input",content:n[2],framed:!0}}),o=new pe({props:{heading:"Result",content:n[3],framed:!0}}),{c(){e=R("h3"),t=ce("Input & Results"),s=J(),r=R("div"),E(a.$$.fragment),l=J(),E(o.$$.fragment),this.h()},l(c){e=C(c,"H3",{class:!0});var m=N(e);t=le(m,"Input & Results"),m.forEach(h),s=P(c),r=C(c,"DIV",{class:!0});var u=N(r);j(a.$$.fragment,u),l=P(u),j(o.$$.fragment,u),u.forEach(h),this.h()},h(){b(e,"class","text-lg font-medium"),b(r,"class","flex gap-4")},m(c,m){q(c,e,m),O(e,t),q(c,s,m),q(c,r,m),I(a,r,null),O(r,l),I(o,r,null),f=!0},p(c,m){he(c);const u={};m&1&&(u.content=c[2]),a.$set(u);const k={};m&1&&(k.content=c[3]),o.$set(k)},i(c){f||($(a.$$.fragment,c),$(o.$$.fragment,c),f=!0)},o(c){w(a.$$.fragment,c),w(o.$$.fragment,c),f=!1},d(c){c&&h(e),c&&h(s),c&&h(r),S(a),S(o)}}}function nt(n){return{c:_,l:_,m:_,p:_,i:_,o:_,d:_}}function st(n){let e,t,s,r={ctx:n,current:null,token:null,hasCatch:!1,pending:nt,then:tt,catch:et,value:4,blocks:[,,,]};return ae(t=n[0],r),{c(){e=R("section"),r.block.c(),this.h()},l(a){e=C(a,"SECTION",{class:!0});var l=N(e);r.block.l(l),l.forEach(h),this.h()},h(){b(e,"class","flex flex-col gap-4")},m(a,l){q(a,e,l),r.block.m(e,r.anchor=null),r.mount=()=>e,r.anchor=null,s=!0},p(a,[l]){n=a,r.ctx=n,l&1&&t!==(t=n[0])&&ae(t,r)||Se(r,n,l)},i(a){s||($(r.block),s=!0)},o(a){for(let l=0;l<3;l+=1){const o=r.blocks[l];w(o)}s=!1},d(a){a&&h(e),r.block.d(),r.token=null,r=null}}}function rt(n,e,t){let s,{events:r}=e;return n.$$set=a=>{"events"in a&&t(1,r=a.events)},n.$$.update=()=>{n.$$.dirty&2&&t(0,s=Ae(r))},[s,r]}class ot extends L{constructor(e){super();W(this,e,rt,st,V,{events:1})}}function at(n){let e,t,s,r,a,l;return e=new Q({props:{icon:Oe,href:H("workflow.events.full",n[0])}}),s=new Q({props:{icon:Re,href:H("workflow.events.compact",n[0])}}),a=new Q({props:{icon:Ce,href:H("workflow.events.json",n[0])}}),{c(){E(e.$$.fragment),t=J(),E(s.$$.fragment),r=J(),E(a.$$.fragment)},l(o){j(e.$$.fragment,o),t=P(o),j(s.$$.fragment,o),r=P(o),j(a.$$.fragment,o)},m(o,f){I(e,o,f),q(o,t,f),I(s,o,f),q(o,r,f),I(a,o,f),l=!0},p(o,f){const c={};f&1&&(c.href=H("workflow.events.full",o[0])),e.$set(c);const m={};f&1&&(m.href=H("workflow.events.compact",o[0])),s.$set(m);const u={};f&1&&(u.href=H("workflow.events.json",o[0])),a.$set(u)},i(o){l||($(e.$$.fragment,o),$(s.$$.fragment,o),$(a.$$.fragment,o),l=!0)},o(o){w(e.$$.fragment,o),w(s.$$.fragment,o),w(a.$$.fragment,o),l=!1},d(o){S(e,o),o&&h(t),S(s,o),o&&h(r),S(a,o)}}}function ct(n){let e,t,s,r,a,l,o,f,c,m,u,k,v;t=new ot({props:{events:n[1]}}),c=new xe({props:{$$slots:{default:[at]},$$scope:{ctx:n}}}),u=new Xe({});const y=n[2].default,d=ne(y,n,n[3],null);return{c(){e=R("section"),E(t.$$.fragment),s=J(),r=R("nav"),a=R("h3"),l=ce("Event History"),o=J(),f=R("div"),E(c.$$.fragment),m=J(),E(u.$$.fragment),k=J(),d&&d.c(),this.h()},l(i){e=C(i,"SECTION",{class:!0});var p=N(e);j(t.$$.fragment,p),s=P(p),r=C(p,"NAV",{class:!0});var g=N(r);a=C(g,"H3",{class:!0});var D=N(a);l=le(D,"Event History"),D.forEach(h),o=P(g),f=C(g,"DIV",{class:!0});var B=N(f);j(c.$$.fragment,B),m=P(B),j(u.$$.fragment,B),B.forEach(h),g.forEach(h),k=P(p),d&&d.l(p),p.forEach(h),this.h()},h(){b(a,"class","text-lg font-medium"),b(f,"class","flex gap-4"),b(r,"class","flex gap-4 justify-between items-end"),b(e,"class","flex flex-col gap-4")},m(i,p){q(i,e,p),I(t,e,null),O(e,s),O(e,r),O(r,a),O(a,l),O(r,o),O(r,f),I(c,f,null),O(f,m),I(u,f,null),O(e,k),d&&d.m(e,null),v=!0},p(i,[p]){const g={};p&2&&(g.events=i[1]),t.$set(g);const D={};p&9&&(D.$$scope={dirty:p,ctx:i}),c.$set(D),d&&d.p&&(!v||p&8)&&se(d,y,i,i[3],v?oe(y,i[3],p,null):re(i[3]),null)},i(i){v||($(t.$$.fragment,i),$(c.$$.fragment,i),$(u.$$.fragment,i),$(d,i),v=!0)},o(i){w(t.$$.fragment,i),w(c.$$.fragment,i),w(u.$$.fragment,i),w(d,i),v=!1},d(i){i&&h(e),S(t),S(c),S(u),d&&d.d(i)}}}async function vt({page:n}){const{workflow:e,run:t,namespace:s}=n.params,a=await Me({namespace:s,executionId:e,runId:t});return{props:{workflow:{workflowId:e,runId:t,namespace:s},events:a},stuff:{events:a}}}function lt(n,e,t){let{$$slots:s={},$$scope:r}=e,{workflow:a}=e,{events:l}=e;return n.$$set=o=>{"workflow"in o&&t(0,a=o.workflow),"events"in o&&t(1,l=o.events),"$$scope"in o&&t(3,r=o.$$scope)},[a,l,s,r]}class bt extends L{constructor(e){super();W(this,e,lt,ct,V,{workflow:0,events:1})}}export{bt as default,vt as load};
