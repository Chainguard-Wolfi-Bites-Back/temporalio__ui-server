var ge=Object.defineProperty,pe=Object.defineProperties;var _e=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var A=(n,e,t)=>e in n?ge(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,L=(n,e)=>{for(var t in e||(e={}))Y.call(e,t)&&A(n,t,e[t]);if(K)for(var t of K(e))Z.call(e,t)&&A(n,t,e[t]);return n},x=(n,e)=>pe(n,_e(e));var ee=(n,e)=>{var t={};for(var s in n)Y.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&K)for(var s of K(n))e.indexOf(s)<0&&Z.call(n,s)&&(t[s]=n[s]);return t};import{aD as we,aE as ke,S as W,i as V,s as G,N as ve,e as R,j as I,c as C,a as N,m as y,d as h,b,R as T,f as q,o as E,U as $e,x as k,u as v,v as j,G as be,ad as Ie,aF as ye,Q as _,I as te,K as ne,L as se,M as re,y as Ee,ag as oe,ah as je,t as ae,k as P,g as le,n as D,J as O,aG as Oe,aH as Se,aI as Re}from"../../../../../../../chunks/vendor-7695a512.js";import{h as Ce,b as U,r as ce,a as fe}from"../../../../../../../chunks/route-for-api-5db90934.js";import{s as z,d as Ne,a as qe}from"../../../../../../../chunks/data-converter-config-b3671536.js";import{r as H}from"../../../../../../../chunks/route-for-c019a53c.js";import{p as Je}from"../../../../../../../chunks/stores-4910e5d2.js";import{a as ue}from"../../../../../../../chunks/append-query-parameters-b8619cc0.js";import{g as Pe}from"../../../../../../../chunks/get-context-e3472698.js";import{C as ie}from"../../../../../../../chunks/code-block-701d5f9b.js";import"../../../../../../../chunks/notifications-e48f3a87.js";import"../../../../../../../chunks/is-network-error-ac7c8caf.js";const me=(n={},e={})=>{const t=L({},n);for(const s of Object.keys(e)){const r=t[s];Array.isArray(r)?t[s]=t[s].concat(e[s]):typeof r=="object"&&!Array.isArray(r)?t[s]=me(t[s],e[s]):t[s]=e[s]}return t},X=async(n,{onStart:e,onUpdate:t,onComplete:s,onError:r=Ce,token:a,previousProps:f}={})=>{!f&&U(e)&&e();try{const o=await n(a),{nextPageToken:c}=o,m=ee(o,["nextPageToken"]),i=me(f,m);return U(t)&&t(i,m),c?X(n,{onStart:e,onUpdate:t,onComplete:s,token:c,previousProps:i}):(U(s)&&s(i),i)}catch(l){r(l)}},De=(n,e)=>{if(!n)return{hasWebsocket:!1,websocket:null,closeSocket:function(){return null}};try{M=new ke(`ws://localhost:${n}/`,L({packMessage:t=>JSON.stringify(t),unpackMessage:t=>JSON.parse(t),attachRequestId:(t,s)=>Object.assign({requestId:s},t),extractRequestId:t=>t&&t.requestId},e)),M.onError(()=>{console.log("oh snap")})}catch{z()}return M.open(),{hasWebsocket:!0,websocket:M,closeSocket:function(){return M.close()}}};let M=null;var he;const Fe=(he=we(Ne))!=null?he:null,Te=De(Fe);async function He(n,e){if(!e.isOpened)try{await e.open()}catch{z()}return e.isOpened?e.sendRequest({payload:JSON.stringify(n)}).then(s=>{qe();try{return JSON.parse(s.content)}catch{return s.content}}).catch(()=>{z()}):Promise.resolve(n)}function B(n){const e=window.atob(String(n.metadata.encoding));switch(n.metadata.encodingDecoded=e,e){case"json/plain":case"json/protobuf":try{return JSON.parse(window.atob(String(n.data)))}catch{}}return n}const Le=async(n,e)=>{var r,a,f,o,l,c,m,i,$,w,J,g;const t=n,s=(o=(f=(r=t==null?void 0:t.input)==null?void 0:r.payloads)!=null?f:(a=t==null?void 0:t.result)==null?void 0:a.payloads)!=null?o:null;if(s){let u;const d=e!=null?e:Te;(e==null?void 0:e.hasWebsocket)?u=await Promise.all((s!=null?s:[]).map(async F=>await He(F,d.websocket))):u=s.map(B),((l=t==null?void 0:t.input)==null?void 0:l.payloads)&&(t.input.payloads=u),((c=t==null?void 0:t.result)==null?void 0:c.payloads)&&(t.result.payloads=u)}if((m=t==null?void 0:t.searchAttributes)==null?void 0:m.indexedFields){const u=(i=t==null?void 0:t.searchAttributes)==null?void 0:i.indexedFields;Object.entries(u).forEach(([d,p])=>{u[d]=B(p)})}if(($=t==null?void 0:t.memo)==null?void 0:$.fields){const u=(w=t==null?void 0:t.memo)==null?void 0:w.fields;Object.entries(u).forEach(([d,p])=>{u[d]=B(p)})}if((J=t==null?void 0:t.header)==null?void 0:J.fields){const u=(g=t==null?void 0:t.header)==null?void 0:g.fields;Object.entries(u).forEach(([d,p])=>{u[d]=B(p)})}if(t==null?void 0:t.queryResult){const u=t==null?void 0:t.queryResult;Object.entries(u).forEach(([d,p])=>{u[d]=B(p)})}return t};async function We(n){const e=Object.keys(n).find(s=>s.includes("Attributes")),t=await Le(n[e]);return L({type:e},t)}const Ve=async n=>Promise.all(n.history.events.map(async e=>x(L({},e),{id:String(e.eventId),eventType:e.eventType,attributes:await We(e)}))),Ge=async({namespace:n,executionId:e,runId:t,onStart:s,onUpdate:r,onComplete:a},f=fetch)=>await X(async l=>ce(fe("events",{namespace:n,executionId:e,runId:t}),{token:l,request:f}),{onStart:s,onUpdate:r,onComplete:a}).then(Ve),Me=async({namespace:n,executionId:e,runId:t,onStart:s,onUpdate:r,onComplete:a},f=fetch)=>(await X(async l=>ce(fe("events",{namespace:n,executionId:e,runId:t}),{token:l,request:f}),{onStart:s,onUpdate:r,onComplete:a})).history.events;function Be(n){let e,t,s,r,a,f;return t=new ve({props:{icon:n[0],scale:n[2]}}),{c(){e=R("a"),I(t.$$.fragment),this.h()},l(o){e=C(o,"A",{class:!0,href:!0});var l=N(e);y(t.$$.fragment,l),l.forEach(h),this.h()},h(){b(e,"class","border-2 py-2 px-4 hover:text-white hover:bg-gray-600 flex items-center justify-center svelte-1orl6nd"),b(e,"href",s=ue(n[3],n[4].query)),T(e,"rounded-lg",!n[1]),T(e,"active",n[4].path.includes(n[3])),T(e,"group",n[1])},m(o,l){q(o,e,l),E(t,e,null),r=!0,a||(f=$e(e,"click",n[5]),a=!0)},p(o,[l]){const c={};l&1&&(c.icon=o[0]),l&4&&(c.scale=o[2]),t.$set(c),(!r||l&24&&s!==(s=ue(o[3],o[4].query)))&&b(e,"href",s),l&2&&T(e,"rounded-lg",!o[1]),l&24&&T(e,"active",o[4].path.includes(o[3])),l&2&&T(e,"group",o[1])},i(o){r||(k(t.$$.fragment,o),r=!0)},o(o){v(t.$$.fragment,o),r=!1},d(o){o&&h(e),j(t),a=!1,f()}}}function Ke(n,e,t){let s;be(n,Je,c=>t(4,s=c));let{icon:r}=e,{group:a=Pe("group")}=e,{scale:f=1}=e,{href:o="#"}=e;function l(c){Ie.call(this,n,c)}return n.$$set=c=>{"icon"in c&&t(0,r=c.icon),"group"in c&&t(1,a=c.group),"scale"in c&&t(2,f=c.scale),"href"in c&&t(3,o=c.href)},[r,a,f,o,s,l]}class Q extends W{constructor(e){super();V(this,e,Ke,Be,G,{icon:0,group:1,scale:2,href:3})}}function Qe(n){let e,t;return e=new Q({props:{icon:ye}}),e.$on("click",n[0]),{c(){I(e.$$.fragment)},l(s){y(e.$$.fragment,s)},m(s,r){E(e,s,r),t=!0},p:_,i(s){t||(k(e.$$.fragment,s),t=!0)},o(s){v(e.$$.fragment,s),t=!1},d(s){j(e,s)}}}function Ue(n,e,t){const s=async()=>{const o=await Me({namespace:r,executionId:a,runId:f}),l=JSON.stringify(o,null,2);c(l,`${f}/events.json`,"text/plain");function c(m,i,$){const w=document.createElement("a"),J=new Blob([m],{type:$});w.href=URL.createObjectURL(J),w.download=i,w.click()}};let{namespace:r}=e,{workflowId:a}=e,{runId:f}=e;return n.$$set=o=>{"namespace"in o&&t(1,r=o.namespace),"workflowId"in o&&t(2,a=o.workflowId),"runId"in o&&t(3,f=o.runId)},[s,r,a,f]}class ze extends W{constructor(e){super();V(this,e,Ue,Qe,G,{namespace:1,workflowId:2,runId:3})}}function Xe(n){let e,t;const s=n[1].default,r=te(s,n,n[0],null);return{c(){e=R("div"),r&&r.c(),this.h()},l(a){e=C(a,"DIV",{class:!0});var f=N(e);r&&r.l(f),f.forEach(h),this.h()},h(){b(e,"class","flex")},m(a,f){q(a,e,f),r&&r.m(e,null),t=!0},p(a,[f]){r&&r.p&&(!t||f&1)&&ne(r,s,a,a[0],t?re(s,a[0],f,null):se(a[0]),null)},i(a){t||(k(r,a),t=!0)},o(a){v(r,a),t=!1},d(a){a&&h(e),r&&r.d(a)}}}function Ye(n,e,t){let{$$slots:s={},$$scope:r}=e;return Ee("group",!0),n.$$set=a=>{"$$scope"in a&&t(0,r=a.$$scope)},[r,s]}class Ze extends W{constructor(e){super();V(this,e,Ye,Xe,G,{})}}const Ae=async n=>{var a,f,o,l,c,m;n=await n;let e,t;const s=n==null?void 0:n.find(i=>!!i.workflowExecutionStartedEventAttributes),r=n==null?void 0:n.find(i=>!!i.workflowExecutionCompletedEventAttributes);return s&&(e=JSON.stringify((o=(f=(a=s==null?void 0:s.workflowExecutionStartedEventAttributes)==null?void 0:a.input)==null?void 0:f.payloads)!=null?o:"")),r&&(t=JSON.stringify((m=(c=(l=r==null?void 0:r.workflowExecutionCompletedEventAttributes)==null?void 0:l.result)==null?void 0:c.payloads)!=null?m:"")),{input:e,result:t}};function de(n){n[2]=n[4].input,n[3]=n[4].result}function xe(n){return{c:_,l:_,m:_,p:_,i:_,o:_,d:_}}function et(n){de(n);let e,t,s,r,a,f,o,l;return a=new ie({props:{heading:"Input",content:n[2],framed:!0}}),o=new ie({props:{heading:"Result",content:n[3],framed:!0}}),{c(){e=R("h3"),t=ae("Input & Results"),s=P(),r=R("div"),I(a.$$.fragment),f=P(),I(o.$$.fragment),this.h()},l(c){e=C(c,"H3",{class:!0});var m=N(e);t=le(m,"Input & Results"),m.forEach(h),s=D(c),r=C(c,"DIV",{class:!0});var i=N(r);y(a.$$.fragment,i),f=D(i),y(o.$$.fragment,i),i.forEach(h),this.h()},h(){b(e,"class","text-lg font-medium"),b(r,"class","flex gap-4")},m(c,m){q(c,e,m),O(e,t),q(c,s,m),q(c,r,m),E(a,r,null),O(r,f),E(o,r,null),l=!0},p(c,m){de(c);const i={};m&1&&(i.content=c[2]),a.$set(i);const $={};m&1&&($.content=c[3]),o.$set($)},i(c){l||(k(a.$$.fragment,c),k(o.$$.fragment,c),l=!0)},o(c){v(a.$$.fragment,c),v(o.$$.fragment,c),l=!1},d(c){c&&h(e),c&&h(s),c&&h(r),j(a),j(o)}}}function tt(n){return{c:_,l:_,m:_,p:_,i:_,o:_,d:_}}function nt(n){let e,t,s,r={ctx:n,current:null,token:null,hasCatch:!1,pending:tt,then:et,catch:xe,value:4,blocks:[,,,]};return oe(t=n[0],r),{c(){e=R("section"),r.block.c(),this.h()},l(a){e=C(a,"SECTION",{class:!0});var f=N(e);r.block.l(f),f.forEach(h),this.h()},h(){b(e,"class","flex flex-col gap-4")},m(a,f){q(a,e,f),r.block.m(e,r.anchor=null),r.mount=()=>e,r.anchor=null,s=!0},p(a,[f]){n=a,r.ctx=n,f&1&&t!==(t=n[0])&&oe(t,r)||je(r,n,f)},i(a){s||(k(r.block),s=!0)},o(a){for(let f=0;f<3;f+=1){const o=r.blocks[f];v(o)}s=!1},d(a){a&&h(e),r.block.d(),r.token=null,r=null}}}function st(n,e,t){let s,{events:r}=e;return n.$$set=a=>{"events"in a&&t(1,r=a.events)},n.$$.update=()=>{n.$$.dirty&2&&t(0,s=Ae(r))},[s,r]}class rt extends W{constructor(e){super();V(this,e,st,nt,G,{events:1})}}function ot(n){let e,t,s,r,a,f;return e=new Q({props:{icon:Oe,href:H("workflow.events.full",n[0])}}),s=new Q({props:{icon:Se,href:H("workflow.events.compact",n[0])}}),a=new Q({props:{icon:Re,href:H("workflow.events.json",n[0])}}),{c(){I(e.$$.fragment),t=P(),I(s.$$.fragment),r=P(),I(a.$$.fragment)},l(o){y(e.$$.fragment,o),t=D(o),y(s.$$.fragment,o),r=D(o),y(a.$$.fragment,o)},m(o,l){E(e,o,l),q(o,t,l),E(s,o,l),q(o,r,l),E(a,o,l),f=!0},p(o,l){const c={};l&1&&(c.href=H("workflow.events.full",o[0])),e.$set(c);const m={};l&1&&(m.href=H("workflow.events.compact",o[0])),s.$set(m);const i={};l&1&&(i.href=H("workflow.events.json",o[0])),a.$set(i)},i(o){f||(k(e.$$.fragment,o),k(s.$$.fragment,o),k(a.$$.fragment,o),f=!0)},o(o){v(e.$$.fragment,o),v(s.$$.fragment,o),v(a.$$.fragment,o),f=!1},d(o){j(e,o),o&&h(t),j(s,o),o&&h(r),j(a,o)}}}function at(n){let e,t,s,r,a,f,o,l,c,m,i,$,w;t=new rt({props:{events:n[2]}}),c=new Ze({props:{$$slots:{default:[ot]},$$scope:{ctx:n}}}),i=new ze({props:{namespace:n[1].namespace,workflowId:n[1].executionId,runId:n[1].runId}});const J=n[3].default,g=te(J,n,n[4],null);return{c(){e=R("section"),I(t.$$.fragment),s=P(),r=R("nav"),a=R("h3"),f=ae("Event History"),o=P(),l=R("div"),I(c.$$.fragment),m=P(),I(i.$$.fragment),$=P(),g&&g.c(),this.h()},l(u){e=C(u,"SECTION",{class:!0});var d=N(e);y(t.$$.fragment,d),s=D(d),r=C(d,"NAV",{class:!0});var p=N(r);a=C(p,"H3",{class:!0});var F=N(a);f=le(F,"Event History"),F.forEach(h),o=D(p),l=C(p,"DIV",{class:!0});var S=N(l);y(c.$$.fragment,S),m=D(S),y(i.$$.fragment,S),S.forEach(h),p.forEach(h),$=D(d),g&&g.l(d),d.forEach(h),this.h()},h(){b(a,"class","text-lg font-medium"),b(l,"class","flex gap-4"),b(r,"class","flex gap-4 justify-between items-end"),b(e,"class","flex flex-col gap-4")},m(u,d){q(u,e,d),E(t,e,null),O(e,s),O(e,r),O(r,a),O(a,f),O(r,o),O(r,l),E(c,l,null),O(l,m),E(i,l,null),O(e,$),g&&g.m(e,null),w=!0},p(u,[d]){const p={};d&4&&(p.events=u[2]),t.$set(p);const F={};d&17&&(F.$$scope={dirty:d,ctx:u}),c.$set(F);const S={};d&2&&(S.namespace=u[1].namespace),d&2&&(S.workflowId=u[1].executionId),d&2&&(S.runId=u[1].runId),i.$set(S),g&&g.p&&(!w||d&16)&&ne(g,J,u,u[4],w?re(J,u[4],d,null):se(u[4]),null)},i(u){w||(k(t.$$.fragment,u),k(c.$$.fragment,u),k(i.$$.fragment,u),k(g,u),w=!0)},o(u){v(t.$$.fragment,u),v(c.$$.fragment,u),v(i.$$.fragment,u),v(g,u),w=!1},d(u){u&&h(e),j(t),j(c),j(i),g&&g.d(u)}}}async function kt({page:n}){const{workflow:e,run:t,namespace:s}=n.params,r={namespace:s,executionId:e,runId:t},a=await Ge(r);return{props:{workflow:{workflowId:e,runId:t,namespace:s},events:a,parameters:r},stuff:{events:a}}}function lt(n,e,t){let{$$slots:s={},$$scope:r}=e,{workflow:a}=e,{parameters:f}=e,{events:o}=e;return n.$$set=l=>{"workflow"in l&&t(0,a=l.workflow),"parameters"in l&&t(1,f=l.parameters),"events"in l&&t(2,o=l.events),"$$scope"in l&&t(4,r=l.$$scope)},[a,f,o,s,r]}class vt extends W{constructor(e){super();V(this,e,lt,at,G,{workflow:0,parameters:1,events:2})}}export{vt as default,kt as load};
