var Re=Object.defineProperty;var Te=Object.getOwnPropertySymbols;var Ve=Object.prototype.hasOwnProperty,qe=Object.prototype.propertyIsEnumerable;var Ie=(n,e,t)=>e in n?Re(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,me=(n,e)=>{for(var t in e||(e={}))Ve.call(e,t)&&Ie(n,t,e[t]);if(Te)for(var t of Te(e))qe.call(e,t)&&Ie(n,t,e[t]);return n};import{S as x,i as ee,s as te,w as E,k as A,x as S,m as Q,y as W,g as C,q as k,o as y,B as P,d as u,l as Ee,n as je,p as Oe,t as N,h as R,e as g,c as b,a as v,b as w,M as m,E as se,Z as Ae,T as De,R as Se,N as we,C as Qe,V as We,j as ne,I as He,J as Le,K as Me,L as Be}from"../../../../../../chunks/index-0ac56778.js";import{e as Pe,f as Ue,g as Je,h as Ke,i as Ye,j as Ce,k as Ze}from"../../../../../../chunks/route-for-1f2060cd.js";import{r as he,a as de,h as ze}from"../../../../../../chunks/route-for-api-a61aba31.js";import{W as Ge,t as Xe,f as xe}from"../../../../../../chunks/workflow-status-540aa0cc.js";import{I as et}from"../../../../../../chunks/index-8aa3dbe1.js";import{e as tt}from"../../../../../../chunks/event-view-8bcb1434.js";import{w as at}from"../../../../../../chunks/workflows-d9df8d30.js";import{n as st}from"../../../../../../chunks/notifications-c89d12d3.js";import{B as Ne}from"../../../../../../chunks/button-16cbf4b3.js";import{M as nt}from"../../../../../../chunks/modal-789f4b54.js";import{f as rt}from"../../../../../../chunks/events-service-d6c6a5cd.js";import{p as ot}from"../../../../../../chunks/stores-b68b1c9c.js";import"../../../../../../chunks/index-d79bdd4d.js";import"../../../../../../chunks/is-network-error-ac7c8caf.js";import"../../../../../../chunks/simplify-attributes-5634c671.js";import"../../../../../../chunks/format-date-308f6b51.js";import"../../../../../../chunks/persist-store-c143c99b.js";import"../../../../../../chunks/with-loading-22689bcc.js";import"../../../../../../chunks/index-0ec5e969.js";import"../../../../../../chunks/is-http-66ff83d1.js";import"../../../../../../chunks/data-converter-config-3aa7207a.js";import"../../../../../../chunks/atob-eb4fc9a1.js";import"../../../../../../chunks/index-8821dfb5.js";import"../../../../../../chunks/get-event-categorization-20095c1b.js";async function lt(n,e=fetch){const t=await he(de("task-queue",n),{request:e,params:{taskQueueType:"1"}}),r=await he(de("task-queue",n),{request:e,params:{taskQueueType:"2"}});r.pollers.forEach(a=>{a.taskQueueTypes=["ACTIVITY"]}),t.pollers.forEach(a=>{a.taskQueueTypes=["WORKFLOW"]});const s=a=>(o,l)=>{const f=o[l.identity]||{lastAccessTime:void 0,taskQueueTypes:[]};return o[l.identity]={lastAccessTime:!f.lastAccessTime||f.lastAccessTime<l.lastAccessTime?l.lastAccessTime:f.lastAccessTime,taskQueueTypes:f.taskQueueTypes.concat([a])},o};return r.pollers.filter(a=>t.pollers.some(o=>{if(a.identity===o.identity)return a.taskQueueTypes=[...o.taskQueueTypes,...a.taskQueueTypes],a})),r.pollers.reduce(s("ACTIVITY"),t.pollers.reduce(s("WORKFLOW"),{})),{pollers:r.pollers,taskQueueStatus:r.taskQueueStatus}}async function ft({workflow:n,namespace:e,reason:t}){return await he(de("workflow.terminate",{namespace:e,workflowId:n.id,runId:n.runId}),{options:{method:"POST",body:JSON.stringify({reason:t})},shouldRetry:!1})}function Fe(n){let e,t,r,s;return e=new Ne({props:{destroy:!0,$$slots:{default:[it]},$$scope:{ctx:n}}}),e.$on("click",n[3]),r=new nt({props:{open:n[2],confirmText:"Terminate",$$slots:{content:[ct],title:[ut]},$$scope:{ctx:n}}}),r.$on("cancelModal",n[4]),r.$on("confirmModal",n[6]),{c(){E(e.$$.fragment),t=A(),E(r.$$.fragment)},l(a){S(e.$$.fragment,a),t=Q(a),S(r.$$.fragment,a)},m(a,o){W(e,a,o),C(a,t,o),W(r,a,o),s=!0},p(a,o){const l={};o&1024&&(l.$$scope={dirty:o,ctx:a}),e.$set(l);const f={};o&4&&(f.open=a[2]),o&1026&&(f.$$scope={dirty:o,ctx:a}),r.$set(f)},i(a){s||(k(e.$$.fragment,a),k(r.$$.fragment,a),s=!0)},o(a){y(e.$$.fragment,a),y(r.$$.fragment,a),s=!1},d(a){P(e,a),a&&u(t),P(r,a)}}}function it(n){let e;return{c(){e=N("Terminate")},l(t){e=R(t,"Terminate")},m(t,r){C(t,e,r)},d(t){t&&u(e)}}}function ut(n){let e,t;return{c(){e=g("h3"),t=N("Terminate Workflow"),this.h()},l(r){e=b(r,"H3",{slot:!0});var s=v(e);t=R(s,"Terminate Workflow"),s.forEach(u),this.h()},h(){w(e,"slot","title")},m(r,s){C(r,e,s),m(e,t)},p:se,d(r){r&&u(e)}}}function ct(n){let e,t,r,s,a,o,l;return{c(){e=g("div"),t=g("p"),r=N(`Are you sure you want to terminate this workflow? This action cannot be
        undone.`),s=A(),a=g("input"),this.h()},l(f){e=b(f,"DIV",{slot:!0});var c=v(e);t=b(c,"P",{});var d=v(t);r=R(d,`Are you sure you want to terminate this workflow? This action cannot be
        undone.`),d.forEach(u),s=Q(c),a=b(c,"INPUT",{class:!0,placeholder:!0}),c.forEach(u),this.h()},h(){w(a,"class","mt-4 block w-full rounded-md border border-gray-200 p-2"),w(a,"placeholder","Enter a reason"),w(e,"slot","content")},m(f,c){C(f,e,c),m(e,t),m(t,r),m(e,s),m(e,a),Ae(a,n[1]),o||(l=De(a,"input",n[8]),o=!0)},p(f,c){c&2&&a.value!==f[1]&&Ae(a,f[1])},d(f){f&&u(e),o=!1,l()}}}function mt(n){let e=n[5](n[0]),t,r,s=e&&Fe(n);return{c(){s&&s.c(),t=Ee()},l(a){s&&s.l(a),t=Ee()},m(a,o){s&&s.m(a,o),C(a,t,o),r=!0},p(a,[o]){o&1&&(e=a[5](a[0])),e?s?(s.p(a,o),o&1&&k(s,1)):(s=Fe(a),s.c(),k(s,1),s.m(t.parentNode,t)):s&&(je(),y(s,1,1,()=>{s=null}),Oe())},i(a){r||(k(s),r=!0)},o(a){y(s),r=!1},d(a){s&&s.d(a),a&&u(t)}}}function wt(n,e,t){let{workflow:r}=e,{namespace:s}=e,a="",o=!1;const l=()=>t(2,o=!0),f=()=>t(2,o=!1),c=p=>String(p.status)==="Running",d=()=>{t(2,o=!1),t(1,a=""),st.add("success","Workflow Terminated"),window.location.reload()},$=()=>{ft({workflow:r,namespace:s,reason:a}).then(d).catch(ze)};function h(){a=this.value,t(1,a)}return n.$$set=p=>{"workflow"in p&&t(0,r=p.workflow),"namespace"in p&&t(7,s=p.namespace)},[r,a,o,l,f,c,$,s,h]}class ht extends x{constructor(e){super(),ee(this,e,wt,mt,te,{workflow:0,namespace:7})}}function dt(n){let e,t;return{c(){e=g("span"),t=N("Download"),this.h()},l(r){e=b(r,"SPAN",{class:!0});var s=v(e);t=R(s,"Download"),s.forEach(u),this.h()},h(){w(e,"class","hidden md:inline")},m(r,s){C(r,e,s),m(e,t)},p:se,d(r){r&&u(e)}}}function pt(n){let e,t;return e=new Ne({props:{secondary:!0,icon:"download",$$slots:{default:[dt]},$$scope:{ctx:n}}}),e.$on("click",n[0]),{c(){E(e.$$.fragment)},l(r){S(e.$$.fragment,r)},m(r,s){W(e,r,s),t=!0},p(r,[s]){const a={};s&16&&(a.$$scope={dirty:s,ctx:r}),e.$set(a)},i(r){t||(k(e.$$.fragment,r),t=!0)},o(r){y(e.$$.fragment,r),t=!1},d(r){P(e,r)}}}function _t(n,e,t){let{namespace:r}=e,{workflowId:s}=e,{runId:a}=e;const o=async()=>{const l=await rt({namespace:r,workflowId:s,runId:a}),f=JSON.stringify({events:l},null,2);c(f,`${a}/events.json`,"text/plain");function c(d,$,h){const p=document.createElement("a"),M=new Blob([d],{type:h});p.href=URL.createObjectURL(M),p.download=$,p.click()}};return n.$$set=l=>{"namespace"in l&&t(1,r=l.namespace),"workflowId"in l&&t(2,s=l.workflowId),"runId"in l&&t(3,a=l.runId)},[o,r,s,a]}class kt extends x{constructor(e){super(),ee(this,e,_t,pt,te,{namespace:1,workflowId:2,runId:3})}}function gt(n){let e;return{c(){e=N(n[1])},l(t){e=R(t,n[1])},m(t,r){C(t,e,r)},p(t,r){r&2&&ne(e,t[1])},d(t){t&&u(e)}}}function bt(n){let e,t,r,s;return{c(){e=N(n[1]),t=A(),r=g("span"),s=N(n[2]),this.h()},l(a){e=R(a,n[1]),t=Q(a),r=b(a,"SPAN",{class:!0});var o=v(r);s=R(o,n[2]),o.forEach(u),this.h()},h(){w(r,"class","rounded-sm bg-blue-100 px-2 text-blue-700")},m(a,o){C(a,e,o),C(a,t,o),C(a,r,o),m(r,s)},p(a,o){o&2&&ne(e,a[1]),o&4&&ne(s,a[2])},d(a){a&&u(e),a&&u(t),a&&u(r)}}}function yt(n){let e,t;function r(o,l){return o[2]||o[2]===0?bt:gt}let s=r(n),a=s(n);return{c(){e=g("a"),a.c(),this.h()},l(o){e=b(o,"A",{class:!0,href:!0,"data-cy":!0});var l=v(e);a.l(l),l.forEach(u),this.h()},h(){w(e,"class","block whitespace-nowrap text-sm md:text-base svelte-sf1jtj"),w(e,"href",n[0]),w(e,"data-cy",t=n[4].dataCy),Se(e,"active",n[3])},m(o,l){C(o,e,l),a.m(e,null)},p(o,[l]){s===(s=r(o))&&a?a.p(o,l):(a.d(1),a=s(o),a&&(a.c(),a.m(e,null))),l&1&&w(e,"href",o[0]),l&16&&t!==(t=o[4].dataCy)&&w(e,"data-cy",t),l&8&&Se(e,"active",o[3])},i:se,o:se,d(o){o&&u(e),a.d()}}}function vt(n,e,t){let r,s;we(n,ot,f=>t(5,s=f));let{href:a}=e,{label:o}=e,{amount:l=null}=e;return n.$$set=f=>{t(4,e=Qe(Qe({},e),We(f))),"href"in f&&t(0,a=f.href),"label"in f&&t(1,o=f.label),"amount"in f&&t(2,l=f.amount)},n.$$.update=()=>{n.$$.dirty&33&&t(3,r=s.url.pathname.includes(a))},e=We(e),[a,o,l,r,e,s]}class X extends x{constructor(e){super(),ee(this,e,vt,yt,te,{href:0,label:1,amount:2})}}function $t(n){var pe,_e,ke,ge,be;let e,t,r,s,a,o,l,f,c,d,$,h,p,M=n[1].id+"",ae,re,V,q,oe,j,le,T,O,fe,D,ie,H,ue,B,ce,U,z;return a=new et({props:{scale:.8,name:"caretLeft",class:"inline"}}),$=new Ge({props:{status:(pe=n[1])==null?void 0:pe.status}}),q=new kt({props:{namespace:n[0],workflowId:n[1].id,runId:n[1].runId}}),j=new ht({props:{workflow:n[1],namespace:n[0]}}),O=new X({props:{label:"History",href:Pe(me({view:n[3]},n[4])),amount:(_e=n[1])==null?void 0:_e.historyEvents,dataCy:"history-tab"}}),D=new X({props:{label:"Workers",href:Ue(n[4]),amount:(ge=(ke=n[2])==null?void 0:ke.pollers)==null?void 0:ge.length,dataCy:"workers-tab"}}),H=new X({props:{label:"Pending Activities",href:Je(n[4]),amount:(be=n[1].pendingActivities)==null?void 0:be.length,dataCy:"pending-activities-tab"}}),B=new X({props:{label:"Stack Trace",href:Ke(n[4]),dataCy:"stack-trace-tab"}}),U=new X({props:{label:"Queries",href:Ye(n[4]),dataCy:"queries-tab"}}),{c(){e=g("header"),t=g("main"),r=g("div"),s=g("a"),E(a.$$.fragment),o=N("Back to Workflows"),f=A(),c=g("div"),d=g("h1"),E($.$$.fragment),h=A(),p=g("span"),ae=N(M),re=A(),V=g("div"),E(q.$$.fragment),oe=A(),E(j.$$.fragment),le=A(),T=g("nav"),E(O.$$.fragment),fe=A(),E(D.$$.fragment),ie=A(),E(H.$$.fragment),ue=A(),E(B.$$.fragment),ce=A(),E(U.$$.fragment),this.h()},l(i){e=b(i,"HEADER",{class:!0});var _=v(e);t=b(_,"MAIN",{class:!0});var F=v(t);r=b(F,"DIV",{class:!0});var J=v(r);s=b(J,"A",{href:!0,"data-cy":!0,class:!0});var K=v(s);S(a.$$.fragment,K),o=R(K,"Back to Workflows"),K.forEach(u),J.forEach(u),f=Q(F),c=b(F,"DIV",{class:!0});var L=v(c);d=b(L,"H1",{class:!0});var Y=v(d);S($.$$.fragment,Y),h=Q(Y),p=b(Y,"SPAN",{class:!0});var G=v(p);ae=R(G,M),G.forEach(u),Y.forEach(u),re=Q(L),V=b(L,"DIV",{class:!0});var Z=v(V);S(q.$$.fragment,Z),oe=Q(Z),S(j.$$.fragment,Z),Z.forEach(u),L.forEach(u),le=Q(F),T=b(F,"NAV",{class:!0});var I=v(T);S(O.$$.fragment,I),fe=Q(I),S(D.$$.fragment,I),ie=Q(I),S(H.$$.fragment,I),ue=Q(I),S(B.$$.fragment,I),ce=Q(I),S(U.$$.fragment,I),I.forEach(u),F.forEach(u),_.forEach(u),this.h()},h(){w(s,"href",l=`/namespaces/${n[0]}/workflows?query=${Ce(n[6])}&search=${n[5]}`),w(s,"data-cy","back-to-workflows"),w(s,"class","back-to-workflows svelte-st9g8m"),w(r,"class","-mt-3 -ml-2 block"),w(p,"class","select-all font-medium"),w(d,"class","relative flex items-center gap-4 text-2xl"),w(V,"class","ml-8 flex items-center justify-end gap-4"),w(c,"class","mb-8 flex items-center justify-between"),w(T,"class","flex flex-wrap gap-6"),w(t,"class","relative flex flex-col gap-1"),w(e,"class","flex flex-col gap-4")},m(i,_){C(i,e,_),m(e,t),m(t,r),m(r,s),W(a,s,null),m(s,o),m(t,f),m(t,c),m(c,d),W($,d,null),m(d,h),m(d,p),m(p,ae),m(c,re),m(c,V),W(q,V,null),m(V,oe),W(j,V,null),m(t,le),m(t,T),W(O,T,null),m(T,fe),W(D,T,null),m(T,ie),W(H,T,null),m(T,ue),W(B,T,null),m(T,ce),W(U,T,null),z=!0},p(i,[_]){var Z,I,ye,ve,$e;(!z||_&1&&l!==(l=`/namespaces/${i[0]}/workflows?query=${Ce(i[6])}&search=${i[5]}`))&&w(s,"href",l);const F={};_&2&&(F.status=(Z=i[1])==null?void 0:Z.status),$.$set(F),(!z||_&2)&&M!==(M=i[1].id+"")&&ne(ae,M);const J={};_&1&&(J.namespace=i[0]),_&2&&(J.workflowId=i[1].id),_&2&&(J.runId=i[1].runId),q.$set(J);const K={};_&2&&(K.workflow=i[1]),_&1&&(K.namespace=i[0]),j.$set(K);const L={};_&8&&(L.href=Pe(me({view:i[3]},i[4]))),_&2&&(L.amount=(I=i[1])==null?void 0:I.historyEvents),O.$set(L);const Y={};_&4&&(Y.amount=(ve=(ye=i[2])==null?void 0:ye.pollers)==null?void 0:ve.length),D.$set(Y);const G={};_&2&&(G.amount=($e=i[1].pendingActivities)==null?void 0:$e.length),H.$set(G)},i(i){z||(k(a.$$.fragment,i),k($.$$.fragment,i),k(q.$$.fragment,i),k(j.$$.fragment,i),k(O.$$.fragment,i),k(D.$$.fragment,i),k(H.$$.fragment,i),k(B.$$.fragment,i),k(U.$$.fragment,i),z=!0)},o(i){y(a.$$.fragment,i),y($.$$.fragment,i),y(q.$$.fragment,i),y(j.$$.fragment,i),y(O.$$.fragment,i),y(D.$$.fragment,i),y(H.$$.fragment,i),y(B.$$.fragment,i),y(U.$$.fragment,i),z=!1},d(i){i&&u(e),P(a),P($),P(q),P(j),P(O),P(D),P(H),P(B),P(U)}}}function Tt(n,e,t){let r,s;we(n,at,h=>t(7,r=h)),we(n,tt,h=>t(3,s=h));let{namespace:a}=e,{workflow:o}=e,{workers:l}=e;const f={namespace:a,workflow:o.id,run:o.runId},{parameters:c,searchType:d}=r,$=Xe(c);return n.$$set=h=>{"namespace"in h&&t(0,a=h.namespace),"workflow"in h&&t(1,o=h.workflow),"workers"in h&&t(2,l=h.workers)},[a,o,l,s,f,d,$]}class It extends x{constructor(e){super(),ee(this,e,Tt,$t,te,{namespace:0,workflow:1,workers:2})}}function Et(n){let e,t,r,s;t=new It({props:{namespace:n[1],workflow:n[0],workers:n[2]}});const a=n[4].default,o=He(a,n,n[3],null);return{c(){e=g("main"),E(t.$$.fragment),r=A(),o&&o.c(),this.h()},l(l){e=b(l,"MAIN",{class:!0});var f=v(e);S(t.$$.fragment,f),r=Q(f),o&&o.l(f),f.forEach(u),this.h()},h(){w(e,"class","flex h-full flex-col gap-6")},m(l,f){C(l,e,f),W(t,e,null),m(e,r),o&&o.m(e,null),s=!0},p(l,[f]){const c={};f&2&&(c.namespace=l[1]),f&1&&(c.workflow=l[0]),f&4&&(c.workers=l[2]),t.$set(c),o&&o.p&&(!s||f&8)&&Le(o,a,l,l[3],s?Be(a,l[3],f,null):Me(l[3]),null)},i(l){s||(k(t.$$.fragment,l),k(o,l),s=!0)},o(l){y(t.$$.fragment,l),y(o,l),s=!1},d(l){l&&u(e),P(t),o&&o.d(l)}}}const xt=async function({params:n,fetch:e}){const{workflow:t,run:r,namespace:s}=n,a={namespace:s,workflowId:Ze(t),runId:r},o=await xe(a,e),{taskQueue:l}=o,f=await lt({queue:l,namespace:s});return{props:{workflow:o,namespace:s,workers:f},stuff:{workflow:o,workers:f}}};function At(n,e,t){let{$$slots:r={},$$scope:s}=e,{workflow:a}=e,{namespace:o}=e,{workers:l}=e;return n.$$set=f=>{"workflow"in f&&t(0,a=f.workflow),"namespace"in f&&t(1,o=f.namespace),"workers"in f&&t(2,l=f.workers),"$$scope"in f&&t(3,s=f.$$scope)},[a,o,l,s,r]}class ea extends x{constructor(e){super(),ee(this,e,At,Et,te,{workflow:0,namespace:1,workers:2})}}export{ea as default,xt as load};
