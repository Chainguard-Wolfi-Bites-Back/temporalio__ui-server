var Fe=Object.defineProperty;var ye=Object.getOwnPropertySymbols;var We=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable;var ve=(r,e,t)=>e in r?Fe(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ie=(r,e)=>{for(var t in e||(e={}))We.call(e,t)&&ve(r,t,e[t]);if(ye)for(var t of ye(e))Ne.call(e,t)&&ve(r,t,e[t]);return r};import{S as Z,i as x,s as ee,w as $,k as T,x as I,m as E,y as A,g as S,q as d,o as p,B as Q,d as u,l as $e,n as Re,p as je,t as q,h as L,e as _,c as k,a as b,b as w,M as m,E as te,ab as Te,T as Oe,R as Ie,N as Pe,C as Ee,U as Ae,j as ae,f as Ve,I as De,J as He,K as Me,L as qe}from"../../../../../../chunks/index-6f949d33.js";import{e as Qe,f as Le,g as Ue,h as Be,i as Je,j as Ke}from"../../../../../../chunks/route-for-9a2d1abe.js";import{r as ue,a as ce,h as Ye}from"../../../../../../chunks/route-for-api-35afd266.js";import{W as ze,f as Ge}from"../../../../../../chunks/workflow-status-e4c3decb.js";import{m as Xe,F as Ze,n as xe}from"../../../../../../chunks/index.es-2106a8ff.js";import{e as et}from"../../../../../../chunks/event-view-e934a955.js";import{n as tt}from"../../../../../../chunks/notifications-8df92a3f.js";import{B as Ce}from"../../../../../../chunks/button-932377c6.js";import{M as at}from"../../../../../../chunks/modal-9b173d16.js";import{f as nt}from"../../../../../../chunks/events-service-de4190d0.js";import{p as st}from"../../../../../../chunks/stores-e4f64366.js";import"../../../../../../chunks/index-8e6fc7ce.js";import"../../../../../../chunks/is-network-error-ac7c8caf.js";import"../../../../../../chunks/simplify-attributes-6710d3ed.js";import"../../../../../../chunks/format-date-4b1bc9ef.js";import"../../../../../../chunks/persist-store-aa0162b2.js";import"../../../../../../chunks/index-182fbd7a.js";import"../../../../../../chunks/is-http-4b214bf2.js";import"../../../../../../chunks/data-converter-config-37d2d147.js";import"../../../../../../chunks/atob-eb4fc9a1.js";import"../../../../../../chunks/index-8821dfb5.js";import"../../../../../../chunks/get-event-categorization-20095c1b.js";async function rt(r,e=fetch){const t=await ue(ce("task-queue",r),{request:e,params:{taskQueueType:"1"}}),n=await ue(ce("task-queue",r),{request:e,params:{taskQueueType:"2"}});n.pollers.forEach(a=>{a.taskQueueTypes=["ACTIVITY"]}),t.pollers.forEach(a=>{a.taskQueueTypes=["WORKFLOW"]});const s=a=>(o,f)=>{const l=o[f.identity]||{lastAccessTime:void 0,taskQueueTypes:[]};return o[f.identity]={lastAccessTime:!l.lastAccessTime||l.lastAccessTime<f.lastAccessTime?f.lastAccessTime:l.lastAccessTime,taskQueueTypes:l.taskQueueTypes.concat([a])},o};return n.pollers.filter(a=>t.pollers.some(o=>{if(a.identity===o.identity)return a.taskQueueTypes=[...o.taskQueueTypes,...a.taskQueueTypes],a})),n.pollers.reduce(s("ACTIVITY"),t.pollers.reduce(s("WORKFLOW"),{})),{pollers:n.pollers,taskQueueStatus:n.taskQueueStatus}}async function ot({workflow:r,namespace:e,reason:t}){return await ue(ce("workflow.terminate",{namespace:e,workflowId:r.id,runId:r.runId}),{options:{method:"POST",body:JSON.stringify({reason:t})},shouldRetry:!1})}function Se(r){let e,t,n,s;return e=new Ce({props:{destroy:!0,$$slots:{default:[lt]},$$scope:{ctx:r}}}),e.$on("click",r[3]),n=new at({props:{open:r[2],confirmText:"Terminate",$$slots:{content:[it],title:[ft]},$$scope:{ctx:r}}}),n.$on("cancelModal",r[4]),n.$on("confirmModal",r[6]),{c(){$(e.$$.fragment),t=T(),$(n.$$.fragment)},l(a){I(e.$$.fragment,a),t=E(a),I(n.$$.fragment,a)},m(a,o){A(e,a,o),S(a,t,o),A(n,a,o),s=!0},p(a,o){const f={};o&1024&&(f.$$scope={dirty:o,ctx:a}),e.$set(f);const l={};o&4&&(l.open=a[2]),o&1026&&(l.$$scope={dirty:o,ctx:a}),n.$set(l)},i(a){s||(d(e.$$.fragment,a),d(n.$$.fragment,a),s=!0)},o(a){p(e.$$.fragment,a),p(n.$$.fragment,a),s=!1},d(a){Q(e,a),a&&u(t),Q(n,a)}}}function lt(r){let e;return{c(){e=q("Terminate")},l(t){e=L(t,"Terminate")},m(t,n){S(t,e,n)},d(t){t&&u(e)}}}function ft(r){let e,t;return{c(){e=_("h3"),t=q("Terminate Workflow"),this.h()},l(n){e=k(n,"H3",{slot:!0});var s=b(e);t=L(s,"Terminate Workflow"),s.forEach(u),this.h()},h(){w(e,"slot","title")},m(n,s){S(n,e,s),m(e,t)},p:te,d(n){n&&u(e)}}}function it(r){let e,t,n,s,a,o,f;return{c(){e=_("div"),t=_("p"),n=q(`Are you sure you want to terminate this workflow? This action cannot be
        undone.`),s=T(),a=_("input"),this.h()},l(l){e=k(l,"DIV",{slot:!0});var c=b(e);t=k(c,"P",{});var P=b(t);n=L(P,`Are you sure you want to terminate this workflow? This action cannot be
        undone.`),P.forEach(u),s=E(c),a=k(c,"INPUT",{class:!0,placeholder:!0}),c.forEach(u),this.h()},h(){w(a,"class","block w-full border border-gray-200 rounded-md p-2 mt-4"),w(a,"placeholder","Enter a reason"),w(e,"slot","content")},m(l,c){S(l,e,c),m(e,t),m(t,n),m(e,s),m(e,a),Te(a,r[1]),o||(f=Oe(a,"input",r[8]),o=!0)},p(l,c){c&2&&a.value!==l[1]&&Te(a,l[1])},d(l){l&&u(e),o=!1,f()}}}function ut(r){let e=r[5](r[0]),t,n,s=e&&Se(r);return{c(){s&&s.c(),t=$e()},l(a){s&&s.l(a),t=$e()},m(a,o){s&&s.m(a,o),S(a,t,o),n=!0},p(a,[o]){o&1&&(e=a[5](a[0])),e?s?(s.p(a,o),o&1&&d(s,1)):(s=Se(a),s.c(),d(s,1),s.m(t.parentNode,t)):s&&(Re(),p(s,1,1,()=>{s=null}),je())},i(a){n||(d(s),n=!0)},o(a){p(s),n=!1},d(a){s&&s.d(a),a&&u(t)}}}function ct(r,e,t){let{workflow:n}=e,{namespace:s}=e,a="",o=!1;const f=()=>t(2,o=!0),l=()=>t(2,o=!1),c=g=>String(g.status)==="Running",P=()=>{t(2,o=!1),t(1,a=""),tt.add("success","Workflow Terminated"),window.location.reload()},C=()=>{ot({workflow:n,namespace:s,reason:a}).then(P).catch(Ye)};function F(){a=this.value,t(1,a)}return r.$$set=g=>{"workflow"in g&&t(0,n=g.workflow),"namespace"in g&&t(7,s=g.namespace)},[n,a,o,f,l,c,C,s,F]}class mt extends Z{constructor(e){super(),x(this,e,ct,ut,ee,{workflow:0,namespace:7})}}function wt(r){let e,t;return{c(){e=_("span"),t=q("Download"),this.h()},l(n){e=k(n,"SPAN",{class:!0});var s=b(e);t=L(s,"Download"),s.forEach(u),this.h()},h(){w(e,"class","hidden md:inline")},m(n,s){S(n,e,s),m(e,t)},p:te,d(n){n&&u(e)}}}function ht(r){let e,t;return e=new Ce({props:{secondary:!0,icon:Xe,$$slots:{default:[wt]},$$scope:{ctx:r}}}),e.$on("click",r[0]),{c(){$(e.$$.fragment)},l(n){I(e.$$.fragment,n)},m(n,s){A(e,n,s),t=!0},p(n,[s]){const a={};s&16&&(a.$$scope={dirty:s,ctx:n}),e.$set(a)},i(n){t||(d(e.$$.fragment,n),t=!0)},o(n){p(e.$$.fragment,n),t=!1},d(n){Q(e,n)}}}function dt(r,e,t){let{namespace:n}=e,{workflowId:s}=e,{runId:a}=e;const o=async()=>{const f=await nt({namespace:n,workflowId:s,runId:a}),l=JSON.stringify({events:f},null,2);c(l,`${a}/events.json`,"text/plain");function c(P,C,F){const g=document.createElement("a"),z=new Blob([P],{type:F});g.href=URL.createObjectURL(z),g.download=C,g.click()}};return r.$$set=f=>{"namespace"in f&&t(1,n=f.namespace),"workflowId"in f&&t(2,s=f.workflowId),"runId"in f&&t(3,a=f.runId)},[o,n,s,a]}class pt extends Z{constructor(e){super(),x(this,e,dt,ht,ee,{namespace:1,workflowId:2,runId:3})}}function _t(r){let e;return{c(){e=q(r[1])},l(t){e=L(t,r[1])},m(t,n){S(t,e,n)},p(t,n){n&2&&ae(e,t[1])},d(t){t&&u(e)}}}function kt(r){let e,t,n,s;return{c(){e=q(r[1]),t=T(),n=_("span"),s=q(r[2]),this.h()},l(a){e=L(a,r[1]),t=E(a),n=k(a,"SPAN",{class:!0});var o=b(n);s=L(o,r[2]),o.forEach(u),this.h()},h(){w(n,"class","px-2 text-blue-700 bg-blue-100 rounded-sm")},m(a,o){S(a,e,o),S(a,t,o),S(a,n,o),m(n,s)},p(a,o){o&2&&ae(e,a[1]),o&4&&ae(s,a[2])},d(a){a&&u(e),a&&u(t),a&&u(n)}}}function gt(r){let e,t;function n(o,f){return o[2]||o[2]===0?kt:_t}let s=n(r),a=s(r);return{c(){e=_("a"),a.c(),this.h()},l(o){e=k(o,"A",{class:!0,href:!0,"data-cy":!0});var f=b(e);a.l(f),f.forEach(u),this.h()},h(){w(e,"class","block text-sm md:text-base border-b-2 whitespace-nowrap svelte-sf1jtj"),w(e,"href",r[0]),w(e,"data-cy",t=r[4].dataCy),Ie(e,"active",r[3])},m(o,f){S(o,e,f),a.m(e,null)},p(o,[f]){s===(s=n(o))&&a?a.p(o,f):(a.d(1),a=s(o),a&&(a.c(),a.m(e,null))),f&1&&w(e,"href",o[0]),f&16&&t!==(t=o[4].dataCy)&&w(e,"data-cy",t),f&8&&Ie(e,"active",o[3])},i:te,o:te,d(o){o&&u(e),a.d()}}}function bt(r,e,t){let n,s;Pe(r,st,l=>t(5,s=l));let{href:a}=e,{label:o}=e,{amount:f=null}=e;return r.$$set=l=>{t(4,e=Ee(Ee({},e),Ae(l))),"href"in l&&t(0,a=l.href),"label"in l&&t(1,o=l.label),"amount"in l&&t(2,f=l.amount)},r.$$.update=()=>{r.$$.dirty&33&&t(3,n=s.url.pathname.includes(a))},e=Ae(e),[a,o,f,n,e,s]}class X extends Z{constructor(e){super(),x(this,e,bt,gt,ee,{href:0,label:1,amount:2})}}function yt(r){var me,we,he,de,pe;let e,t,n,s,a,o,f,l,c,P,C,F=r[1].id+"",g,z,N,R,ne,j,se,y,O,re,V,oe,D,le,U,fe,B,Y;return s=new Ze({props:{icon:xe}}),c=new ze({props:{status:(me=r[1])==null?void 0:me.status}}),R=new pt({props:{namespace:r[0],workflowId:r[1].id,runId:r[1].runId}}),j=new mt({props:{workflow:r[1],namespace:r[0]}}),O=new X({props:{label:"History",href:Qe(ie({view:r[3]},r[4])),amount:(we=r[1])==null?void 0:we.historyEvents,dataCy:"history-tab"}}),V=new X({props:{label:"Workers",href:Le(r[4]),amount:(de=(he=r[2])==null?void 0:he.pollers)==null?void 0:de.length,dataCy:"workers-tab"}}),D=new X({props:{label:"Pending Activities",href:Ue(r[4]),amount:(pe=r[1].pendingActivities)==null?void 0:pe.length,dataCy:"pending-activities-tab"}}),U=new X({props:{label:"Stack Trace",href:Be(r[4]),dataCy:"stack-trace-tab"}}),B=new X({props:{label:"Queries",href:Je(r[4]),dataCy:"queries-tab"}}),{c(){e=_("header"),t=_("main"),n=_("a"),$(s.$$.fragment),o=T(),f=_("div"),l=_("h1"),$(c.$$.fragment),P=T(),C=_("span"),g=q(F),z=T(),N=_("div"),$(R.$$.fragment),ne=T(),$(j.$$.fragment),se=T(),y=_("nav"),$(O.$$.fragment),re=T(),$(V.$$.fragment),oe=T(),$(D.$$.fragment),le=T(),$(U.$$.fragment),fe=T(),$(B.$$.fragment),this.h()},l(i){e=k(i,"HEADER",{class:!0});var h=b(e);t=k(h,"MAIN",{class:!0});var W=b(t);n=k(W,"A",{href:!0,class:!0,style:!0});var J=b(n);I(s.$$.fragment,J),J.forEach(u),o=E(W),f=k(W,"DIV",{class:!0});var H=b(f);l=k(H,"H1",{class:!0});var M=b(l);I(c.$$.fragment,M),P=E(M),C=k(M,"SPAN",{class:!0});var G=b(C);g=L(G,F),G.forEach(u),M.forEach(u),z=E(H),N=k(H,"DIV",{class:!0});var K=b(N);I(R.$$.fragment,K),ne=E(K),I(j.$$.fragment,K),K.forEach(u),H.forEach(u),se=E(W),y=k(W,"NAV",{class:!0});var v=b(y);I(O.$$.fragment,v),re=E(v),I(V.$$.fragment,v),oe=E(v),I(D.$$.fragment,v),le=E(v),I(U.$$.fragment,v),fe=E(v),I(B.$$.fragment,v),v.forEach(u),W.forEach(u),h.forEach(u),this.h()},h(){w(n,"href",a="/namespaces/"+r[0]+"/workflows"),w(n,"class","absolute top-2 back-to-workflows"),Ve(n,"left","-1.5rem"),w(C,"class","font-medium select-all"),w(l,"class","text-2xl flex relative items-center gap-4"),w(N,"class","ml-8 flex justify-end items-center gap-4"),w(f,"class","flex justify-between items-center mb-8"),w(y,"class","flex gap-6 flex-wrap"),w(t,"class","flex flex-col gap-1 relative"),w(e,"class","flex flex-col gap-4")},m(i,h){S(i,e,h),m(e,t),m(t,n),A(s,n,null),m(t,o),m(t,f),m(f,l),A(c,l,null),m(l,P),m(l,C),m(C,g),m(f,z),m(f,N),A(R,N,null),m(N,ne),A(j,N,null),m(t,se),m(t,y),A(O,y,null),m(y,re),A(V,y,null),m(y,oe),A(D,y,null),m(y,le),A(U,y,null),m(y,fe),A(B,y,null),Y=!0},p(i,[h]){var v,_e,ke,ge,be;(!Y||h&1&&a!==(a="/namespaces/"+i[0]+"/workflows"))&&w(n,"href",a);const W={};h&2&&(W.status=(v=i[1])==null?void 0:v.status),c.$set(W),(!Y||h&2)&&F!==(F=i[1].id+"")&&ae(g,F);const J={};h&1&&(J.namespace=i[0]),h&2&&(J.workflowId=i[1].id),h&2&&(J.runId=i[1].runId),R.$set(J);const H={};h&2&&(H.workflow=i[1]),h&1&&(H.namespace=i[0]),j.$set(H);const M={};h&8&&(M.href=Qe(ie({view:i[3]},i[4]))),h&2&&(M.amount=(_e=i[1])==null?void 0:_e.historyEvents),O.$set(M);const G={};h&4&&(G.amount=(ge=(ke=i[2])==null?void 0:ke.pollers)==null?void 0:ge.length),V.$set(G);const K={};h&2&&(K.amount=(be=i[1].pendingActivities)==null?void 0:be.length),D.$set(K)},i(i){Y||(d(s.$$.fragment,i),d(c.$$.fragment,i),d(R.$$.fragment,i),d(j.$$.fragment,i),d(O.$$.fragment,i),d(V.$$.fragment,i),d(D.$$.fragment,i),d(U.$$.fragment,i),d(B.$$.fragment,i),Y=!0)},o(i){p(s.$$.fragment,i),p(c.$$.fragment,i),p(R.$$.fragment,i),p(j.$$.fragment,i),p(O.$$.fragment,i),p(V.$$.fragment,i),p(D.$$.fragment,i),p(U.$$.fragment,i),p(B.$$.fragment,i),Y=!1},d(i){i&&u(e),Q(s),Q(c),Q(R),Q(j),Q(O),Q(V),Q(D),Q(U),Q(B)}}}function vt(r,e,t){let n;Pe(r,et,l=>t(3,n=l));let{namespace:s}=e,{workflow:a}=e,{workers:o}=e;const f={namespace:s,workflow:a.id,run:a.runId};return r.$$set=l=>{"namespace"in l&&t(0,s=l.namespace),"workflow"in l&&t(1,a=l.workflow),"workers"in l&&t(2,o=l.workers)},[s,a,o,n,f]}class $t extends Z{constructor(e){super(),x(this,e,vt,yt,ee,{namespace:0,workflow:1,workers:2})}}function Tt(r){let e,t,n,s;t=new $t({props:{namespace:r[1],workflow:r[0],workers:r[2]}});const a=r[4].default,o=De(a,r,r[3],null);return{c(){e=_("main"),$(t.$$.fragment),n=T(),o&&o.c(),this.h()},l(f){e=k(f,"MAIN",{class:!0});var l=b(e);I(t.$$.fragment,l),n=E(l),o&&o.l(l),l.forEach(u),this.h()},h(){w(e,"class","flex flex-col gap-6 h-full")},m(f,l){S(f,e,l),A(t,e,null),m(e,n),o&&o.m(e,null),s=!0},p(f,[l]){const c={};l&2&&(c.namespace=f[1]),l&1&&(c.workflow=f[0]),l&4&&(c.workers=f[2]),t.$set(c),o&&o.p&&(!s||l&8)&&He(o,a,f,f[3],s?qe(a,f[3],l,null):Me(f[3]),null)},i(f){s||(d(t.$$.fragment,f),d(o,f),s=!0)},o(f){p(t.$$.fragment,f),p(o,f),s=!1},d(f){f&&u(e),Q(t),o&&o.d(f)}}}const zt=async function({params:r,fetch:e}){const{workflow:t,run:n,namespace:s}=r,a={namespace:s,workflowId:Ke(t),runId:n},o=await Ge(a,e),{taskQueue:f}=o,l=await rt({queue:f,namespace:s});return{props:{workflow:o,namespace:s,workers:l},stuff:{workflow:o,workers:l}}};function It(r,e,t){let{$$slots:n={},$$scope:s}=e,{workflow:a}=e,{namespace:o}=e,{workers:f}=e;return r.$$set=l=>{"workflow"in l&&t(0,a=l.workflow),"namespace"in l&&t(1,o=l.namespace),"workers"in l&&t(2,f=l.workers),"$$scope"in l&&t(3,s=l.$$scope)},[a,o,f,s,n]}class Gt extends Z{constructor(e){super(),x(this,e,It,Tt,ee,{workflow:0,namespace:1,workers:2})}}export{Gt as default,zt as load};
