var Pe=Object.defineProperty;var be=Object.getOwnPropertySymbols;var Fe=Object.prototype.hasOwnProperty,We=Object.prototype.propertyIsEnumerable;var ve=(r,e,n)=>e in r?Pe(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n,ie=(r,e)=>{for(var n in e||(e={}))Fe.call(e,n)&&ve(r,n,e[n]);if(be)for(var n of be(e))We.call(e,n)&&ve(r,n,e[n]);return r};import{S as Z,i as x,s as ee,w as T,k as y,x as I,m as E,y as A,g as S,q as p,o as d,B as Q,d as u,l as Te,n as Ne,p as Re,t as q,h as C,e as _,c as k,a as $,b as w,M as m,E as te,ab as ye,T as je,R as Ie,N as Qe,j as ne,f as Oe,I as Ve,J as De,K as He,L as Me}from"../../../../../../chunks/index-caf98bb2.js";import{e as Ee,f as Le,g as qe,h as Ce,i as Be,j as Ue}from"../../../../../../chunks/route-for-37155b93.js";import{r as ue,a as ce,h as Je}from"../../../../../../chunks/route-for-api-1e04c9f3.js";import{W as Ke,f as Ye}from"../../../../../../chunks/workflow-status-27362e91.js";import{m as ze,F as Ge,n as Xe}from"../../../../../../chunks/index.es-20d15ff4.js";import{n as Ze}from"../../../../../../chunks/notifications-059905fc.js";import{B as Se}from"../../../../../../chunks/button-e117c6a4.js";import{M as xe}from"../../../../../../chunks/modal-de8cc343.js";import{f as et}from"../../../../../../chunks/events-service-46ef0491.js";import{p as tt}from"../../../../../../chunks/stores-2b8df60b.js";import{e as nt}from"../../../../../../chunks/event-view-type-82b4530e.js";import"../../../../../../chunks/index-9674ed36.js";import"../../../../../../chunks/is-network-error-ac7c8caf.js";import"../../../../../../chunks/simplify-attributes-6710d3ed.js";import"../../../../../../chunks/format-date-4b1bc9ef.js";import"../../../../../../chunks/index-93179bf3.js";import"../../../../../../chunks/is-http-bb1df2e8.js";import"../../../../../../chunks/persist-store-2fedf73e.js";import"../../../../../../chunks/data-converter-config-f280b377.js";import"../../../../../../chunks/atob-5f9d7101.js";import"../../../../../../chunks/index-8ae46573.js";import"../../../../../../chunks/get-event-categorization-b2bce139.js";async function st(r,e=fetch){const n=await ue(ce("task-queue",r),{request:e,params:{taskQueueType:"1"}}),a=await ue(ce("task-queue",r),{request:e,params:{taskQueueType:"2"}});a.pollers.forEach(t=>{t.taskQueueTypes=["ACTIVITY"]}),n.pollers.forEach(t=>{t.taskQueueTypes=["WORKFLOW"]});const s=t=>(o,f)=>{const l=o[f.identity]||{lastAccessTime:void 0,taskQueueTypes:[]};return o[f.identity]={lastAccessTime:!l.lastAccessTime||l.lastAccessTime<f.lastAccessTime?f.lastAccessTime:l.lastAccessTime,taskQueueTypes:l.taskQueueTypes.concat([t])},o};return a.pollers.filter(t=>n.pollers.some(o=>{if(t.identity===o.identity)return t.taskQueueTypes=[...o.taskQueueTypes,...t.taskQueueTypes],t})),a.pollers.reduce(s("ACTIVITY"),n.pollers.reduce(s("WORKFLOW"),{})),{pollers:a.pollers,taskQueueStatus:a.taskQueueStatus}}async function at({workflow:r,namespace:e,reason:n}){return await ue(ce("workflow.terminate",{namespace:e,workflowId:r.id,runId:r.runId}),{options:{method:"POST",body:JSON.stringify({reason:n})},shouldRetry:!1})}function Ae(r){let e,n,a,s;return e=new Se({props:{destroy:!0,$$slots:{default:[rt]},$$scope:{ctx:r}}}),e.$on("click",r[3]),a=new xe({props:{open:r[2],confirmText:"Terminate",$$slots:{content:[lt],title:[ot]},$$scope:{ctx:r}}}),a.$on("cancelModal",r[4]),a.$on("confirmModal",r[6]),{c(){T(e.$$.fragment),n=y(),T(a.$$.fragment)},l(t){I(e.$$.fragment,t),n=E(t),I(a.$$.fragment,t)},m(t,o){A(e,t,o),S(t,n,o),A(a,t,o),s=!0},p(t,o){const f={};o&1024&&(f.$$scope={dirty:o,ctx:t}),e.$set(f);const l={};o&4&&(l.open=t[2]),o&1026&&(l.$$scope={dirty:o,ctx:t}),a.$set(l)},i(t){s||(p(e.$$.fragment,t),p(a.$$.fragment,t),s=!0)},o(t){d(e.$$.fragment,t),d(a.$$.fragment,t),s=!1},d(t){Q(e,t),t&&u(n),Q(a,t)}}}function rt(r){let e;return{c(){e=q("Terminate")},l(n){e=C(n,"Terminate")},m(n,a){S(n,e,a)},d(n){n&&u(e)}}}function ot(r){let e,n;return{c(){e=_("h3"),n=q("Terminate Workflow"),this.h()},l(a){e=k(a,"H3",{slot:!0});var s=$(e);n=C(s,"Terminate Workflow"),s.forEach(u),this.h()},h(){w(e,"slot","title")},m(a,s){S(a,e,s),m(e,n)},p:te,d(a){a&&u(e)}}}function lt(r){let e,n,a,s,t,o,f;return{c(){e=_("div"),n=_("p"),a=q(`Are you sure you want to terminate this workflow? This action cannot be
        undone.`),s=y(),t=_("input"),this.h()},l(l){e=k(l,"DIV",{slot:!0});var c=$(e);n=k(c,"P",{});var P=$(n);a=C(P,`Are you sure you want to terminate this workflow? This action cannot be
        undone.`),P.forEach(u),s=E(c),t=k(c,"INPUT",{class:!0,placeholder:!0}),c.forEach(u),this.h()},h(){w(t,"class","block w-full border border-gray-200 rounded-md p-2 mt-4"),w(t,"placeholder","Enter a reason"),w(e,"slot","content")},m(l,c){S(l,e,c),m(e,n),m(n,a),m(e,s),m(e,t),ye(t,r[1]),o||(f=je(t,"input",r[8]),o=!0)},p(l,c){c&2&&t.value!==l[1]&&ye(t,l[1])},d(l){l&&u(e),o=!1,f()}}}function ft(r){let e=r[5](r[0]),n,a,s=e&&Ae(r);return{c(){s&&s.c(),n=Te()},l(t){s&&s.l(t),n=Te()},m(t,o){s&&s.m(t,o),S(t,n,o),a=!0},p(t,[o]){o&1&&(e=t[5](t[0])),e?s?(s.p(t,o),o&1&&p(s,1)):(s=Ae(t),s.c(),p(s,1),s.m(n.parentNode,n)):s&&(Ne(),d(s,1,1,()=>{s=null}),Re())},i(t){a||(p(s),a=!0)},o(t){d(s),a=!1},d(t){s&&s.d(t),t&&u(n)}}}function it(r,e,n){let{workflow:a}=e,{namespace:s}=e,t="",o=!1;const f=()=>n(2,o=!0),l=()=>n(2,o=!1),c=g=>String(g.status)==="Running",P=()=>{n(2,o=!1),n(1,t=""),Ze.add("success","Workflow Terminated"),window.location.reload()},F=()=>{at({workflow:a,namespace:s,reason:t}).then(P).catch(Je)};function W(){t=this.value,n(1,t)}return r.$$set=g=>{"workflow"in g&&n(0,a=g.workflow),"namespace"in g&&n(7,s=g.namespace)},[a,t,o,f,l,c,F,s,W]}class ut extends Z{constructor(e){super(),x(this,e,it,ft,ee,{workflow:0,namespace:7})}}function ct(r){let e,n;return{c(){e=_("span"),n=q("Download"),this.h()},l(a){e=k(a,"SPAN",{class:!0});var s=$(e);n=C(s,"Download"),s.forEach(u),this.h()},h(){w(e,"class","hidden md:inline")},m(a,s){S(a,e,s),m(e,n)},p:te,d(a){a&&u(e)}}}function mt(r){let e,n;return e=new Se({props:{secondary:!0,icon:ze,$$slots:{default:[ct]},$$scope:{ctx:r}}}),e.$on("click",r[0]),{c(){T(e.$$.fragment)},l(a){I(e.$$.fragment,a)},m(a,s){A(e,a,s),n=!0},p(a,[s]){const t={};s&16&&(t.$$scope={dirty:s,ctx:a}),e.$set(t)},i(a){n||(p(e.$$.fragment,a),n=!0)},o(a){d(e.$$.fragment,a),n=!1},d(a){Q(e,a)}}}function wt(r,e,n){let{namespace:a}=e,{workflowId:s}=e,{runId:t}=e;const o=async()=>{const f=await et({namespace:a,workflowId:s,runId:t}),l=JSON.stringify({events:f},null,2);c(l,`${t}/events.json`,"text/plain");function c(P,F,W){const g=document.createElement("a"),z=new Blob([P],{type:W});g.href=URL.createObjectURL(z),g.download=F,g.click()}};return r.$$set=f=>{"namespace"in f&&n(1,a=f.namespace),"workflowId"in f&&n(2,s=f.workflowId),"runId"in f&&n(3,t=f.runId)},[o,a,s,t]}class ht extends Z{constructor(e){super(),x(this,e,wt,mt,ee,{namespace:1,workflowId:2,runId:3})}}function pt(r){let e;return{c(){e=q(r[1])},l(n){e=C(n,r[1])},m(n,a){S(n,e,a)},p(n,a){a&2&&ne(e,n[1])},d(n){n&&u(e)}}}function dt(r){let e,n,a,s;return{c(){e=q(r[1]),n=y(),a=_("span"),s=q(r[2]),this.h()},l(t){e=C(t,r[1]),n=E(t),a=k(t,"SPAN",{class:!0});var o=$(a);s=C(o,r[2]),o.forEach(u),this.h()},h(){w(a,"class","px-2 text-blue-700 bg-blue-100 rounded-sm")},m(t,o){S(t,e,o),S(t,n,o),S(t,a,o),m(a,s)},p(t,o){o&2&&ne(e,t[1]),o&4&&ne(s,t[2])},d(t){t&&u(e),t&&u(n),t&&u(a)}}}function _t(r){let e;function n(t,o){return t[2]||t[2]===0?dt:pt}let a=n(r),s=a(r);return{c(){e=_("a"),s.c(),this.h()},l(t){e=k(t,"A",{class:!0,href:!0});var o=$(e);s.l(o),o.forEach(u),this.h()},h(){w(e,"class","block text-sm md:text-base border-b-2 whitespace-nowrap svelte-sf1jtj"),w(e,"href",r[0]),Ie(e,"active",r[3])},m(t,o){S(t,e,o),s.m(e,null)},p(t,[o]){a===(a=n(t))&&s?s.p(t,o):(s.d(1),s=a(t),s&&(s.c(),s.m(e,null))),o&1&&w(e,"href",t[0]),o&8&&Ie(e,"active",t[3])},i:te,o:te,d(t){t&&u(e),s.d()}}}function kt(r,e,n){let a,s;Qe(r,tt,l=>n(4,s=l));let{href:t}=e,{label:o}=e,{amount:f=null}=e;return r.$$set=l=>{"href"in l&&n(0,t=l.href),"label"in l&&n(1,o=l.label),"amount"in l&&n(2,f=l.amount)},r.$$.update=()=>{r.$$.dirty&17&&n(3,a=s.url.pathname.includes(t))},[t,o,f,a,s]}class X extends Z{constructor(e){super(),x(this,e,kt,_t,ee,{href:0,label:1,amount:2})}}function gt(r){var me,we,he,pe,de;let e,n,a,s,t,o,f,l,c,P,F,W=r[1].id+"",g,z,R,j,se,O,ae,b,V,re,D,oe,H,le,B,fe,U,Y;return s=new Ge({props:{icon:Xe}}),c=new Ke({props:{status:(me=r[1])==null?void 0:me.status}}),j=new ht({props:{namespace:r[0],workflowId:r[1].id,runId:r[1].runId}}),O=new ut({props:{workflow:r[1],namespace:r[0]}}),V=new X({props:{label:"History",href:Ee(ie({view:r[3]},r[4])),amount:(we=r[1])==null?void 0:we.historyEvents}}),D=new X({props:{label:"Workers",href:Le(r[4]),amount:(pe=(he=r[2])==null?void 0:he.pollers)==null?void 0:pe.length}}),H=new X({props:{label:"Pending Activities",href:qe(r[4]),amount:(de=r[1].pendingActivities)==null?void 0:de.length}}),B=new X({props:{label:"Stack Trace",href:Ce(r[4])}}),U=new X({props:{label:"Queries",href:Be(r[4])}}),{c(){e=_("header"),n=_("main"),a=_("a"),T(s.$$.fragment),o=y(),f=_("div"),l=_("h1"),T(c.$$.fragment),P=y(),F=_("span"),g=q(W),z=y(),R=_("div"),T(j.$$.fragment),se=y(),T(O.$$.fragment),ae=y(),b=_("nav"),T(V.$$.fragment),re=y(),T(D.$$.fragment),oe=y(),T(H.$$.fragment),le=y(),T(B.$$.fragment),fe=y(),T(U.$$.fragment),this.h()},l(i){e=k(i,"HEADER",{class:!0});var h=$(e);n=k(h,"MAIN",{class:!0});var N=$(n);a=k(N,"A",{href:!0,class:!0,style:!0});var J=$(a);I(s.$$.fragment,J),J.forEach(u),o=E(N),f=k(N,"DIV",{class:!0});var M=$(f);l=k(M,"H1",{class:!0});var L=$(l);I(c.$$.fragment,L),P=E(L),F=k(L,"SPAN",{class:!0});var G=$(F);g=C(G,W),G.forEach(u),L.forEach(u),z=E(M),R=k(M,"DIV",{class:!0});var K=$(R);I(j.$$.fragment,K),se=E(K),I(O.$$.fragment,K),K.forEach(u),M.forEach(u),ae=E(N),b=k(N,"NAV",{class:!0});var v=$(b);I(V.$$.fragment,v),re=E(v),I(D.$$.fragment,v),oe=E(v),I(H.$$.fragment,v),le=E(v),I(B.$$.fragment,v),fe=E(v),I(U.$$.fragment,v),v.forEach(u),N.forEach(u),h.forEach(u),this.h()},h(){w(a,"href",t="/namespaces/"+r[0]+"/workflows"),w(a,"class","absolute top-2 back-to-workflows"),Oe(a,"left","-1.5rem"),w(F,"class","font-medium select-all"),w(l,"class","text-2xl flex relative items-center gap-4"),w(R,"class","ml-8 flex justify-end items-center gap-4"),w(f,"class","flex justify-between items-center mb-8"),w(b,"class","flex gap-6 flex-wrap"),w(n,"class","flex flex-col gap-1 relative"),w(e,"class","flex flex-col gap-4")},m(i,h){S(i,e,h),m(e,n),m(n,a),A(s,a,null),m(n,o),m(n,f),m(f,l),A(c,l,null),m(l,P),m(l,F),m(F,g),m(f,z),m(f,R),A(j,R,null),m(R,se),A(O,R,null),m(n,ae),m(n,b),A(V,b,null),m(b,re),A(D,b,null),m(b,oe),A(H,b,null),m(b,le),A(B,b,null),m(b,fe),A(U,b,null),Y=!0},p(i,[h]){var v,_e,ke,ge,$e;(!Y||h&1&&t!==(t="/namespaces/"+i[0]+"/workflows"))&&w(a,"href",t);const N={};h&2&&(N.status=(v=i[1])==null?void 0:v.status),c.$set(N),(!Y||h&2)&&W!==(W=i[1].id+"")&&ne(g,W);const J={};h&1&&(J.namespace=i[0]),h&2&&(J.workflowId=i[1].id),h&2&&(J.runId=i[1].runId),j.$set(J);const M={};h&2&&(M.workflow=i[1]),h&1&&(M.namespace=i[0]),O.$set(M);const L={};h&8&&(L.href=Ee(ie({view:i[3]},i[4]))),h&2&&(L.amount=(_e=i[1])==null?void 0:_e.historyEvents),V.$set(L);const G={};h&4&&(G.amount=(ge=(ke=i[2])==null?void 0:ke.pollers)==null?void 0:ge.length),D.$set(G);const K={};h&2&&(K.amount=($e=i[1].pendingActivities)==null?void 0:$e.length),H.$set(K)},i(i){Y||(p(s.$$.fragment,i),p(c.$$.fragment,i),p(j.$$.fragment,i),p(O.$$.fragment,i),p(V.$$.fragment,i),p(D.$$.fragment,i),p(H.$$.fragment,i),p(B.$$.fragment,i),p(U.$$.fragment,i),Y=!0)},o(i){d(s.$$.fragment,i),d(c.$$.fragment,i),d(j.$$.fragment,i),d(O.$$.fragment,i),d(V.$$.fragment,i),d(D.$$.fragment,i),d(H.$$.fragment,i),d(B.$$.fragment,i),d(U.$$.fragment,i),Y=!1},d(i){i&&u(e),Q(s),Q(c),Q(j),Q(O),Q(V),Q(D),Q(H),Q(B),Q(U)}}}function $t(r,e,n){let a;Qe(r,nt,l=>n(3,a=l));let{namespace:s}=e,{workflow:t}=e,{workers:o}=e;const f={namespace:s,workflow:t.id,run:t.runId};return r.$$set=l=>{"namespace"in l&&n(0,s=l.namespace),"workflow"in l&&n(1,t=l.workflow),"workers"in l&&n(2,o=l.workers)},[s,t,o,a,f]}class bt extends Z{constructor(e){super(),x(this,e,$t,gt,ee,{namespace:0,workflow:1,workers:2})}}function vt(r){let e,n,a,s;n=new bt({props:{namespace:r[1],workflow:r[0],workers:r[2]}});const t=r[4].default,o=Ve(t,r,r[3],null);return{c(){e=_("main"),T(n.$$.fragment),a=y(),o&&o.c(),this.h()},l(f){e=k(f,"MAIN",{class:!0});var l=$(e);I(n.$$.fragment,l),a=E(l),o&&o.l(l),l.forEach(u),this.h()},h(){w(e,"class","flex flex-col gap-6 h-full")},m(f,l){S(f,e,l),A(n,e,null),m(e,a),o&&o.m(e,null),s=!0},p(f,[l]){const c={};l&2&&(c.namespace=f[1]),l&1&&(c.workflow=f[0]),l&4&&(c.workers=f[2]),n.$set(c),o&&o.p&&(!s||l&8)&&De(o,t,f,f[3],s?Me(t,f[3],l,null):He(f[3]),null)},i(f){s||(p(n.$$.fragment,f),p(o,f),s=!0)},o(f){d(n.$$.fragment,f),d(o,f),s=!1},d(f){f&&u(e),Q(n),o&&o.d(f)}}}const Kt=async function({params:r,fetch:e}){const{workflow:n,run:a,namespace:s}=r,t={namespace:s,workflowId:Ue(n),runId:a},o=await Ye(t,e),{taskQueue:f}=o,l=await st({queue:f,namespace:s});return{props:{workflow:o,namespace:s,workers:l},stuff:{workflow:o,workers:l}}};function Tt(r,e,n){let{$$slots:a={},$$scope:s}=e,{workflow:t}=e,{namespace:o}=e,{workers:f}=e;return r.$$set=l=>{"workflow"in l&&n(0,t=l.workflow),"namespace"in l&&n(1,o=l.namespace),"workers"in l&&n(2,f=l.workers),"$$scope"in l&&n(3,s=l.$$scope)},[t,o,f,s,a]}class Yt extends Z{constructor(e){super(),x(this,e,Tt,vt,ee,{workflow:0,namespace:1,workers:2})}}export{Yt as default,Kt as load};
