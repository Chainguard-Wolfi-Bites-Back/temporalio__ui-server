var O=Object.defineProperty;var T=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var g=(o,n,c)=>n in o?O(o,n,{enumerable:!0,configurable:!0,writable:!0,value:c}):o[n]=c,t=(o,n)=>{for(var c in n||(n={}))S.call(n,c)&&g(o,c,n[c]);if(T)for(var c of T(n))C.call(n,c)&&g(o,c,n[c]);return o};import{w as U}from"./index-c9e619a8.js";import{n as I}from"./notifications-cfed8e58.js";import{i as k}from"./is-network-error-ac7c8caf.js";import{c as _,t as b}from"./route-for-1f2060cd.js";const $=!0,q=U(null),x=o=>{if(F(o)&&$){window.location.assign(_());return}if(N(o)&&$){window.location.assign(_());return}if(k(o))throw I.add("error",`${o.statusCode} ${o.statusText}`),q.set(o),o;typeof o=="string"&&I.add("error",o),o instanceof Error&&I.add("error",o.message)},F=o=>k(o)?o.statusCode===401:!1,N=o=>k(o)?o.statusCode===403:!1,K=o=>typeof o=="function",e=o=>o.message!==void 0&&typeof o.message=="string",B=async(o,n={},c=10)=>{var E;const{params:l={},request:f=fetch,token:w,shouldRetry:h=!1,notifyOnError:A=!0,onError:d,retryInterval:P=5e3}=n;let{options:i}=n;const V=w?{next_page_token:w}:{},y=new URLSearchParams(t(t({},l),V)),v=b(o,y);try{i=D(i),globalThis!=null&&globalThis.AccessToken&&(i.headers=await M(i==null?void 0:i.headers,globalThis.AccessToken));const s=await f(v,i),u=await s.json(),{status:L,statusText:R}=s;if(!s.ok)if(d&&K(d))d({status:L,statusText:R,body:u});else throw{statusCode:s.status,statusText:s.statusText,response:s,message:(E=u==null?void 0:u.message)!=null?E:s.statusText};return u}catch(s){if(A){if(x(s),h&&c>0)return new Promise(u=>{setTimeout(()=>{u(B(o,n,c-1))},P)})}else throw s}},D=o=>{const n=t({credentials:"include"},o);return n.headers=j(o==null?void 0:o.headers),n},M=async(o,n)=>{o||(o={});try{const c=await n();c&&(o.Authorization=`Bearer ${c}`)}catch(c){console.error(c)}return o},j=o=>{o||(o={});const n="_csrf=",c="X-CSRF-TOKEN";try{let f=document.cookie.split(";").find(w=>w.includes(n));f&&!o[c]&&(f=f.trim().slice(n.length),o[c]=f)}catch(l){console.error(l)}return o},z=(o,n)=>o.replace("%namespace%",n),W=o=>{var c;let n="";return((c=globalThis==null?void 0:globalThis.AppConfig)==null?void 0:c.apiUrl)&&o?n=z(globalThis.AppConfig.apiUrl,o):n="",n.endsWith("/")&&(n=n.slice(0,-1)),n},H=(o,n)=>(o.startsWith("/")&&(o=o.slice(1)),`${W(n)}/api/v1/${o}`),X=o=>Object.keys(o!=null?o:{}).reduce((n,c)=>(n[c]=encodeURIComponent(encodeURIComponent(o[c])),n),{namespace:"",workflowId:"",runId:"",queue:""});function m(o,n,c=!0){c&&(n=X(n));const l={cluster:"/cluster",settings:"/settings",user:"/me",namespaces:"/namespaces","task-queue":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}`,workflows:`/namespaces/${n==null?void 0:n.namespace}/workflows`,"workflows.archived":`/namespaces/${n==null?void 0:n.namespace}/workflows/archived`,workflow:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}`,"workflow.terminate":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/terminate`,"events.ascending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/events`,"events.descending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/events/reverse`,query:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/query`};return H(l[o],n==null?void 0:n.namespace)}export{m as a,$ as b,e as c,x as h,K as i,q as n,B as r};
