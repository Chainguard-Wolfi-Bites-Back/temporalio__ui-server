var D=Object.defineProperty,G=Object.defineProperties;var M=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable;var R=(t,i,e)=>i in t?D(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e,v=(t,i)=>{for(var e in i||(i={}))$.call(i,e)&&R(t,e,i[e]);if(O)for(var e of O(i))_.call(i,e)&&R(t,e,i[e]);return t},F=(t,i)=>G(t,M(i));import{aN as K,aO as L}from"./vendor-ff19c65d.js";import{s as m,d as U,a as z}from"./data-converter-config-67b393c3.js";import{a as q}from"./atob-5f9d7101.js";import{f as B}from"./format-date-25613f84.js";const H=(t,i)=>{if(!t)return{hasWebsocket:!1,websocket:null,closeSocket:function(){return null}};try{E=new L(`ws://localhost:${t}/`,v({packMessage:e=>JSON.stringify(e),unpackMessage:e=>JSON.parse(e),attachRequestId:(e,r)=>Object.assign({requestId:r},e),extractRequestId:e=>e&&e.requestId},i)),E.onError(()=>{console.error("A WebSocket error occurred.")})}catch{m()}return E.open(),{hasWebsocket:!0,websocket:E,closeSocket:function(){return E.close()}}};let E=null;var N;const Q=(N=K(U))!=null?N:null,V=H(Q);async function X(t,i){if(!i.isOpened)try{await i.open()}catch{m()}return i.isOpened?i.sendRequest({payload:JSON.stringify(t)}).then(r=>{z();try{return JSON.parse(r.content)}catch{return r.content}}).catch(()=>{m()}):Promise.resolve(t)}function k(t){var e,r;const i=q(String((r=(e=t==null?void 0:t.metadata)==null?void 0:e.encoding)!=null?r:""));switch(t.metadata.encodingDecoded=i,i){case"json/plain":case"json/protobuf":try{return JSON.parse(q(String(t.data)))}catch{}}return t}const Y=async(t,i)=>{var n,a,c,d,u,b,S,p,W,y,g,I;const e=t,r=(d=(c=(n=e==null?void 0:e.input)==null?void 0:n.payloads)!=null?c:(a=e==null?void 0:e.result)==null?void 0:a.payloads)!=null?d:null;if(r){let o;const l=i!=null?i:V;(i==null?void 0:i.hasWebsocket)?o=await Promise.all((r!=null?r:[]).map(async J=>await X(J,l.websocket))):o=r.map(k),((u=e==null?void 0:e.input)==null?void 0:u.payloads)&&(e.input.payloads=o),((b=e==null?void 0:e.result)==null?void 0:b.payloads)&&(e.result.payloads=o)}if((S=e==null?void 0:e.searchAttributes)==null?void 0:S.indexedFields){const o=(p=e==null?void 0:e.searchAttributes)==null?void 0:p.indexedFields;Object.entries(o).forEach(([l,f])=>{o[l]=k(f)})}if((W=e==null?void 0:e.memo)==null?void 0:W.fields){const o=(y=e==null?void 0:e.memo)==null?void 0:y.fields;Object.entries(o).forEach(([l,f])=>{o[l]=k(f)})}if((g=e==null?void 0:e.header)==null?void 0:g.fields){const o=(I=e==null?void 0:e.header)==null?void 0:I.fields;Object.entries(o).forEach(([l,f])=>{o[l]=k(f)})}if(e==null?void 0:e.queryResult){const o=e==null?void 0:e.queryResult;Object.entries(o).forEach(([l,f])=>{o[l]=k(f)})}return e},j=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),Z=["workflowExecutionStartedEventAttributes","workflowExecutionCompletedEventAttributes","workflowExecutionFailedEventAttributes","workflowExecutionTimedOutEventAttributes","workflowTaskStartedEventAttributes","workflowTaskScheduledEventAttributes","workflowTaskCompletedEventAttributes","workflowTaskTimedOutEventAttributes","workflowTaskFailedEventAttributes","activityTaskScheduledEventAttributes","activityTaskCompletedEventAttributes","activityTaskStartedEventAttributes","activityTaskFailedEventAttributes","activityTaskTimedOutEventAttributes","timerStartedEventAttributes","timerFiredEventAttributes","activityTaskCancelRequestedEventAttributes","activityTaskCanceledEventAttributes","timerCanceledEventAttributes","markerRecordedEventAttributes","workflowExecutionSignaledEventAttributes","workflowExecutionTerminatedEventAttributes","workflowExecutionCancelRequestedEventAttributes","workflowExecutionCanceledEventAttributes","requestCancelExternalWorkflowExecutionInitiatedEventAttributes","requestCancelExternalWorkflowExecutionFailedEventAttributes","externalWorkflowExecutionCancelRequestedEventAttributes","workflowExecutionContinuedAsNewEventAttributes","startChildWorkflowExecutionInitiatedEventAttributes","startChildWorkflowExecutionFailedEventAttributes","childWorkflowExecutionStartedEventAttributes","childWorkflowExecutionCompletedEventAttributes","childWorkflowExecutionFailedEventAttributes","childWorkflowExecutionCanceledEventAttributes","childWorkflowExecutionTimedOutEventAttributes","childWorkflowExecutionTerminatedEventAttributes","signalExternalWorkflowExecutionInitiatedEventAttributes","signalExternalWorkflowExecutionFailedEventAttributes","externalWorkflowExecutionSignaledEventAttributes","upsertWorkflowSearchAttributesEventAttributes"],tt=t=>{for(const i of Z)if(i in t)return i},et=(t,i)=>t[i],it=t=>{const i=tt(t),e=et(t,i);return{key:i,attributes:e}},s=t=>i=>Boolean(i[t]),A=s("activityTaskScheduledEventAttributes"),rt=s("activityTaskStartedEventAttributes"),ot=s("activityTaskCompletedEventAttributes"),nt=s("activityTaskFailedEventAttributes"),st=s("activityTaskTimedOutEventAttributes"),T=s("timerStartedEventAttributes"),at=s("timerFiredEventAttributes"),ct=s("activityTaskCancelRequestedEventAttributes"),lt=s("activityTaskCanceledEventAttributes"),dt=s("timerCanceledEventAttributes"),x=s("markerRecordedEventAttributes"),C=s("startChildWorkflowExecutionInitiatedEventAttributes"),ut=s("childWorkflowExecutionStartedEventAttributes"),ft=s("childWorkflowExecutionCompletedEventAttributes"),h=s("signalExternalWorkflowExecutionInitiatedEventAttributes"),P=t=>{if(A(t)||C(t)||T(t)||h(t)||x(t))return t.id;if(rt(t))return String(t.activityTaskStartedEventAttributes.scheduledEventId);if(lt(t))return String(t.activityTaskCanceledEventAttributes.scheduledEventId);if(ct(t))return String(t.activityTaskCancelRequestedEventAttributes.scheduledEventId);if(nt(t))return String(t.activityTaskFailedEventAttributes.scheduledEventId);if(st(t))return String(t.activityTaskTimedOutEventAttributes.scheduledEventId);if(ot(t))return String(t.activityTaskCompletedEventAttributes.scheduledEventId);if(ut(t))return String(t.childWorkflowExecutionStartedEventAttributes.initiatedEventId);if(ft(t))return String(t.childWorkflowExecutionCompletedEventAttributes.initiatedEventId);if(at(t))return String(t.timerFiredEventAttributes.startedEventId);if(dt(t))return String(t.timerCanceledEventAttributes.startedEventId)},Et=t=>{var i,e,r,n,a,c,d,u;if(!!t){if(A(t))return(e=(i=t.activityTaskScheduledEventAttributes)==null?void 0:i.activityType)==null?void 0:e.name;if(T(t))return`Timer ${(r=t.timerStartedEventAttributes)==null?void 0:r.timerId} (${(n=t.timerStartedEventAttributes)==null?void 0:n.startToFireTimeout})`;if(h(t))return`Signal: ${(a=t.signalExternalWorkflowExecutionInitiatedEventAttributes)==null?void 0:a.signalName}`;if(x(t))return`Marker: ${(c=t.markerRecordedEventAttributes)==null?void 0:c.markerName}`;if(C(t))return`Child Workflow: ${(u=(d=t.startChildWorkflowExecutionInitiatedEventAttributes)==null?void 0:d.workflowType)==null?void 0:u.name}`}},w=t=>{const i=P(t),e=Et(t),{timestamp:r,category:n,classification:a}=t,c=t,d=new Map,u=new Set;return d.set(t.id,t),u.add(t.id),{id:i,name:e,events:d,eventIds:u,initialEvent:c,timestamp:r,category:n,classification:a}},kt=t=>{if(A(t)||C(t)||T(t)||h(t)||x(t))return w(t)},wt=(t,i)=>{!t||(t.events.set(i.id,i),t.eventIds.add(i.id),t.timestamp=i.timestamp)},vt=t=>{const i={};for(const e of t){const r=P(e),n=kt(e);n?i[n.id]=n:wt(i[r],e)}return Object.values(i)},Ot=t=>j(t,"events"),mt={ActivityTaskCanceled:"activity",ActivityTaskCancelRequested:"activity",ActivityTaskCompleted:"activity",ActivityTaskFailed:"activity",ActivityTaskScheduled:"activity",ActivityTaskStarted:"activity",ActivityTaskTimedOut:"activity",ChildWorkflowExecutionCanceled:"child-workflow",ChildWorkflowExecutionCompleted:"child-workflow",ChildWorkflowExecutionFailed:"child-workflow",ChildWorkflowExecutionStarted:"child-workflow",ChildWorkflowExecutionTerminated:"child-workflow",ChildWorkflowExecutionTimedOut:"child-workflow",StartChildWorkflowExecutionFailed:"child-workflow",StartChildWorkflowExecutionInitiated:"child-workflow",SignalExternalWorkflowExecutionFailed:"signal",SignalExternalWorkflowExecutionInitiated:"signal",TimerCanceled:"timer",TimerFired:"timer",TimerStarted:"timer",WorkflowExecutionCanceled:"workflow",WorkflowExecutionCancelRequested:"workflow",WorkflowExecutionCompleted:"workflow",WorkflowExecutionContinuedAsNew:"workflow",WorkflowExecutionFailed:"workflow",WorkflowExecutionSignaled:"workflow",WorkflowExecutionStarted:"workflow",WorkflowExecutionTerminated:"workflow",WorkflowExecutionTimedOut:"workflow",WorkflowTaskCompleted:"workflow",WorkflowTaskFailed:"workflow",WorkflowTaskScheduled:"workflow",WorkflowTaskStarted:"workflow",WorkflowTaskTimedOut:"workflow",ExternalWorkflowExecutionCancelRequested:"workflow",ExternalWorkflowExecutionSignaled:"workflow",RequestCancelExternalWorkflowExecutionFailed:"workflow",RequestCancelExternalWorkflowExecutionInitiated:"workflow",MarkerRecorded:"command",UpsertWorkflowSearchAttributes:"command"},At=["activity","child-workflow","signal","timer","workflow","command"],Tt=t=>mt[t],xt=t=>{for(const i of At)if(t===i)return!0;return!1},Rt=(t,i)=>xt(i)?t.filter(e=>e.category===i):t,Ct=["Unspecified","Scheduled","Open","New","Started","Initiated","Running","Completed","Fired","CancelRequested","TimedOut","Signaled","Canceled","Failed","Terminated"],ht=t=>{if(t.includes("RequestCancel"))return"CancelRequested";for(const i of Ct)if(t.includes(i))return i};async function bt(t){const{key:i,attributes:e}=it(t),r=await Y(e);return v({type:i},r)}const St=async t=>{const i=String(t.eventId),e=t.eventType,r=B(String(t.eventTime)),n=ht(e),a=Tt(e),c=await bt(t);return F(v({},t),{attributes:c,eventType:e,classification:n,category:a,id:i,name:e,timestamp:r})},Ft=async t=>{const i=await Promise.all(t.map(St)),e=vt(i);return{events:i,eventGroups:e}},qt=t=>t===null||typeof t!="object"||Array.isArray(t)?!1:!!j(t,"eventType");export{Ot as a,Rt as g,qt as i,Ft as t};
