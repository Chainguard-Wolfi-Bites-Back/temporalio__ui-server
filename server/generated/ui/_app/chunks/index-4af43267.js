var D=Object.defineProperty,G=Object.defineProperties;var M=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var _=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var O=(t,i,e)=>i in t?D(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e,m=(t,i)=>{for(var e in i||(i={}))_.call(i,e)&&O(t,e,i[e]);if(F)for(var e of F(i))K.call(i,e)&&O(t,e,i[e]);return t},q=(t,i)=>G(t,M(i));import{au as L,aQ as U}from"./vendor-d2aeeaa0.js";import{s as A,d as z,a as B}from"./data-converter-config-decf1c06.js";import{a as N}from"./atob-5f9d7101.js";import{f as H}from"./format-date-b97731ae.js";const Q=(t,i)=>{if(!t)return{hasWebsocket:!1,websocket:null,closeSocket:function(){return null}};try{w=new U(`ws://localhost:${t}/`,m({packMessage:e=>JSON.stringify(e),unpackMessage:e=>JSON.parse(e),attachRequestId:(e,r)=>Object.assign({requestId:r},e),extractRequestId:e=>e&&e.requestId},i)),w.onError(()=>{console.error("A WebSocket error occurred.")})}catch{A()}return w.open(),{hasWebsocket:!0,websocket:w,closeSocket:function(){return w.close()}}};let w=null;var j;const V=(j=L(z))!=null?j:null,X=Q(V);async function Y(t,i){if(!i.isOpened)try{await i.open()}catch{A()}return i.isOpened?i.sendRequest({payload:JSON.stringify(t)}).then(r=>{B();try{return JSON.parse(r.content)}catch{return r.content}}).catch(()=>{A()}):Promise.resolve(t)}function v(t){var e,r;const i=N(String((r=(e=t==null?void 0:t.metadata)==null?void 0:e.encoding)!=null?r:""));switch(t.metadata.encodingDecoded=i,i){case"json/plain":case"json/protobuf":try{return JSON.parse(N(String(t.data)))}catch{}}return t}const Z=async(t,i)=>{var s,a,c,d,u,k,p,W,g,y,I,R;const e=t,r=(d=(c=(s=e==null?void 0:e.input)==null?void 0:s.payloads)!=null?c:(a=e==null?void 0:e.result)==null?void 0:a.payloads)!=null?d:null;if(r){let o;const l=i!=null?i:X;(i==null?void 0:i.hasWebsocket)?o=await Promise.all((r!=null?r:[]).map(async $=>await Y($,l.websocket))):o=r.map(v),((u=e==null?void 0:e.input)==null?void 0:u.payloads)&&(e.input.payloads=o),((k=e==null?void 0:e.result)==null?void 0:k.payloads)&&(e.result.payloads=o)}if((p=e==null?void 0:e.searchAttributes)==null?void 0:p.indexedFields){const o=(W=e==null?void 0:e.searchAttributes)==null?void 0:W.indexedFields;Object.entries(o).forEach(([l,f])=>{o[l]=v(f)})}if((g=e==null?void 0:e.memo)==null?void 0:g.fields){const o=(y=e==null?void 0:e.memo)==null?void 0:y.fields;Object.entries(o).forEach(([l,f])=>{o[l]=v(f)})}if((I=e==null?void 0:e.header)==null?void 0:I.fields){const o=(R=e==null?void 0:e.header)==null?void 0:R.fields;Object.entries(o).forEach(([l,f])=>{o[l]=v(f)})}if(e==null?void 0:e.queryResult){const o=e==null?void 0:e.queryResult;Object.entries(o).forEach(([l,f])=>{o[l]=v(f)})}return e},P=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),tt=["workflowExecutionStartedEventAttributes","workflowExecutionCompletedEventAttributes","workflowExecutionFailedEventAttributes","workflowExecutionTimedOutEventAttributes","workflowTaskStartedEventAttributes","workflowTaskScheduledEventAttributes","workflowTaskCompletedEventAttributes","workflowTaskTimedOutEventAttributes","workflowTaskFailedEventAttributes","activityTaskScheduledEventAttributes","activityTaskCompletedEventAttributes","activityTaskStartedEventAttributes","activityTaskFailedEventAttributes","activityTaskTimedOutEventAttributes","timerStartedEventAttributes","timerFiredEventAttributes","activityTaskCancelRequestedEventAttributes","activityTaskCanceledEventAttributes","timerCanceledEventAttributes","markerRecordedEventAttributes","workflowExecutionSignaledEventAttributes","workflowExecutionTerminatedEventAttributes","workflowExecutionCancelRequestedEventAttributes","workflowExecutionCanceledEventAttributes","requestCancelExternalWorkflowExecutionInitiatedEventAttributes","requestCancelExternalWorkflowExecutionFailedEventAttributes","externalWorkflowExecutionCancelRequestedEventAttributes","workflowExecutionContinuedAsNewEventAttributes","startChildWorkflowExecutionInitiatedEventAttributes","startChildWorkflowExecutionFailedEventAttributes","childWorkflowExecutionStartedEventAttributes","childWorkflowExecutionCompletedEventAttributes","childWorkflowExecutionFailedEventAttributes","childWorkflowExecutionCanceledEventAttributes","childWorkflowExecutionTimedOutEventAttributes","childWorkflowExecutionTerminatedEventAttributes","signalExternalWorkflowExecutionInitiatedEventAttributes","signalExternalWorkflowExecutionFailedEventAttributes","externalWorkflowExecutionSignaledEventAttributes","upsertWorkflowSearchAttributesEventAttributes"],et=t=>{for(const i of tt)if(i in t)return i},it=(t,i)=>t[i],rt=t=>{const i=et(t),e=it(t,i);return{key:i,attributes:e}},n=t=>i=>Boolean(i[t]),x=n("activityTaskScheduledEventAttributes"),ot=n("activityTaskStartedEventAttributes"),nt=n("activityTaskCompletedEventAttributes"),st=n("activityTaskFailedEventAttributes"),at=n("activityTaskTimedOutEventAttributes"),T=n("timerStartedEventAttributes"),ct=n("timerFiredEventAttributes"),lt=n("activityTaskCancelRequestedEventAttributes"),dt=n("activityTaskCanceledEventAttributes"),ut=n("timerCanceledEventAttributes"),C=n("markerRecordedEventAttributes"),b=n("workflowExecutionSignaledEventAttributes"),S=n("startChildWorkflowExecutionInitiatedEventAttributes"),ft=n("childWorkflowExecutionStartedEventAttributes"),Et=n("childWorkflowExecutionCompletedEventAttributes"),h=n("signalExternalWorkflowExecutionInitiatedEventAttributes"),J=t=>{if(x(t)||S(t)||T(t)||h(t)||b(t)||C(t))return t.id;if(ot(t))return String(t.activityTaskStartedEventAttributes.scheduledEventId);if(dt(t))return String(t.activityTaskCanceledEventAttributes.scheduledEventId);if(lt(t))return String(t.activityTaskCancelRequestedEventAttributes.scheduledEventId);if(st(t))return String(t.activityTaskFailedEventAttributes.scheduledEventId);if(at(t))return String(t.activityTaskTimedOutEventAttributes.scheduledEventId);if(nt(t))return String(t.activityTaskCompletedEventAttributes.scheduledEventId);if(ft(t))return String(t.childWorkflowExecutionStartedEventAttributes.initiatedEventId);if(Et(t))return String(t.childWorkflowExecutionCompletedEventAttributes.initiatedEventId);if(ct(t))return String(t.timerFiredEventAttributes.startedEventId);if(ut(t))return String(t.timerCanceledEventAttributes.startedEventId)},kt=t=>{var i,e,r,s,a,c,d,u,k;if(!!t){if(x(t))return(e=(i=t.activityTaskScheduledEventAttributes)==null?void 0:i.activityType)==null?void 0:e.name;if(T(t))return`Timer ${(r=t.timerStartedEventAttributes)==null?void 0:r.timerId} (${(s=t.timerStartedEventAttributes)==null?void 0:s.startToFireTimeout})`;if(h(t))return`Signal: ${(a=t.signalExternalWorkflowExecutionInitiatedEventAttributes)==null?void 0:a.signalName}`;if(b(t))return`Signal received: ${(c=t.workflowExecutionSignaledEventAttributes)==null?void 0:c.signalName}`;if(C(t))return`Marker: ${(d=t.markerRecordedEventAttributes)==null?void 0:d.markerName}`;if(S(t))return`Child Workflow: ${(k=(u=t.startChildWorkflowExecutionInitiatedEventAttributes)==null?void 0:u.workflowType)==null?void 0:k.name}`}},E=t=>{const i=J(t),e=kt(t),{timestamp:r,category:s,classification:a}=t,c=t,d=new Map,u=new Set;return d.set(t.id,t),u.add(t.id),{id:i,name:e,events:d,eventIds:u,initialEvent:c,timestamp:r,category:s,classification:a}},wt=t=>{if(x(t)||S(t)||T(t)||h(t)||b(t)||C(t))return E(t)},vt=(t,i)=>{!t||(t.events.set(i.id,i),t.eventIds.add(i.id),t.timestamp=i.timestamp)},mt=t=>{const i={};for(const e of t){const r=J(e),s=wt(e);s?i[s.id]=s:vt(i[r],e)}return Object.values(i)},Ft=t=>P(t,"events"),At={ActivityTaskCanceled:"activity",ActivityTaskCancelRequested:"activity",ActivityTaskCompleted:"activity",ActivityTaskFailed:"activity",ActivityTaskScheduled:"activity",ActivityTaskStarted:"activity",ActivityTaskTimedOut:"activity",ChildWorkflowExecutionCanceled:"child-workflow",ChildWorkflowExecutionCompleted:"child-workflow",ChildWorkflowExecutionFailed:"child-workflow",ChildWorkflowExecutionStarted:"child-workflow",ChildWorkflowExecutionTerminated:"child-workflow",ChildWorkflowExecutionTimedOut:"child-workflow",StartChildWorkflowExecutionFailed:"child-workflow",StartChildWorkflowExecutionInitiated:"child-workflow",SignalExternalWorkflowExecutionFailed:"signal",SignalExternalWorkflowExecutionInitiated:"signal",WorkflowExecutionSignaled:"signal",TimerCanceled:"timer",TimerFired:"timer",TimerStarted:"timer",WorkflowExecutionCanceled:"workflow",WorkflowExecutionCancelRequested:"workflow",WorkflowExecutionCompleted:"workflow",WorkflowExecutionContinuedAsNew:"workflow",WorkflowExecutionFailed:"workflow",WorkflowExecutionStarted:"workflow",WorkflowExecutionTerminated:"workflow",WorkflowExecutionTimedOut:"workflow",WorkflowTaskCompleted:"workflow",WorkflowTaskFailed:"workflow",WorkflowTaskScheduled:"workflow",WorkflowTaskStarted:"workflow",WorkflowTaskTimedOut:"workflow",ExternalWorkflowExecutionCancelRequested:"workflow",ExternalWorkflowExecutionSignaled:"workflow",RequestCancelExternalWorkflowExecutionFailed:"workflow",RequestCancelExternalWorkflowExecutionInitiated:"workflow",MarkerRecorded:"command",UpsertWorkflowSearchAttributes:"command"},xt=["activity","child-workflow","signal","timer","workflow","command"],Tt=t=>At[t],Ct=t=>{for(const i of xt)if(t===i)return!0;return!1},Ot=(t,i)=>Ct(i)?t.filter(e=>e.category===i):t,bt=["Unspecified","Scheduled","Open","New","Started","Initiated","Running","Completed","Fired","CancelRequested","TimedOut","Signaled","Canceled","Failed","Terminated"],St=t=>{if(t.includes("RequestCancel"))return"CancelRequested";for(const i of bt)if(t.includes(i))return i};async function ht(t){const{key:i,attributes:e}=rt(t),r=await Z(e);return m({type:i},r)}const pt=async t=>{const i=String(t.eventId),e=t.eventType,r=H(String(t.eventTime)),s=St(e),a=Tt(e),c=await ht(t);return q(m({},t),{attributes:c,eventType:e,classification:s,category:a,id:i,name:e,timestamp:r})},qt=async t=>{const i=await Promise.all(t.map(pt)),e=mt(i);return{events:i,eventGroups:e}},Nt=t=>t===null||typeof t!="object"||Array.isArray(t)?!1:!!P(t,"eventType");export{Ft as a,Ot as g,Nt as i,qt as t};
