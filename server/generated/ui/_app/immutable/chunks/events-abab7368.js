import{d as o,r as y,w as p}from"./index-8c6be68a.js";import{p as c}from"./stores-5674b937.js";import{p as k}from"./paginated-ecb0f58e.js";import{r as b,a as E}from"./route-for-api-cb3151e3.js";import{t as I,g as h}from"./index-f415d6e5.js";import{b as G}from"./is-b4c8f655.js";import{a as d,d as i}from"./event-view-8263e942.js";import{g as m}from"./route-for-198cbbe1.js";import{w as S,d as T}from"./with-loading-f07bedaf.js";import{r as v,p as _}from"./previous-events-31f27496.js";import{a as q}from"./auth-user-8d8472d7.js";import{a7 as F}from"./index-0b369c75.js";const P=e=>!G(e)||e==="descending"?"events.descending":e==="ascending"?"events.ascending":"events.descending",H=async({namespace:e,workflowId:t,runId:s,sort:r,onStart:n,onUpdate:a,onComplete:f})=>{const l=P(r),g=await b(l,{namespace:e,workflowId:t,runId:s});return(await k(async w=>E(g,{token:w,request:fetch}),{onStart:n,onUpdate:a,onComplete:f})).history.events},R=async e=>{const{settings:t,namespace:s,accessToken:r}=e;return H(e).then(n=>I({response:n,namespace:s,settings:t,accessToken:r}))},A={events:[],eventGroups:[]},O=o([c],([e])=>e.params.namespace?m(e.params.namespace):""),j=o([c],([e])=>e.params.workflow?m(e.params.workflow):""),x=o([c],([e])=>e.params.run?m(e.params.run):""),C=o([c],([e])=>e.stuff.settings),L=o([q],([e])=>e==null?void 0:e.accessToken),N=(e,t)=>{for(const n of["namespace","workflowId","runId"])if(!e[n])return!1;let s=!0;const r=F(t);for(const n of Object.keys(r))if(r[n]!==e[n]){s=!1;break}return s?!1:(t.set(e),!0)},W=o([O,j,x,d],([e,t,s,r])=>({namespace:e,workflowId:t,runId:s,sort:r})),z=o([W,C,L,v],([e,t,s,r])=>({...e,settings:t,accessToken:s,refresh:v,$refresh:r})),B=e=>z.subscribe(async t=>{const{settings:s,...r}=t;N(r,_)&&S(K,J,async()=>{var a;const n=await R(t);(a=n==null?void 0:n.events)!=null&&a.length?e(n):setTimeout(()=>{e(n)},T)})}),u=y(A,B),D=p(null),oe=o([u,i,D],([e,t,s])=>{if(s)return s;const{events:r}=e;return t?r.filter(n=>n.category===t):r}),ae=o([u,i],([e,t])=>{const{eventGroups:s}=e;return t?s.filter(r=>r.category===t):s}),ce=o([u,d,i],([e,t,s])=>{const{events:r}=e,n=t==="descending"?r.slice().reverse():r,a=h(n);return s?a.filter(f=>f.category===s):a});o([u,d,i],([e,t,s])=>{const{events:r}=e,n=t==="descending"?r.slice().reverse():r;return s?n.filter(a=>a.category===s):n});const J=p(!0),K=p(!0);export{oe as a,u as b,ce as c,ae as e,H as f,K as l,D as t,J as u};
