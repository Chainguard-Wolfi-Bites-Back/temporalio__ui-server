import{a7 as C,F as w}from"./index-92fe1086.js";import{s as P}from"./settings-094bc836.js";import{s as p}from"./simplify-attributes-e9cbffa0.js";import{r as d,a as f,b as F,i as D,c as z}from"./route-for-api-31ba547b.js";import{h as K,j as Q,k as b,l as N}from"./format-time-63ab2d37.js";const O=(t=P)=>!C(t).disableWriteActions,j=(t=[])=>t.map(o=>{const n=p(o,!0),r=o.activityId;return{...n,id:r}}),y=t=>{var x,T,I,A,W,S;const o=t.workflowExecutionInfo.type.name,n=t.workflowExecutionInfo.execution.workflowId,r=t.workflowExecutionInfo.execution.runId,i=String(t.workflowExecutionInfo.startTime),c=String(t.workflowExecutionInfo.closeTime),a=t.workflowExecutionInfo.status,s=t.workflowExecutionInfo.status==="Running",u=t.workflowExecutionInfo.historyLength,l=`/workflows/${n}/${r}`,g=(T=(x=t==null?void 0:t.executionConfig)==null?void 0:x.taskQueue)==null?void 0:T.name,k=(I=t==null?void 0:t.workflowExecutionInfo)==null?void 0:I.parentNamespaceId,e=(A=t==null?void 0:t.workflowExecutionInfo)==null?void 0:A.parentExecution,m=t.workflowExecutionInfo.stateTransitionCount,h=(W=t.executionConfig)==null?void 0:W.defaultWorkflowTaskTimeout,E=j(t.pendingActivities),$=(S=t==null?void 0:t.pendingChildren)!=null?S:[];return{name:o,id:n,runId:r,startTime:i,endTime:c,status:a,historyEvents:u,url:l,taskQueue:g,pendingActivities:E,pendingChildren:$,parentNamespaceId:k,parent:e,stateTransitionCount:m,isRunning:s,defaultWorkflowTaskTimeout:h,get canBeTerminated(){return s&&O()}}},q=t=>(t.executions||[]).map(o=>y({workflowExecutionInfo:o})),B={workflowId:"WorkflowId",workflowType:"WorkflowType",timeRange:"StartTime",executionStatus:"ExecutionStatus",closeTime:"CloseTime"},R=["workflowId","workflowType","timeRange","executionStatus","closeTime"],U=t=>!(t===null||t===void 0||t===""||typeof t=="string"&&t==="undefined"),L=t=>{if(typeof t!="string")return!1;for(const o of R)if(o===t)return!0;return!1},_=(t,o,n)=>{const r=B[t];return o==="All"?"":K(o)||Q(o)?n?`${r} > "${b(o)}"`:`${r} BETWEEN "${b(o)}" AND "${N()}"`:`${r}="${o}"`},V=(t,o)=>Object.entries(t).map(([n,r])=>{if(L(n)&&U(r))return _(n,r,o)}).filter(Boolean),G=(t,o=!1)=>V(t,o).join(" and "),v=async(t,o,n=fetch)=>{let r=0,i=0;try{const c=await d("workflows.count",{namespace:t});if(o){const a=f(c,{params:{query:o},onError:w,handleError:w,request:n}),s=f(c,{params:{query:""},onError:w,handleError:w,request:n}),[u,l]=await Promise.all([a,s]);i=u==null?void 0:u.count,r=l==null?void 0:l.count}else{const a=await f(c,{params:{},onError:w,handleError:w,request:n});r=a==null?void 0:a.count}}catch{}return{count:i,totalCount:r}},H=async(t,o,n=fetch,r=!1)=>{var k;const i=decodeURIComponent(o.query||G(o,r)),c=r?"workflows.archived":"workflows";let a="";const s=e=>{var m,h,E;F(e),((m=e==null?void 0:e.body)==null?void 0:m.message)||(e==null?void 0:e.status)?a=(E=(h=e==null?void 0:e.body)==null?void 0:h.message)!=null?E:`Error fetching workflows: ${e.status}: ${e.statusText}`:a="Error fetching workflows: Server failed to respond"},u=await d(c,{namespace:t}),{executions:l,nextPageToken:g}=(k=await f(u,{params:{query:i},onError:s,handleError:s,request:n}))!=null?k:{executions:[],nextPageToken:""};return{workflows:q({executions:l}),nextPageToken:String(g),error:a}},tt=async(t,o=fetch,n=!1)=>{const r=n?"workflows.archived":"workflows";let i=!0;const c=s=>{(D(s)||z(s))&&(i=!1)},a=await d(r,{namespace:t});return await f(a,{params:{pageSize:"1"},onError:c,handleError:c,request:o}),{authorized:i}},ot=async(t,o,n=fetch)=>H(t,o,n,!0);async function nt(t,o=fetch){const n=await d("workflow",t);return f(n,{request:o}).then(y)}const rt=async({namespace:t,workflowId:o,runId:n},r=fetch)=>{const i=await d("workflow.cancel",{namespace:t,workflowId:o,runId:n});return f(i,{request:r,notifyOnError:!1,options:{method:"POST"}})};async function et(t,o=fetch){const n=i=>{console.error(i)},r=await d("workflow",t);return f(r,{request:o,onError:n,handleError:n}).then(y)}export{H as a,v as b,rt as c,tt as d,ot as e,nt as f,et as g,G as t,O as w};
