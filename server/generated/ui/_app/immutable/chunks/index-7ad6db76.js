import{a6 as l}from"./index-8e660855.js";import{d as u}from"./is-http-3997fe58.js";import{c as v,a as y,d as b}from"./decode-payload-10bb3631.js";import{f as C}from"./format-date-2e95557a.js";import{g as A,f as g}from"./index-9319d41b.js";import{g as T}from"./get-event-categorization-2cfb578f.js";import{s as w}from"./simplify-attributes-34cbbe81.js";const E=["Unspecified","Scheduled","Open","New","Started","Initiated","Running","Completed","Fired","CancelRequested","TimedOut","Signaled","Canceled","Failed","Terminated"],S=t=>{if(t.includes("RequestCancel"))return"CancelRequested";for(const o of E)if(t.includes(o))return o},P=(t,o=u)=>{var e;return l(o)||((e=t==null?void 0:t.codec)==null?void 0:e.endpoint)||""};async function R({historyEvent:t,namespace:o,settings:e},{convertWithCodec:a=v,convertWithWebsocket:n=y,decodeAttributes:c=b,encoderEndpoint:s=u}={}){const{key:d,attributes:i}=g(t),r=P(e,s),m={...e,codec:{...e==null?void 0:e.codec,endpoint:r}},f=r?await a({attributes:i,namespace:o,settings:m}):await n(i),p=c(f);return{type:d,...p}}const q=async({historyEvent:t,namespace:o,settings:e})=>{const a=String(t.eventId),n=t.eventType,c=C(String(t.eventTime)),s=S(n),d=T(n),i=await R({historyEvent:t,namespace:o,settings:e}).then(r=>w(r));return{...t,attributes:i,eventType:n,classification:s,category:d,id:a,name:n,timestamp:c}},x=async({response:t,namespace:o,settings:e})=>{const a=await Promise.all(t.map(c=>q({historyEvent:c,namespace:o,settings:e}))),n=A(a);return{events:a,eventGroups:n}};export{x as t};
