import{c as L,p as M}from"./is-http-ad557a83.js";import{g as $,a as D,c as P,b as K,d as _}from"./get-codec-02146431.js";import{f as J}from"./format-date-e74858c6.js";import{h as U}from"./has-68876cdc.js";import{s as j}from"./simplify-attributes-e2395256.js";const z=["workflowExecutionStartedEventAttributes","workflowExecutionCompletedEventAttributes","workflowExecutionFailedEventAttributes","workflowExecutionTimedOutEventAttributes","workflowTaskStartedEventAttributes","workflowTaskScheduledEventAttributes","workflowTaskCompletedEventAttributes","workflowTaskTimedOutEventAttributes","workflowTaskFailedEventAttributes","activityTaskScheduledEventAttributes","activityTaskCompletedEventAttributes","activityTaskStartedEventAttributes","activityTaskFailedEventAttributes","activityTaskTimedOutEventAttributes","timerStartedEventAttributes","timerFiredEventAttributes","activityTaskCancelRequestedEventAttributes","activityTaskCanceledEventAttributes","timerCanceledEventAttributes","markerRecordedEventAttributes","workflowExecutionSignaledEventAttributes","workflowExecutionTerminatedEventAttributes","workflowExecutionCancelRequestedEventAttributes","workflowExecutionCanceledEventAttributes","requestCancelExternalWorkflowExecutionInitiatedEventAttributes","requestCancelExternalWorkflowExecutionFailedEventAttributes","externalWorkflowExecutionCancelRequestedEventAttributes","workflowExecutionContinuedAsNewEventAttributes","startChildWorkflowExecutionInitiatedEventAttributes","startChildWorkflowExecutionFailedEventAttributes","childWorkflowExecutionStartedEventAttributes","childWorkflowExecutionCompletedEventAttributes","childWorkflowExecutionFailedEventAttributes","childWorkflowExecutionCanceledEventAttributes","childWorkflowExecutionTimedOutEventAttributes","childWorkflowExecutionTerminatedEventAttributes","signalExternalWorkflowExecutionInitiatedEventAttributes","signalExternalWorkflowExecutionFailedEventAttributes","externalWorkflowExecutionSignaledEventAttributes","upsertWorkflowSearchAttributesEventAttributes"],H=t=>{for(const e of z)if(e in t)return e},Q=(t,e)=>t[e],V=t=>{const e=H(t),o=Q(t,e);return{key:e,attributes:o}},i=t=>e=>Boolean(e[t]),It=i("workflowExecutionCompletedEventAttributes"),X=i("workflowExecutionFailedEventAttributes"),Y=i("workflowExecutionTimedOutEventAttributes"),Z=i("workflowTaskTimedOutEventAttributes"),tt=i("workflowTaskFailedEventAttributes"),m=i("activityTaskScheduledEventAttributes"),et=i("activityTaskStartedEventAttributes"),it=i("activityTaskCompletedEventAttributes"),A=i("activityTaskFailedEventAttributes"),b=i("activityTaskTimedOutEventAttributes"),T=i("timerStartedEventAttributes"),ot=i("timerFiredEventAttributes"),rt=i("activityTaskCancelRequestedEventAttributes"),x=i("activityTaskCanceledEventAttributes"),C=i("timerCanceledEventAttributes"),k=i("markerRecordedEventAttributes"),W=i("workflowExecutionSignaledEventAttributes"),nt=i("workflowExecutionTerminatedEventAttributes"),st=i("workflowExecutionCanceledEventAttributes"),y=i("startChildWorkflowExecutionInitiatedEventAttributes"),at=i("childWorkflowExecutionStartedEventAttributes"),lt=i("childWorkflowExecutionCompletedEventAttributes"),ct=i("childWorkflowExecutionFailedEventAttributes"),dt=i("childWorkflowExecutionCanceledEventAttributes"),ut=i("childWorkflowExecutionTimedOutEventAttributes"),h=i("childWorkflowExecutionTerminatedEventAttributes"),p=i("signalExternalWorkflowExecutionInitiatedEventAttributes"),Et=i("signalExternalWorkflowExecutionFailedEventAttributes"),S=t=>{var o,n,r,s,a,c;const e=(s=(r=(n=(o=t==null?void 0:t.markerRecordedEventAttributes)==null?void 0:o.details)==null?void 0:n.data)==null?void 0:r.payloads)==null?void 0:s[0];return k(t)&&((a=t==null?void 0:t.markerRecordedEventAttributes)==null?void 0:a.markerName)==="LocalActivity"&&Boolean((c=e==null?void 0:e.ActivityType)!=null?c:e==null?void 0:e.activity_type)},g=t=>b(t)||A(t)||X(t)||Y(t)||Z(t)||tt(t)||ct(t)||ut(t)||Et(t),Ot=t=>f(t)?t.isFailureOrTimedOut:g(t),F=t=>x(t)||C(t)||st(t)||dt(t),Rt=t=>f(t)?t.isCanceled:F(t),I=t=>nt(t)||h(t),qt=t=>f(t)?t.isTerminated:I(t),O=t=>et(t)?String(t.activityTaskStartedEventAttributes.scheduledEventId):x(t)?String(t.activityTaskCanceledEventAttributes.scheduledEventId):rt(t)?String(t.activityTaskCancelRequestedEventAttributes.scheduledEventId):A(t)?String(t.activityTaskFailedEventAttributes.scheduledEventId):b(t)?String(t.activityTaskTimedOutEventAttributes.scheduledEventId):it(t)?String(t.activityTaskCompletedEventAttributes.scheduledEventId):at(t)?String(t.childWorkflowExecutionStartedEventAttributes.initiatedEventId):h(t)?String(t.childWorkflowExecutionTerminatedEventAttributes.initiatedEventId):lt(t)?String(t.childWorkflowExecutionCompletedEventAttributes.initiatedEventId):ot(t)?String(t.timerFiredEventAttributes.startedEventId):C(t)?String(t.timerCanceledEventAttributes.startedEventId):t.id,kt=t=>{var e,o,n,r,s,a,c,d,l;if(!!t){if(m(t))return(o=(e=t.activityTaskScheduledEventAttributes)==null?void 0:e.activityType)==null?void 0:o.name;if(T(t))return`Timer ${(n=t.timerStartedEventAttributes)==null?void 0:n.timerId} (${(r=t.timerStartedEventAttributes)==null?void 0:r.startToFireTimeout})`;if(p(t))return`Signal: ${(s=t.signalExternalWorkflowExecutionInitiatedEventAttributes)==null?void 0:s.signalName}`;if(W(t))return`Signal received: ${(a=t.workflowExecutionSignaledEventAttributes)==null?void 0:a.signalName}`;if(k(t))return S(t)?"Local Activity":`Marker: ${(c=t.markerRecordedEventAttributes)==null?void 0:c.markerName}`;if(y(t))return`Child Workflow: ${(l=(d=t.startChildWorkflowExecutionInitiatedEventAttributes)==null?void 0:d.workflowType)==null?void 0:l.name}`}},v=({events:t})=>{let e=0,o;for(const n of t.values()){const r=Number(n.id);r>=e&&(e=r,o=n)}return o},u=t=>{const e=O(t),o=kt(t),{timestamp:n,category:r,classification:s}=t,a=t,c=new Map,d=new Set;return c.set(t.id,t),d.add(t.id),{id:e,name:o,events:c,eventIds:d,initialEvent:a,timestamp:n,category:r,classification:s,get eventTime(){var l;return(l=this.lastEvent)==null?void 0:l.eventTime},get attributes(){var l;return(l=v(this))==null?void 0:l.attributes},get eventList(){return Array.from(this.events,([l,E])=>E)},get lastEvent(){return v(this)},get isFailureOrTimedOut(){return Boolean(this.eventList.find(g))},get isCanceled(){return Boolean(this.eventList.find(F))},get isTerminated(){return Boolean(this.eventList.find(I))}}},ft=t=>{if(m(t)||y(t)||T(t)||p(t)||W(t))return u(t);if(k(t))return S(t),u(t)},wt=(t,e)=>{!t||(t.events.set(e.id,e),t.eventIds.add(e.id),t.timestamp=e.timestamp)},vt=t=>{const e={};for(const o of t){const n=O(o),r=ft(o);r?e[r.id]=r:wt(e[n],o)}return Object.values(e)},f=t=>t==null?!1:U(t,"events"),mt={ActivityTaskCanceled:"activity",ActivityTaskCancelRequested:"activity",ActivityTaskCompleted:"activity",ActivityTaskFailed:"activity",ActivityTaskScheduled:"activity",ActivityTaskStarted:"activity",ActivityTaskTimedOut:"activity",ChildWorkflowExecutionCanceled:"child-workflow",ChildWorkflowExecutionCompleted:"child-workflow",ChildWorkflowExecutionFailed:"child-workflow",ChildWorkflowExecutionStarted:"child-workflow",ChildWorkflowExecutionTerminated:"child-workflow",ChildWorkflowExecutionTimedOut:"child-workflow",StartChildWorkflowExecutionFailed:"child-workflow",StartChildWorkflowExecutionInitiated:"child-workflow",MarkerRecorded:"marker",SignalExternalWorkflowExecutionFailed:"signal",SignalExternalWorkflowExecutionInitiated:"signal",WorkflowExecutionSignaled:"signal",TimerCanceled:"timer",TimerFired:"timer",TimerStarted:"timer",WorkflowExecutionCanceled:"workflow",WorkflowExecutionCancelRequested:"workflow",WorkflowExecutionCompleted:"workflow",WorkflowExecutionContinuedAsNew:"workflow",WorkflowExecutionFailed:"workflow",WorkflowExecutionStarted:"workflow",WorkflowExecutionTerminated:"workflow",WorkflowExecutionTimedOut:"workflow",WorkflowTaskCompleted:"workflow",WorkflowTaskFailed:"workflow",WorkflowTaskScheduled:"workflow",WorkflowTaskStarted:"workflow",WorkflowTaskTimedOut:"workflow",ExternalWorkflowExecutionCancelRequested:"workflow",ExternalWorkflowExecutionSignaled:"workflow",RequestCancelExternalWorkflowExecutionFailed:"workflow",RequestCancelExternalWorkflowExecutionInitiated:"workflow",UpsertWorkflowSearchAttributes:"command"},R=[{label:"All",option:void 0},{label:"Activity",option:"activity",color:"#8B5CF6"},{label:"Child Workflow",option:"child-workflow",color:"#F59E0B"},{label:"Command",option:"command",color:"#10B981"},{label:"Marker",option:"marker",color:"#EC4899"},{label:"Signal",option:"signal",color:"#DD6B20"},{label:"Timer",option:"timer",color:"#1D4ED8"},{label:"Workflow",option:"workflow",color:"#10B981"}],At=[void 0,"activity","signal","timer"],Bt=R.filter(({option:t})=>At.includes(t)),bt=["activity","child-workflow","command","marker","signal","timer"];R.filter(({option:t})=>bt.includes(t));const Tt=t=>mt[t],xt=["Unspecified","Scheduled","Open","New","Started","Initiated","Running","Completed","Fired","CancelRequested","TimedOut","Signaled","Canceled","Failed","Terminated"],Ct=t=>{if(t.includes("RequestCancel"))return"CancelRequested";for(const e of xt)if(t.includes(e))return e};async function Wt({historyEvent:t,namespace:e,settings:o,accessToken:n},{convertWithCodec:r=P,convertWithWebsocket:s=K,decodeAttributes:a=_,encoderEndpoint:c=L,codecPassAccessToken:d=M}={}){const{key:l,attributes:E}=V(t),w=$(o,c),q=D(o,d),B={...o,codec:{...o==null?void 0:o.codec,endpoint:w,passAccessToken:q}},N=w?await r({attributes:E,namespace:e,settings:B,accessToken:n}):await s(E),G=a(N);return{type:l,...G}}const yt=async({historyEvent:t,namespace:e,settings:o,accessToken:n})=>{const r=String(t.eventId),s=t.eventType,a=J(String(t.eventTime)),c=Ct(s),d=Tt(s),l=await Wt({historyEvent:t,namespace:e,settings:o,accessToken:n}).then(E=>j(E));return{...t,attributes:l,eventType:s,classification:c,category:d,id:r,name:s,timestamp:a}},Nt=async({response:t,namespace:e,settings:o,accessToken:n})=>{const r=await Promise.all(t.map(a=>yt({historyEvent:a,namespace:e,settings:o,accessToken:n}))),s=vt(r);return{events:r,eventGroups:s}};export{R as a,Rt as b,Bt as c,qt as d,Ot as e,f,vt as g,It as h,S as i,Nt as t};
