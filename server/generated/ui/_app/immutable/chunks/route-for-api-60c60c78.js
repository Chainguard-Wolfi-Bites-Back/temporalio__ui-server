import{e as k,b as l,t as P,p as O}from"./route-for-8f480fc8.js";import{g}from"./auth-user-8d8472d7.js";import{F as z}from"./index-0b369c75.js";import{w as N}from"./index-8c6be68a.js";import{n as W}from"./notifications-64e4d8bf.js";import{i as L}from"./is-network-error-5f9e2367.js";import{i as S}from"./persist-store-35c981b5.js";const _=N(null),G=(c,n=W,s=_,i=l)=>{if(y(c)&&i){window.location.assign(k(c==null?void 0:c.message));return}if(A(c)&&i){window.location.assign(k(c==null?void 0:c.message));return}if(L(c))throw n.add("error",`${c.statusCode} ${c.statusText}`),s.set(c),c;typeof c=="string"&&n.add("error",c),c instanceof Error&&n.add("error",c.message)},nn=(c,n=l)=>{var i;const s=`${c==null?void 0:c.status} ${(i=c==null?void 0:c.body)==null?void 0:i.message}`;if(y(c)&&n){window.location.assign(k(s));return}if(A(c)&&n){window.location.assign(k(s));return}},y=c=>(c==null?void 0:c.statusCode)===401||(c==null?void 0:c.status)===401,A=c=>(c==null?void 0:c.statusCode)===403||(c==null?void 0:c.status)===403,cn=c=>(c==null?void 0:c.message)!==void 0&&typeof(c==null?void 0:c.message)=="string",H=async(c,n={},s=10)=>{var b;const{params:i={},request:w=fetch,token:o,shouldRetry:d=!1,notifyOnError:E=!0,handleError:U=G,onRetry:v=z,onError:$,retryInterval:q=5e3,isBrowser:I=l}=n;let{options:t}=n;const x=o?{next_page_token:o}:{},C=new URLSearchParams({...i,...x}),R=P(c,C);try{t=K(t,I),t=await X(t,I);const u=await w(R,t),f=await u.json(),{status:h,statusText:F}=u;if(!u.ok)if($&&S($))$({status:h,statusText:F,body:f});else throw{statusCode:u.status,statusText:u.statusText,response:u,message:(b=f==null?void 0:f.message)!=null?b:u.statusText};return f}catch(u){if(E){if(U(u),d&&s>0)return new Promise(f=>{const h=s-1;v(h),setTimeout(()=>{f(H(c,n,h))},q)})}else throw u}},K=(c,n=l)=>{const s={credentials:"include",...c};return s.headers=D(c==null?void 0:c.headers,n),s},X=async(c,n=l)=>(g().accessToken?(c.headers=await T(c==null?void 0:c.headers,async()=>g().accessToken,n),c.headers=B(c==null?void 0:c.headers,g().idToken,n)):globalThis!=null&&globalThis.AccessToken&&(c.headers=await T(c==null?void 0:c.headers,globalThis.AccessToken,n)),c),T=async(c,n,s=l)=>{if(c||(c={}),!s)return c;try{const i=await n();i&&(c.Authorization=`Bearer ${i}`)}catch(i){console.error(i)}return c},B=(c={},n,s=l)=>(s&&n&&(c["Authorization-Extras"]=n),c),D=(c,n=l)=>{if(c||(c={}),!n)return c;const s="_csrf=",i="X-CSRF-TOKEN";try{let o=document.cookie.split(";").find(d=>d.includes(s));o&&!c[i]&&(o=o.trim().slice(s.length),c[i]=o)}catch(w){console.error(w)}return c};function J(c=l){const n="",s=!n.startsWith("http");let i="";return s?i=c?window.location.origin+n:"":i=n,i.endsWith("/")&&(i=i.slice(0,-1)),i}const M=(c,n)=>c?c.replace("%namespace%",n):"",Q=async c=>{var s,i;let n="";if((globalThis==null?void 0:globalThis.GetNamespaces)&&c){const w=await globalThis.GetNamespaces(),o=w==null?void 0:w.find(d=>d.namespace===c);n=(i=o==null?void 0:o.webUri)!=null?i:M((s=globalThis==null?void 0:globalThis.AppConfig)==null?void 0:s.apiUrl,c)}else n=J();return n.endsWith("/")&&(n=n.slice(0,-1)),n=`${n}${O}`,n},V=async(c,n)=>(c.startsWith("/")&&(c=c.slice(1)),`${await Q(n)}/api/v1/${c}`),Y=c=>Object.keys(c!=null?c:{}).reduce((n,s)=>(n[s]=encodeURIComponent(encodeURIComponent(c[s])),n),{namespace:"",workflowId:"",scheduleId:"",runId:"",queue:""});function sn(c,n,s=!0){s&&(n=Y(n));const i={cluster:"/cluster","events.ascending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/events`,"events.descending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/events/reverse`,namespaces:"/namespaces",namespace:`/namespaces/${n==null?void 0:n.namespace}`,query:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/query`,"schedule.delete":`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}`,schedule:`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}`,schedules:`/namespaces/${n==null?void 0:n.namespace}/schedules`,"search-attributes":"/search-attributes",settings:"/settings","task-queue":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}`,user:"/me","workflow.terminate":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/terminate`,"workflow.cancel":`/namespaces/${n.namespace}/workflows/${n.workflowId}/runs/${n.runId}/cancel`,workflow:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}`,"workflows.archived":`/namespaces/${n==null?void 0:n.namespace}/workflows/archived`,workflows:`/namespaces/${n==null?void 0:n.namespace}/workflows`,"workflows.count":`/namespaces/${n==null?void 0:n.namespace}/workflows/count`,"batch-operations":`/namespaces/${n.namespace}/batch-operations`,"batch-operation.describe":`/namespaces/${n.namespace}/batch-operations/describe`,"workflows.batch.terminate":`/namespaces/${n.namespace}/workflows/batch/terminate`,"workflows.batch.describe":`/namespaces/${n.namespace}/workflows/batch/describe`};return V(i[c],n==null?void 0:n.namespace)}export{H as a,nn as b,A as c,cn as d,J as g,G as h,y as i,_ as n,sn as r};
