import{d as i,r as g,w as u}from"./index-8c6be68a.js";import{p as l}from"./stores-5674b937.js";import{w as A}from"./with-loading-f07bedaf.js";import{f as y}from"./workflow-service-82cd2181.js";import{g as b}from"./pollers-service-804671ff.js";import{g as k}from"./route-for-198cbbe1.js";import{c as P}from"./is-http-ad557a83.js";import{g as T,c as W,b as I,d as h}from"./get-codec-02146431.js";import{a as R}from"./auth-user-8d8472d7.js";async function E({activity:t,namespace:e,settings:o,accessToken:s},{convertWithCodec:c=W,convertWithWebsocket:a=I,decodeAttributes:n=h,encoderEndpoint:d=P}={}){const r=T(o,d),v={...o,codec:{...o==null?void 0:o.codec,endpoint:r}},w=r?await c({attributes:t,namespace:e,settings:v,accessToken:s}):await a(t);return n(w)}const C=async({activity:t,namespace:e,settings:o,accessToken:s})=>await E({activity:t,namespace:e,settings:o,accessToken:s}),J=async(t,e,o,s)=>{var n;const c=(n=t==null?void 0:t.pendingActivities)!=null?n:[],a=[];for(const d of c){const r=await C({activity:d,namespace:e,settings:o,accessToken:s});a.push(r)}return a},q=u(0),x=i([l],([t])=>t.params.namespace),D=i([l],([t])=>t.params.workflow),F=i([l],([t])=>t.params.run),L=i([l],([t])=>t.stuff.settings),Q=i([R],([t])=>t==null?void 0:t.accessToken),S=i([x,D,F,L,Q,q],([t,e,o,s,c,a])=>({namespace:t,workflowId:k(e!=null?e:""),runId:o,settings:s,accessToken:c,refresh:a})),_={workflow:null,workers:null},j=t=>S.subscribe(({namespace:e,workflowId:o,runId:s,settings:c,accessToken:a})=>{e&&o&&s?A(m,p,async()=>{const n=await y({namespace:e,workflowId:o,runId:s}),{taskQueue:d}=n,r=await b({queue:d,namespace:e});n.pendingActivities=await J(n,e,c,a),t({workflow:n,workers:r})}):(m.set(!0),p.set(!1))}),p=u(!0),m=u(!0),Z=g(_,j),f={namespace:null,workflowId:null,runId:null,rawPayloads:null,sort:null},z=u(f),U=()=>{z.set(f)};export{U as c,m as l,z as p,q as r,Z as w};
