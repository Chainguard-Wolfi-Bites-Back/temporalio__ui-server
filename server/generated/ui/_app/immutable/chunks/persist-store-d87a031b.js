import{w as p}from"./index-d0d31c39.js";import{i as S}from"./is-function-45497f08.js";function u(o,s=null,f=!1){var l,a,n;let r=S(s)?s():s,t;try{(l=window==null?void 0:window.localStorage)!=null&&l.getItem(o)&&(r=JSON.parse((n=(a=window==null?void 0:window.localStorage)==null?void 0:a.getItem(o))!=null?n:""))}catch{r=null}const{subscribe:g,set:i}=p(r);return f&&(t=new BroadcastChannel(`persist-store-${o}`),t==null||t.addEventListener("message",e=>{i(e.data)})),{subscribe:g,set:e=>{var w,c;t&&t.postMessage(e),e===null?(w=window==null?void 0:window.localStorage)==null||w.removeItem(o):(c=window==null?void 0:window.localStorage)==null||c.setItem(o,JSON.stringify(e)),i(e)}}}export{u as p};
