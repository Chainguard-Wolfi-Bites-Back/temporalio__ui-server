import{e as l,d as h,t as P,p as O}from"./route-for-9e2a964e.js";import{g}from"./auth-user-867edd3a.js";import{B as z}from"./index-9c2f34db.js";import{n as N}from"./error-d0a159d8.js";import{t as S}from"./toaster-6798b4b4.js";import{i as W}from"./is-network-error-b4d0e571.js";import{h as e}from"./has-1c7458b3.js";import{i as L}from"./persist-store-8a36fd1f.js";function _(c=l){const n="",s=!n.startsWith("http");let o="";return s?o=c?window.location.origin+n:"":o=n,o.endsWith("/")&&(o=o.slice(0,-1)),o}const G=(c,n=S,s=N,o=l)=>{if(typeof c=="string")return n.push({variant:"error",message:c});if(c instanceof Error)return n.push({variant:"error",message:c.message});if(b(c)&&o)return window.location.assign(h(c==null?void 0:c.message));if(v(c)&&o)return window.location.assign(h(c==null?void 0:c.message));if(W(c))throw n.push({variant:"error",message:`${c.statusCode} ${c.statusText}`}),s.set(c),c},cn=(c,n=l)=>{var o;const s=`${c==null?void 0:c.status} ${(o=c==null?void 0:c.body)==null?void 0:o.message}`;if(b(c)&&n){window.location.assign(h(s));return}if(v(c)&&n){window.location.assign(h(s));return}},b=c=>T(c,401),v=c=>T(c,403),T=(c,n)=>e(c,"statusCode")?c.statusCode===n:e(c,"status")?c.status===n:!1,sn=c=>(c==null?void 0:c.message)!==void 0&&typeof(c==null?void 0:c.message)=="string",B=async(c,n={},s=10)=>{const{params:o={},request:w=fetch,token:u,shouldRetry:$=!1,notifyOnError:A=!0,handleError:E=G,onRetry:U=z,onError:k,retryInterval:q=5e3,isBrowser:I=l}=n;let{options:t}=n;const x=u?{next_page_token:u}:{},C=new URLSearchParams({...o,...x}),R=P(c,C);try{t=H(t,I),t=await K(t,I);const i=await w(R,t),f=await i.json(),{status:d,statusText:F}=i;if(!i.ok)if(k&&L(k))k({status:d,statusText:F,body:f});else throw{statusCode:i.status,statusText:i.statusText,response:i,message:(f==null?void 0:f.message)??i.statusText};return f}catch(i){if(A){if(E(i),$&&s>0)return new Promise(f=>{const d=s-1;U(d),setTimeout(()=>{f(B(c,n,d))},q)})}else throw i}},H=(c,n=l)=>{const s={credentials:"include",...c};return s.headers=D(c==null?void 0:c.headers,n),s},K=async(c,n=l)=>(g().accessToken?(c.headers=await y(c==null?void 0:c.headers,async()=>g().accessToken,n),c.headers=X(c==null?void 0:c.headers,g().idToken,n)):globalThis!=null&&globalThis.AccessToken&&(c.headers=await y(c==null?void 0:c.headers,globalThis.AccessToken,n)),c),y=async(c,n,s=l)=>{if(c||(c={}),!s)return c;try{const o=await n();o&&(c.Authorization=`Bearer ${o}`)}catch(o){console.error(o)}return c},X=(c={},n,s=l)=>(s&&n&&(c["Authorization-Extras"]=n),c),D=(c,n=l)=>{if(c||(c={}),!n)return c;const s="_csrf=",o="X-CSRF-TOKEN";try{let u=document.cookie.split(";").find($=>$.includes(s));u&&!c[o]&&(u=u.trim().slice(s.length),c[o]=u)}catch(w){console.error(w)}return c},J=(c,n)=>c?c.replace("%namespace%",n):"",M=async c=>{var s;let n="";if(globalThis!=null&&globalThis.GetNamespaces&&c){const o=await globalThis.GetNamespaces(),w=o==null?void 0:o.find(u=>u.namespace===c);n=(w==null?void 0:w.webUri)??J((s=globalThis==null?void 0:globalThis.AppConfig)==null?void 0:s.apiUrl,c)}else n=_();return n.endsWith("/")&&(n=n.slice(0,-1)),n=`${n}${O}`,n},Q=async(c,n)=>(c.startsWith("/")&&(c=c.slice(1)),`${await M(n)}/api/v1/${c}`),V=c=>Object.keys(c??{}).reduce((n,s)=>(n[s]=encodeURIComponent(encodeURIComponent(c[s])),n),{namespace:"",workflowId:"",scheduleId:"",runId:"",queue:"",activityId:""});function on(c,n,s=!0){s&&(n=V(n));const o={cluster:"/cluster","events.ascending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/events`,"events.descending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/events/reverse`,namespaces:"/namespaces",namespace:`/namespaces/${n==null?void 0:n.namespace}`,query:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/query`,"schedule.delete":`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}`,schedule:`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}`,schedules:`/namespaces/${n==null?void 0:n.namespace}/schedules`,"search-attributes":"/search-attributes",settings:"/settings","task-queue":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}`,user:"/me","workflow.terminate":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/terminate`,"workflow.cancel":`/namespaces/${n.namespace}/workflows/${n.workflowId}/runs/${n.runId}/cancel`,"workflow.signal":`/namespaces/${n.namespace}/workflows/${n.workflowId}/runs/${n.runId}/signal`,workflow:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}`,"workflows.archived":`/namespaces/${n==null?void 0:n.namespace}/workflows/archived`,workflows:`/namespaces/${n==null?void 0:n.namespace}/workflows`,"workflows.count":`/namespaces/${n==null?void 0:n.namespace}/workflows/count`,"activity.complete":`/namespaces/${n.namespace}/workflows/${n.workflowId}/runs/${n.runId}/activities/${n.activityId}/complete`,"activity.fail":`/namespaces/${n.namespace}/workflows/${n.workflowId}/runs/${n.runId}/activities/${n.activityId}/fail`,"batch-operations":`/namespaces/${n.namespace}/batch-operations`,"batch-operation.describe":`/namespaces/${n.namespace}/batch-operations/describe`,"workflows.batch.terminate":`/namespaces/${n.namespace}/workflows/batch/terminate`,"workflows.batch.describe":`/namespaces/${n.namespace}/workflows/batch/describe`};return Q(o[c],n==null?void 0:n.namespace)}export{B as a,cn as b,v as c,sn as d,_ as g,G as h,b as i,on as r};
