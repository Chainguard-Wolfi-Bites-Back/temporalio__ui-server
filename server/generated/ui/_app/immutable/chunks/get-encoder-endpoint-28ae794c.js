import{a as E,s as l,b as j,d as u}from"./is-http-135b6a03.js";import{s as P,p as O}from"./parse-with-big-int-561ccb8b.js";import{a as m}from"./atob-0f2ea7f7.js";import{a7 as W}from"./index-e693a59e.js";async function R({payloads:o,namespace:e,settings:c,accessToken:n}){var d,r;const f=(d=c==null?void 0:c.codec)==null?void 0:d.endpoint,i=(r=c==null?void 0:c.codec)==null?void 0:r.passAccessToken,a={"Content-Type":"application/json","X-Namespace":e};if(i)if(E(f))a.Authorization=`Bearer ${n}`;else return l(),o;return fetch(f+"/decode",{headers:a,method:"POST",body:P(o)}).then(s=>s.json()).then(s=>(j(),s)).catch(()=>(l(),o))}function h(o){var c,n;const e=m(String((n=(c=o==null?void 0:o.metadata)==null?void 0:c.encoding)!=null?n:""));if(o.metadata.encodingDecoded=e,e.startsWith("json/"))try{return O(m(String(o.data)))}catch{}return o}const k=o=>{var c,n,f,i,a,t;const e=o;if((c=e==null?void 0:e.searchAttributes)!=null&&c.indexedFields){const d=(n=e==null?void 0:e.searchAttributes)==null?void 0:n.indexedFields;Object.entries(d).forEach(([r,s])=>{d[r]=h(s)})}if((f=e==null?void 0:e.memo)!=null&&f.fields){const d=(i=e==null?void 0:e.memo)==null?void 0:i.fields;Object.entries(d).forEach(([r,s])=>{d[r]=h(s)})}if((a=e==null?void 0:e.header)!=null&&a.fields){const d=(t=e==null?void 0:e.header)==null?void 0:t.fields;Object.entries(d).forEach(([r,s])=>{d[r]=h(s)})}if(e!=null&&e.queryResult){const d=e==null?void 0:e.queryResult;Object.entries(d).forEach(([r,s])=>{d[r]=h(s)})}return e},p=async(o,e,c,n)=>{var f,i;if(o)for(const a of Object.keys(o))if(a==="payloads"){let t;const d=o[a];if((f=c==null?void 0:c.codec)!=null&&f.endpoint){const r=await R({payloads:{payloads:d},namespace:e,settings:c,accessToken:n});t=((i=r==null?void 0:r.payloads)!=null?i:[]).map(h)}else t=d.map(h);o[a]=t}else typeof o[a]=="object"&&(o[a]=await p(o[a],e,c,n));return o},q=async({attributes:o,namespace:e,settings:c,accessToken:n})=>await p(o,e,c,n),x=(o,e=u)=>{var c;return W(e)||((c=o==null?void 0:o.codec)==null?void 0:c.endpoint)||""};export{q as c,k as d,x as g};
