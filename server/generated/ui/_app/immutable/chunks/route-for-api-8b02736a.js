import{d as h,e as o,t as b}from"./route-for-62d7d3b1.js";import{g as $}from"./user-b3ac4393.js";import{E as O}from"./index-8e660855.js";import{w as z}from"./index-71be9f1c.js";import{n as W}from"./notifications-faca15d4.js";import{i as L}from"./is-network-error-5f9e2367.js";import{i as N}from"./persist-store-4b4c2e6c.js";import{p as S}from"./get-public-path-6c4a8950.js";const _=z(null),H=(c,n=W,i=_,s=o)=>{if(E(c)&&s){window.location.assign(h(c==null?void 0:c.message));return}if(A(c)&&s){window.location.assign(h(c==null?void 0:c.message));return}if(L(c))throw n.add("error",`${c.statusCode} ${c.statusText}`),i.set(c),c;typeof c=="string"&&n.add("error",c),c instanceof Error&&n.add("error",c.message)},cn=(c,n=o)=>{var s;const i=`${c==null?void 0:c.status} ${(s=c==null?void 0:c.body)==null?void 0:s.message}`;if(E(c)&&n){window.location.assign(h(i));return}if(A(c)&&n){window.location.assign(h(i));return}},E=c=>(c==null?void 0:c.statusCode)===401||(c==null?void 0:c.status)===401,A=c=>(c==null?void 0:c.statusCode)===403||(c==null?void 0:c.status)===403,sn=c=>(c==null?void 0:c.message)!==void 0&&typeof(c==null?void 0:c.message)=="string",K=async(c,n={},i=10)=>{var T;const{params:s={},request:w=fetch,token:l,shouldRetry:g=!1,notifyOnError:v=!0,handleError:U=H,onRetry:C=O,onError:k,retryInterval:q=5e3,isBrowser:I=o}=n;let{options:d}=n;const x=l?{next_page_token:l}:{},R=new URLSearchParams({...s,...x}),F=b(c,R);try{d=X(d,I),d=await B(d,I);const u=await w(F,d),f=await u.json(),{status:t,statusText:P}=u;if(!u.ok)if(k&&N(k))k({status:t,statusText:P,body:f});else throw{statusCode:u.status,statusText:u.statusText,response:u,message:(T=f==null?void 0:f.message)!=null?T:u.statusText};return f}catch(u){if(v){if(U(u),g&&i>0)return new Promise(f=>{const t=i-1;C(t),setTimeout(()=>{f(K(c,n,t))},q)})}else throw u}},X=(c,n=o)=>{const i={credentials:"include",...c};return i.headers=G(c==null?void 0:c.headers,n),i},B=async(c,n=o)=>($().accessToken?(c.headers=await y(c==null?void 0:c.headers,async()=>$().accessToken,n),c.headers=D(c==null?void 0:c.headers,$().idToken,n)):globalThis!=null&&globalThis.AccessToken&&(c.headers=await y(c==null?void 0:c.headers,globalThis.AccessToken,n)),c),y=async(c,n,i=o)=>{if(c||(c={}),!i)return c;try{const s=await n();s&&(c.Authorization=`Bearer ${s}`)}catch(s){console.error(s)}return c},D=(c={},n,i=o)=>(i&&n&&(c["Authorization-Extras"]=n),c),G=(c,n=o)=>{if(c||(c={}),!n)return c;const i="_csrf=",s="X-CSRF-TOKEN";try{let l=document.cookie.split(";").find(g=>g.includes(i));l&&!c[s]&&(l=l.trim().slice(i.length),c[s]=l)}catch(w){console.error(w)}return c};function J(c=o){const n="",i=!n.startsWith("http");let s="";return i?s=c?window.location.origin+n:"":s=n,s.endsWith("/")&&(s=s.slice(0,-1)),s}const M=(c,n)=>c.replace("%namespace%",n),Q=c=>{var i;let n="";return((i=globalThis==null?void 0:globalThis.AppConfig)==null?void 0:i.apiUrl)&&c?n=M(globalThis.AppConfig.apiUrl,c):n=J(),n.endsWith("/")&&(n=n.slice(0,-1)),n=`${n}${S}`,n},V=(c,n)=>(c.startsWith("/")&&(c=c.slice(1)),`${Q(n)}/api/v1/${c}`),Y=c=>Object.keys(c!=null?c:{}).reduce((n,i)=>(n[i]=encodeURIComponent(encodeURIComponent(c[i])),n),{namespace:"",workflowId:"",scheduleId:"",runId:"",queue:""});function un(c,n,i=!0){i&&(n=Y(n));const s={cluster:"/cluster","events.ascending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/events`,"events.descending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/events/reverse`,namespaces:"/namespaces",query:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/query`,"schedule.delete":`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}`,schedule:`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}`,schedules:`/namespaces/${n==null?void 0:n.namespace}/schedules`,"search-attributes":"/search-attributes",settings:"/settings","task-queue":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}`,user:"/me","workflow.terminate":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/terminate`,workflow:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}`,"workflows.archived":`/namespaces/${n==null?void 0:n.namespace}/workflows/archived`,workflows:`/namespaces/${n==null?void 0:n.namespace}/workflows`};return V(s[c],n==null?void 0:n.namespace)}export{un as a,cn as b,J as g,H as h,sn as i,_ as n,K as r};
