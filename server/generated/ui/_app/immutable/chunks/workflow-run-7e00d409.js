import{d as r,r as w,w as p}from"./index-ed1eef06.js";import{p as u}from"./stores-d81762c0.js";import{w as A}from"./with-loading-f07bedaf.js";import{f as g}from"./workflow-service-84f7c4fa.js";import{g as b}from"./pollers-service-5b3bcc90.js";import{m as y}from"./route-for-ec0d3387.js";import{c as k}from"./is-http-71484b05.js";import{g as P,c as T,b as W,d as h}from"./get-codec-b20c7745.js";import{a as R}from"./auth-user-bb8d7b92.js";async function I({activity:t,namespace:e,settings:o,accessToken:s},{convertWithCodec:n=T,convertWithWebsocket:a=W,decodeAttributes:c=h,encoderEndpoint:d=k}={}){const i=P(o,d),l={...o,codec:{...o==null?void 0:o.codec,endpoint:i}},v=i?await n({attributes:t,namespace:e,settings:l,accessToken:s}):await a(t);return c(v)}const C=async({activity:t,namespace:e,settings:o,accessToken:s})=>await I({activity:t,namespace:e,settings:o,accessToken:s}),E=async(t,e,o,s)=>{var c;const n=(c=t==null?void 0:t.pendingActivities)!=null?c:[],a=[];for(const d of n){const i=await C({activity:d,namespace:e,settings:o,accessToken:s});a.push(i)}return a},J=p(0),q=r([u],([t])=>t.params.namespace),x=r([u],([t])=>t.params.workflow),D=r([u],([t])=>t.params.run),F=r([u],([t])=>t.stuff.settings),L=r([R],([t])=>t==null?void 0:t.accessToken),Q=r([q,x,D,F,L,J],([t,e,o,s,n,a])=>({namespace:t,workflowId:y(e!=null?e:""),runId:o,settings:s,accessToken:n,refresh:a})),S={workflow:null,workers:null},_=t=>Q.subscribe(({namespace:e,workflowId:o,runId:s,settings:n,accessToken:a})=>{e&&o&&s?A(f,m,async()=>{const c=await g({namespace:e,workflowId:o,runId:s}),{taskQueue:d}=c,i=await b({queue:d,namespace:e});c.pendingActivities=await E(c,e,n,a),t({workflow:c,workers:i})}):(f.set(!0),m.set(!1))}),m=p(!0),f=p(!0),X=w(S,_);export{f as l,J as r,X as w};
