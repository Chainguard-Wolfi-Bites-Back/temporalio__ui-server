import{d as a,r as v,w as p}from"./index-8f8207c2.js";import{p as u}from"./stores-e2727ac0.js";import{w as A}from"./with-loading-f07bedaf.js";import{f as g}from"./workflow-service-c3d74aac.js";import{g as w}from"./pollers-service-60d0994b.js";import{m as y}from"./route-for-06e4a074.js";import{d as b}from"./is-http-135b6a03.js";import{g as k,c as P,d as T}from"./get-encoder-endpoint-28ae794c.js";import{a as E}from"./notifications-b26a159d.js";async function R({activity:t,namespace:e,settings:o,accessToken:s},{convertWithCodec:c=P,decodeAttributes:i=T,encoderEndpoint:n=b}={}){const r=k(o,n),d={...o,codec:{...o==null?void 0:o.codec,endpoint:r}},l=await c({attributes:t,namespace:e,settings:d,accessToken:s});return i(l)}const W=async({activity:t,namespace:e,settings:o,accessToken:s})=>await R({activity:t,namespace:e,settings:o,accessToken:s}),h=async(t,e,o,s)=>{var n;const c=(n=t==null?void 0:t.pendingActivities)!=null?n:[],i=[];for(const r of c){const d=await W({activity:r,namespace:e,settings:o,accessToken:s});i.push(d)}return i},I=p(0),q=a([u],([t])=>t.params.namespace),x=a([u],([t])=>t.params.workflow),C=a([u],([t])=>t.params.run),D=a([u],([t])=>t.stuff.settings),F=a([E],([t])=>t==null?void 0:t.accessToken),J=a([q,x,C,D,F,I],([t,e,o,s,c,i])=>({namespace:t,workflowId:y(e!=null?e:""),runId:o,settings:s,accessToken:c,refresh:i})),L={workflow:null,workers:null},Q=t=>J.subscribe(({namespace:e,workflowId:o,runId:s,settings:c,accessToken:i})=>{e&&o&&s?A(f,m,async()=>{const n=await g({namespace:e,workflowId:o,runId:s}),{taskQueue:r}=n,d=await w({queue:r,namespace:e});n.pendingActivities=await h(n,e,c,i),t({workflow:n,workers:d})}):(f.set(!0),m.set(!1))}),m=p(!0),f=p(!0),O=v(L,Q);export{f as l,I as r,O as w};
