import{d as i,r as A,w as p}from"./index-71be9f1c.js";import{p as u}from"./stores-8ff78576.js";import{w as y}from"./with-loading-f07bedaf.js";import{f as b}from"./workflow-service-6d2432d3.js";import{g}from"./pollers-service-ed279067.js";import{m as k}from"./route-for-62d7d3b1.js";import{a6 as h}from"./index-8e660855.js";import{d as l}from"./is-http-9a6dffcd.js";import{c as P,a as T,d as W}from"./decode-payload-6be25ef1.js";import{u as R}from"./user-b3ac4393.js";const E=(t,o=l)=>{var e;return h(o)||((e=t==null?void 0:t.codec)==null?void 0:e.endpoint)||""};async function I({activity:t,namespace:o,settings:e,accessToken:s},{convertWithCodec:c=P,convertWithWebsocket:a=T,decodeAttributes:n=W,encoderEndpoint:d=l}={}){const r=E(e,d),v={...e,codec:{...e==null?void 0:e.codec,endpoint:r}},w=r?await c({attributes:t,namespace:o,settings:v,accessToken:s}):await a(t);return n(w)}const _=async({activity:t,namespace:o,settings:e,accessToken:s})=>await I({activity:t,namespace:o,settings:e,accessToken:s}),J=async(t,o,e,s)=>{var n;const c=(n=t==null?void 0:t.pendingActivities)!=null?n:[],a=[];for(const d of c){const r=await _({activity:d,namespace:o,settings:e,accessToken:s});a.push(r)}return a},q=p(0),x=i([u],([t])=>t.params.namespace),C=i([u],([t])=>t.params.workflow),D=i([u],([t])=>t.params.run),F=i([u],([t])=>t.stuff.settings),L=i([R],([t])=>t==null?void 0:t.accessToken),Q=i([x,C,D,F,L,q],([t,o,e,s,c,a])=>({namespace:t,workflowId:k(o!=null?o:""),runId:e,settings:s,accessToken:c,refresh:a})),S={workflow:null,workers:null},U=t=>Q.subscribe(({namespace:o,workflowId:e,runId:s,settings:c,accessToken:a})=>{o&&e&&s?y(f,m,async()=>{const n=await b({namespace:o,workflowId:e,runId:s}),{taskQueue:d}=n,r=await g({queue:d,namespace:o});n.pendingActivities=await J(n,o,c,a),t({workflow:n,workers:r})}):(f.set(!0),m.set(!1))}),m=p(!0),f=p(!0),Y=A(S,U);export{f as l,q as r,Y as w};
