import{g}from"./navigation-fbe70647.js";import{w as v}from"./index-f4b3dcfa.js";import{d as y,s as M}from"./route-for-369a155d.js";import{c as C,e as O,a as Q}from"./schedule-frequency-90f4ee46.js";const f=e=>e?parseInt(e):0,W=(e,a,s,t)=>`${f(e)*60*60*24+f(a)*60*60+f(s)*60+f(t)}s`,j=({months:e=[],daysOfMonth:a=[],daysOfWeek:s=[]})=>{var l,n;const t=e.sort((o,i)=>parseInt(o)-parseInt(i)).join(","),r=a.sort((o,i)=>o-i).join(","),u=(((n=(l=s==null?void 0:s[0])==null?void 0:l.split(","))==null?void 0:n.length)>1?s[0].split(","):s).sort((o,i)=>parseInt(o)-parseInt(i)).join(",");return{month:t,dayOfMonth:r,dayOfWeek:u}},I=(e,a,s)=>{const{hour:t,minute:r,second:c,phase:u,cronString:l}=a,{preset:n,months:o,days:i,daysOfMonth:d,daysOfWeek:h}=s;if(n==="string"){const m=`${l}#${l}`;e.schedule.spec.cronString=[m],e.schedule.spec.calendar=[],e.schedule.spec.interval=[]}else if(n==="interval"){const m=W(i,t,r,c);e.schedule.spec.interval=[{interval:m,phase:u||"0s"}],e.schedule.spec.cronString=[],e.schedule.spec.calendar=[]}else{const{month:m,dayOfMonth:k,dayOfWeek:S}=j({months:o,daysOfMonth:d,daysOfWeek:h}),T=Q({preset:n,month:m,dayOfMonth:k,dayOfWeek:S,hour:t,minute:r,second:c});e.schedule.spec.calendar=[{year:"*",month:n==="month"?m:"",dayOfMonth:n==="month"?k:"",dayOfWeek:n==="week"?S:"",hour:t,minute:r,second:c,comment:T}],e.schedule.spec.interval=[],e.schedule.spec.cronString=[]}},F=async({action:e,spec:a,presets:s})=>{const{namespace:t,name:r,workflowId:c,workflowType:u,taskQueue:l}=e,n={schedule_id:r,schedule:{spec:{calendar:[],interval:[],cronString:[]},action:{startWorkflow:{workflowId:c,workflowType:{name:u},taskQueue:{name:l}}}}};I(n,a,s),p.set(!0);const{error:o}=await C({namespace:t,body:n});o?(w.set(o),p.set(!1)):setTimeout(()=>{w.set(""),p.set(!1),g(y({namespace:t}))},2e3)},A=async({action:e,spec:a,presets:s},t,r)=>{const{namespace:c,name:u,workflowId:l,workflowType:n,taskQueue:o}=e,{preset:i}=s,d={schedule:{...t,action:{startWorkflow:{...t.action.startWorkflow,workflowId:l,workflowType:{name:n},taskQueue:{name:o}}}}};i==="existing"?d.schedule.spec=t.spec:(I(d,a,s),d.schedule.spec.structuredCalendar=[]),p.set(!0);const{error:h}=await O({namespace:c,scheduleId:r,body:d});h?(w.set(h),p.set(!1)):setTimeout(()=>{g(M({namespace:c,scheduleId:u})),w.set(""),p.set(!1)},2e3)},p=v(!1),w=v("");export{F as a,w as e,p as l,A as s};
