import{d as i,r as A,w as p}from"./index-e5247e3a.js";import{p as u}from"./stores-d8da1c6f.js";import{w as y}from"./with-loading-f07bedaf.js";import{f as b}from"./workflow-service-229899c9.js";import{g}from"./pollers-service-b83c6fe5.js";import{m as k}from"./route-for-82ed5238.js";import{a6 as P}from"./index-de024f11.js";import{d as l}from"./is-http-5632dc1b.js";import{c as T,a as W,d as h}from"./decode-payload-d12c0c56.js";import{a as R}from"./auth-user-aad46f09.js";const E=(t,o=l)=>{var e;return P(o)||((e=t==null?void 0:t.codec)==null?void 0:e.endpoint)||""};async function I({activity:t,namespace:o,settings:e,accessToken:s},{convertWithCodec:c=T,convertWithWebsocket:a=W,decodeAttributes:n=h,encoderEndpoint:d=l}={}){const r=E(e,d),v={...e,codec:{...e==null?void 0:e.codec,endpoint:r}},w=r?await c({attributes:t,namespace:o,settings:v,accessToken:s}):await a(t);return n(w)}const _=async({activity:t,namespace:o,settings:e,accessToken:s})=>await I({activity:t,namespace:o,settings:e,accessToken:s}),J=async(t,o,e,s)=>{var n;const c=(n=t==null?void 0:t.pendingActivities)!=null?n:[],a=[];for(const d of c){const r=await _({activity:d,namespace:o,settings:e,accessToken:s});a.push(r)}return a},q=p(0),x=i([u],([t])=>t.params.namespace),C=i([u],([t])=>t.params.workflow),D=i([u],([t])=>t.params.run),F=i([u],([t])=>t.stuff.settings),L=i([R],([t])=>t==null?void 0:t.accessToken),Q=i([x,C,D,F,L,q],([t,o,e,s,c,a])=>({namespace:t,workflowId:k(o!=null?o:""),runId:e,settings:s,accessToken:c,refresh:a})),S={workflow:null,workers:null},j=t=>Q.subscribe(({namespace:o,workflowId:e,runId:s,settings:c,accessToken:a})=>{o&&e&&s?y(f,m,async()=>{const n=await b({namespace:o,workflowId:e,runId:s}),{taskQueue:d}=n,r=await g({queue:d,namespace:o});n.pendingActivities=await J(n,o,c,a),t({workflow:n,workers:r})}):(f.set(!0),m.set(!1))}),m=p(!0),f=p(!0),Z=A(S,j);export{f as l,q as r,Z as w};
