import{r as f,a as m,d as l}from"./route-for-api.d19bcce9.js";import{g as h,a as T}from"./get-codec.6f32083c.js";import{c as _,a as g}from"./decode-payload.4068ce23.js";import{s as u,p as I}from"./parse-with-big-int.0036a80a.js";import{p as P}from"./is-http.1e6b12cd.js";const O=t=>{const e=t.indexOf("["),r=t.indexOf("]");return t.slice(e+1,r).split(" ").filter(a=>a!=="__stack_trace").map(a=>a.endsWith(",")?a.slice(0,a.length-1):a)},W=async(t,e)=>(e=await e,{namespace:t,workflowId:e.id,runId:e.runId});async function d({workflow:t,namespace:e,queryType:r},a=fetch,n){t=await t;const c=await W(e,t),s=f("query",c);return await m(s,{options:{method:"POST",body:u({execution:{workflowId:t.id,runId:t.runId},query:{queryType:r}})},request:a,onError:n,notifyOnError:!1})}async function C(t,e=fetch){return new Promise((r,a)=>{d({...t,queryType:"@@temporal-internal__list"},e,n=>{l(n.body)&&n.body.message.includes("@@temporal-internal__list")?r(O(n.body.message)):a(n)})})}async function b(t,e,r,a=fetch){return d(t,a).then(async n=>{const{queryResult:c}=n??{queryResult:{payloads:[]}};let s=c.payloads;try{if(s[0]){const o=h(e),y=T(e,P),p={...e,codec:{...e==null?void 0:e.codec,endpoint:o,passAccessToken:y}},i=o?await _({attributes:c,namespace:t.namespace,settings:p,accessToken:r}):await g(c);s=i==null?void 0:i.payloads[0]}return I(s)}catch{return typeof s!="string"?u(s):s}})}async function E(t,e,r){return b({...t,queryType:"__stack_trace"},e,r)}export{b as a,E as b,C as g};
