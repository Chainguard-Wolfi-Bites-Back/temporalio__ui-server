import{s as M,e as Z,b as x,d as $,g as h,j as tt,k as y,c as I,ad as et,w as v,x as p,v as F,p as nt,u as ot,q as st,r as rt,t as lt,f as at,n as ut}from"./scheduler.yuwC4fMQ.js";import{S as N,i as T,c as q,a as A,m as B,t as w,b as k,d as O,g as Q,e as E}from"./index.m6evPz-M.js";import{e as V,u as ct,o as ft}from"./each.oHGYpoql.js";import{p as it}from"./stores.sWpEPH_T.js";import{S as _t}from"./index.-DOWF8Q-.js";import{r as mt,w as C,f as j}from"./workflows.420Yt6eC.js";import{e as dt}from"./decode-payload.-ZXWq91o.js";import{W as wt}from"./workflow-status.KR_JrJz_.js";import{t as kt}from"./translate.eu_ZgPaL.js";const S=["Running","TimedOut","Completed","Failed","ContinuedAsNew","Canceled","Terminated"];function Gt(o){return S.includes(o)}const Dt=["All",...S],R=(o,t,e)=>{const s=Math.pow(3600/o,1/e),l=o*Math.pow(s,t);return Math.min(3600,Math.round(l))};function pt(o){let t,e;return t=new wt({props:{count:o[1],newCount:o[2],status:o[0],"test-id":"workflow-status-"+o[0]}}),{c(){q(t.$$.fragment)},l(n){A(t.$$.fragment,n)},m(n,s){B(t,n,s),e=!0},p(n,[s]){const l={};s&2&&(l.count=n[1]),s&4&&(l.newCount=n[2]),s&1&&(l.status=n[0]),s&1&&(l["test-id"]="workflow-status-"+n[0]),t.$set(l)},i(n){e||(w(t.$$.fragment,n),e=!0)},o(n){k(t.$$.fragment,n),e=!1},d(n){O(t,n)}}}function ht(o,t,e){let{status:n}=t,{count:s=0}=t,{newCount:l=0}=t;return o.$$set=a=>{"status"in a&&e(0,n=a.status),"count"in a&&e(1,s=a.count),"newCount"in a&&e(2,l=a.newCount)},[n,s,l]}class gt extends N{constructor(t){super(),T(this,t,ht,pt,M,{status:0,count:1,newCount:2})}}function z(o,t,e){const n=o.slice();return n[18]=t[e].count,n[19]=t[e].status,n}function yt(o){let t,e;return t=new _t({props:{class:"h-6 w-24 rounded"}}),{c(){q(t.$$.fragment)},l(n){A(t.$$.fragment,n)},m(n,s){B(t,n,s),e=!0},p:F,i(n){e||(w(t.$$.fragment,n),e=!0)},o(n){k(t.$$.fragment,n),e=!1},d(n){O(t,n)}}}function bt(o){let t,e;function n(...l){return o[8](o[19],...l)}function s(...l){return o[9](o[19],...l)}return t=new gt({props:{status:o[19],count:o[18],newCount:o[1].find(n)?o[1].find(s).count-o[18]:0}}),{c(){q(t.$$.fragment)},l(l){A(t.$$.fragment,l)},m(l,a){B(t,l,a),e=!0},p(l,a){o=l;const u={};a&1&&(u.status=o[19]),a&1&&(u.count=o[18]),a&3&&(u.newCount=o[1].find(n)?o[1].find(s).count-o[18]:0),t.$set(u)},i(l){e||(w(t.$$.fragment,l),e=!0)},o(l){k(t.$$.fragment,l),e=!1},d(l){O(t,l)}}}function H(o,t){let e,n,s,l,a;const u=[bt,yt],r=[];function c(i,m){return i[2]?1:0}return n=c(t),s=r[n]=u[n](t),{key:o,first:null,c(){e=p(),s.c(),l=p(),this.h()},l(i){e=p(),s.l(i),l=p(),this.h()},h(){this.first=e},m(i,m){y(i,e,m),r[n].m(i,m),y(i,l,m),a=!0},p(i,m){t=i;let d=n;n=c(t),n===d?r[n].p(t,m):(Q(),k(r[d],1,1,()=>{r[d]=null}),E(),s=r[n],s?s.p(t,m):(s=r[n]=u[n](t),s.c()),w(s,1),s.m(l.parentNode,l))},i(i){a||(w(s),a=!0)},o(i){k(s),a=!1},d(i){i&&(h(e),h(l)),r[n].d(i)}}}function Ct(o){let t,e=[],n=new Map,s,l=V(o[0]);const a=u=>u[19];for(let u=0;u<l.length;u+=1){let r=z(o,l,u),c=a(r);n.set(c,e[u]=H(c,r))}return{c(){t=Z("div");for(let u=0;u<e.length;u+=1)e[u].c();this.h()},l(u){t=x(u,"DIV",{class:!0});var r=$(t);for(let c=0;c<e.length;c+=1)e[c].l(r);r.forEach(h),this.h()},h(){tt(t,"class","flex min-h-[24px] flex-wrap items-center gap-2")},m(u,r){y(u,t,r);for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(t,null);s=!0},p(u,[r]){r&7&&(l=V(u[0]),Q(),e=ct(e,r,a,1,u,l,n,t,ft,H,null,z),E())},i(u){if(!s){for(let r=0;r<l.length;r+=1)w(e[r]);s=!0}},o(u){for(let r=0;r<e.length;r+=1)k(e[r]);s=!1},d(u){u&&h(t);for(let r=0;r<e.length;r+=1)e[r].d()}}}const J=5,W=100;function St(o,t,e){let n,s,l,a,u;I(o,mt,f=>e(6,l=f)),I(o,C,f=>e(12,a=f)),I(o,it,f=>e(7,u=f));let{staticQuery:r=""}=t,c=[],i=[],m,d=1,b=!1;et(()=>{G()});const K=()=>{if(d+=1,clearInterval(m),d<=W){const f=R(J,d,W)*1e3;m=setInterval(()=>P(),f)}},G=()=>{clearInterval(m),e(1,i=[]),v(C,a.newCount=0,a),d=1,e(2,b=!0)},D=(f=[])=>f.map(_=>{const g=dt(_==null?void 0:_.groupValues[0]),Y=parseInt(_.count);return{status:g,count:Y}}).sort((_,g)=>S.indexOf(_.status)-S.indexOf(g.status)),P=async()=>{K();try{const{count:f,groups:_}=await j({namespace:n,query:s});v(C,a.newCount=parseInt(f)-a.count,a),e(1,i=D(_))}catch(f){console.error("Fetching workflow counts failed: ",f==null?void 0:f.message)}finally{e(2,b=!1)}},L=async()=>{G();const f=R(J,d,W)*1e3;m=setInterval(()=>P(),f);try{const{count:_,groups:g}=await j({namespace:n,query:s});v(C,a.count=parseInt(_),a),e(0,c=D(g))}catch(_){console.error("Fetching workflow counts failed: ",_==null?void 0:_.message)}finally{e(2,b=!1)}},U=(f,_)=>_.status===f,X=(f,_)=>_.status===f;return o.$$set=f=>{"staticQuery"in f&&e(3,r=f.staticQuery)},o.$$.update=()=>{o.$$.dirty&128&&e(4,n=u.params.namespace),o.$$.dirty&136&&e(5,s=r||u.url.searchParams.get("query")),o.$$.dirty&112&&L()},[c,i,b,r,n,s,l,u,U,X]}class Pt extends N{constructor(t){super(),T(this,t,St,Ct,M,{staticQuery:3})}}function It(o){let t;const e=o[5].default,n=nt(e,o,o[4],null);return{c(){n&&n.c()},l(s){n&&n.l(s)},m(s,l){n&&n.m(s,l),t=!0},p(s,l){n&&n.p&&(!t||l&16)&&ot(n,e,s,s[4],t?rt(e,s[4],l,null):st(s[4]),null)},i(s){t||(w(n,s),t=!0)},o(s){k(n,s),t=!1},d(s){n&&n.d(s)}}}function vt(o){let t;return{c(){t=lt(o[1])},l(e){t=at(e,o[1])},m(e,n){y(e,t,n)},p(e,n){n&2&&ut(t,e[1])},i:F,o:F,d(e){e&&h(t)}}}function Wt(o){let t,e,n,s;const l=[vt,It],a=[];function u(r,c){return r[1]!==r[0]?0:1}return t=u(o),e=a[t]=l[t](o),{c(){e.c(),n=p()},l(r){e.l(r),n=p()},m(r,c){a[t].m(r,c),y(r,n,c),s=!0},p(r,[c]){let i=t;t=u(r),t===i?a[t].p(r,c):(Q(),k(a[i],1,1,()=>{a[i]=null}),E(),e=a[t],e?e.p(r,c):(e=a[t]=l[t](r),e.c()),w(e,1),e.m(n.parentNode,n))},i(r){s||(w(e),s=!0)},o(r){k(e),s=!1},d(r){r&&h(n),a[t].d(r)}}}function Ft(o,t,e){let n,{$$slots:s={},$$scope:l}=t,{key:a}=t,{count:u=void 0}=t,{replace:r=void 0}=t;return o.$$set=c=>{"key"in c&&e(0,a=c.key),"count"in c&&e(2,u=c.count),"replace"in c&&e(3,r=c.replace),"$$scope"in c&&e(4,l=c.$$scope)},o.$$.update=()=>{o.$$.dirty&13&&e(1,n=kt(a,{count:u,...r}))},[a,n,u,r,l,s]}class Vt extends N{constructor(t){super(),T(this,t,Ft,Wt,M,{key:0,count:2,replace:3})}}export{Vt as T,Pt as W,Gt as i,Dt as w};
