import{z as a}from"./scheduler.pu1Jb5n4.js";import{p as m}from"./stores.YpzTYQiz.js";import{t as w}from"./translate.5hbiS85r.js";import{a as k}from"./auth-user.HNa6r36Q.js";import{c as P,o as j,p as F,i as _,s as p,a as x}from"./data-encoder-config.V3XoR6dO.js";import{h as f,a as R}from"./has.jYYzOA_H.js";import{v as W,a as O}from"./is-http.Y_1dIkbJ.js";import{s as C,p as b}from"./parse-with-big-int.e3oI4SEy.js";const E=(e,n=P,o=j)=>{var c;return a(o)&&a(n)||((c=e==null?void 0:e.codec)==null?void 0:c.endpoint)||a(n)||""},S=(e,n=F,o=P,s=j)=>{var d,r;const c=a(s)&&a(o),i=(d=e==null?void 0:e.codec)!=null&&d.endpoint?!!((r=e==null?void 0:e.codec)!=null&&r.passAccessToken):!!a(n);return c?!!a(n):i},q=(e,n=_,o=P,s=j)=>{var d,r;const c=a(s)&&a(o),i=(d=e==null?void 0:e.codec)!=null&&d.endpoint?!!((r=e==null?void 0:e.codec)!=null&&r.includeCredentials):!!a(n);return c?!!a(n):i};async function L({payloads:e,namespace:n=a(m).params.namespace,settings:o=a(m).data.settings,accessToken:s=a(k).accessToken}){const c=E(o),i=S(o),d=q(o),r={"Content-Type":"application/json","X-Namespace":n};if(i)if(W(c))r.Authorization=`Bearer ${s}`;else return p(),e;const u=d?{headers:r,credentials:"include",method:"POST",body:C(e)}:{headers:r,method:"POST",body:C(e)};return fetch(c+"/decode",u).then(t=>{if(f(t,"ok")&&!t.ok)throw{statusCode:t.status,statusText:t.statusText,response:t,message:w("common.decode-failed")};return t.json()}).then(t=>(x(),t)).catch(t=>(p(t),e))}async function Q({payloads:e,namespace:n=a(m).params.namespace,settings:o=a(m).data.settings,accessToken:s=a(k).accessToken}){const c=E(o),i=S(o),d=q(o),r={"Content-Type":"application/json","X-Namespace":n};if(i)if(W(c))r.Authorization=`Bearer ${s}`;else return p(),e;const u=d?{headers:r,credentials:"include",method:"POST",body:C(e)}:{headers:r,method:"POST",body:C(e)};return fetch(c+"/encode",u).then(t=>{if(f(t,"ok")&&!t.ok)throw{statusCode:t.status,statusText:t.statusText,response:t,message:w("common.encode-failed")};return t.json()}).then(t=>(x(),t)).catch(t=>{throw p(t),t})}const B=e=>Array.isArray(e)?e:[e];function h(e,n=!0){var s;if(e===null)return e;const o=O(String(((s=e==null?void 0:e.metadata)==null?void 0:s.encoding)??""));if(e!=null&&e.metadata&&(e.metadata.encodingDecoded=o),o!=null&&o.startsWith("json/"))try{const c=b(O(String((e==null?void 0:e.data)??"")));return n?c:{...e,data:c}}catch(c){console.warn("Could not parse payload: ",c)}return o==="binary/null"?n?null:{...e,data:null}:e}const V=(e,n=!0)=>{if(f(e,"searchAttributes")&&f(e.searchAttributes,"indexedFields")){const o=e.searchAttributes.indexedFields;Object.entries(o).forEach(([s,c])=>{o[s]=h(c,n)})}else if(f(e,"searchAttributes")){const o=e.searchAttributes;Object.entries(o).forEach(([s,c])=>{o[s]=h(c,n)})}if(f(e,"memo")&&f(e.memo,"fields")){const o=e.memo.fields;Object.entries(o).forEach(([s,c])=>{o[s]=h(c,n)})}if(f(e,"header")&&f(e.header,"fields")){const o=e.header.fields;Object.entries(o).forEach(([s,c])=>{o[s]=h(c,n)})}if(f(e,"queryResult")){const o=e==null?void 0:e.queryResult;Object.entries(o).forEach(([s,c])=>{o[s]=h(c,n)})}return e},I=e=>async(n,o=!0)=>{if(E(e)){const s=await L({payloads:{payloads:n},settings:e});return((s==null?void 0:s.payloads)??[]).map(c=>h(c,o))}else return n.map(s=>h(s,o))},T=(e,...n)=>{for(const o of n)if(e===o)return!0;return!1},z=async(e,n=a(m).params.namespace,o=a(m).data.settings,s=a(k).accessToken)=>{const c=I(o);if(e)for(const i of Object.keys(e))if(T(i,"payloads","encodedAttributes")&&e[i]){const d=B(e[i]),r=await c(d);e[i]=T(i,"encodedAttributes")?r[0]:r}else{const d=e[i];R(d)&&(e[i]=await z(d,n,o,s))}return e},N=async(e,n,o,s,c=!0)=>{if(!e)return e;const i=I(o),d={...e};if(e)for(const r of Object.keys(d))if(T(r,"payloads","encodedAttributes")&&d[r]){const u=B(d[r]),l=await i(u,c);d[r]=T(r,"encodedAttributes")?l[0]:l}else{const u=d[r];R(u)&&(d[r]=await N(u,n,o,s,c))}return d},Y=async({attributes:e,namespace:n,settings:o,accessToken:s})=>await z(e,n,o,s);export{S as a,q as b,N as c,V as d,Q as e,h as f,E as g,Y as h};
