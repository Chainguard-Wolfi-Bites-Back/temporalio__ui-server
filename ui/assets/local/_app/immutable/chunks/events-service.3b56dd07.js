import{d as r,w as u}from"./index.d26f8d55.js";import{p as m}from"./stores.869444a7.js";import{e as S}from"./event-view.00fee029.js";import{k as v}from"./route-for.d6935e46.js";import{r as y}from"./workflow-run.8bbc647a.js";import{a as F}from"./auth-user.25c2d008.js";import{E as q}from"./is-event-type.3574dcf0.js";import{p as h}from"./paginated.cefe4272.js";import{r as l,a as w}from"./route-for-api.12e5cdbc.js";import{t as f}from"./index.db3d0604.js";import{b as A}from"./has.8da86d13.js";const H=r([m],([t])=>t.params.namespace?v(t.params.namespace):""),P=r([m],([t])=>t.params.workflow?v(t.params.workflow):""),T=r([m],([t])=>t.params.run?v(t.params.run):""),b=r([m],([t])=>{var e;return(e=t.data)==null?void 0:e.settings}),x=r([F],([t])=>t==null?void 0:t.accessToken),z=r([H,P,T,S],([t,e,s,n])=>({namespace:t,workflowId:e,runId:s,sort:n}));r([z,b,x,y],([t,e,s,n])=>({...t,settings:e,accessToken:s,refresh:y,$refresh:n}));const j={start:[],end:[]},X=u(j),Y=u(null),B=u([]),Z=r(B,t=>t.filter(q)),k=t=>!A(t)||t==="descending"?"events.descending":t==="ascending"?"events.ascending":"events.descending",_=async({namespace:t,workflowId:e,runId:s,sort:n,onStart:o,onUpdate:a,onComplete:c})=>{const i=k(n),p=l(i,{namespace:t,workflowId:e,runId:s});return(await h(async d=>w(p,{token:d,request:fetch}),{onStart:o,onUpdate:a,onComplete:c})).history.events},U=async({namespace:t,workflowId:e,runId:s,sort:n,settings:o,accessToken:a,onStart:c,onUpdate:i,onComplete:p})=>{const E=k(n),d=l(E,{namespace:t,workflowId:e,runId:s}),I=await h(async R=>w(d,{token:R,request:fetch}),{onStart:c,onUpdate:i,onComplete:p});return await f({response:I.history.events,namespace:t,settings:o,accessToken:a})},g=async({namespace:t,workflowId:e,runId:s,sort:n})=>{const o=l(`events.${n}`,{namespace:t,workflowId:e,runId:s});try{return(await w(o,{request:fetch,params:{maximumPageSize:"20"}})).history.events}catch{return[]}},$=async t=>{const{settings:e,namespace:s,accessToken:n}=t,o=await g({...t,sort:"ascending"}),a=await g({...t,sort:"descending"}),[c,i]=await Promise.all([f({response:o,namespace:s,settings:e,accessToken:n}),f({response:a,namespace:s,settings:e,accessToken:n})]);return{start:c,end:i}};export{U as a,_ as b,B as c,X as e,$ as f,j as i,Z as r,Y as t};
