import{B as w,e as $,t as q}from"./route-for.73d4a234.js";import{g}from"./auth-user.58d364c3.js";import{w as x}from"./index.c0615b9d.js";import{t as C}from"./toaster.fd2b66a2.js";import{h as b}from"./has.f5323580.js";import{i as R}from"./is-network-error.900fb374.js";import{i as F}from"./persist-store.b76d8148.js";import{ab as P}from"./index.efded970.js";import{b as O}from"./paths.bb5c3c2d.js";import{p as W}from"./stores.3396f8e2.js";function S(c=w){const n="",o=!n.startsWith("http");let i="";return o?i=c?window.location.origin+n:"":i=n,i.endsWith("/")&&(i=i.slice(0,-1)),i}const N=x(null),_=(c,n=C,o=N,i=w)=>{throw typeof c=="string"?n.push({variant:"error",message:c}):c.report=!1,c instanceof Error&&n.push({variant:"error",message:c.message}),e(c)&&i&&window.location.assign($(c==null?void 0:c.message)),v(c)&&i&&window.location.assign($(c==null?void 0:c.message)),R(c)&&(n.push({variant:"error",message:`${c.statusCode} ${c.statusText}`}),o.set(c)),c},cn=(c,n=w)=>{var i;const o=`${c==null?void 0:c.status} ${(i=c==null?void 0:c.body)==null?void 0:i.message}`;if(e(c)&&n){window.location.assign($(o));return}if(v(c)&&n){window.location.assign($(o));return}},e=c=>T(c,401),v=c=>T(c,403),T=(c,n)=>b(c,"statusCode")?c.statusCode===n:b(c,"status")?c.status===n:!1,on=c=>(c==null?void 0:c.message)!==void 0&&typeof(c==null?void 0:c.message)=="string",sn=async(c,n={})=>{const{params:o={},request:i=fetch,token:u,notifyOnError:l=!0,handleError:f=_,onError:k,isBrowser:I=w}=n;let{options:t}=n,h=new URLSearchParams;if(o!=null&&o.entries)h=o,u&&h.set("nextPageToken",u);else{const s=u?{next_page_token:u}:{};h=new URLSearchParams({...o,...s})}const U=q(c,h);try{t=z(t,I),t=await L(t,I);const s=await i(U,t),d=await s.json(),{status:E,statusText:A}=s;if(!s.ok)if(k&&F(k))k({status:E,statusText:A,body:d});else throw{statusCode:s.status,statusText:s.statusText,response:s,message:(d==null?void 0:d.message)??s.statusText};return d}catch(s){if(l)f(s);else throw s}},z=(c,n=w)=>{const o={credentials:"include",...c};return o.headers=H(c==null?void 0:c.headers,n),o},L=async(c,n=w)=>(g().accessToken?(c.headers=await y(c==null?void 0:c.headers,async()=>g().accessToken,n),c.headers=B(c==null?void 0:c.headers,g().idToken,n)):globalThis!=null&&globalThis.AccessToken&&(c.headers=await y(c==null?void 0:c.headers,globalThis.AccessToken,n)),c),y=async(c,n,o=w)=>{if(c||(c={}),!o)return c;try{const i=await n();i&&(c.Authorization=`Bearer ${i}`)}catch(i){console.error(i)}return c},B=(c={},n,o=w)=>(o&&n&&(c["Authorization-Extras"]=n),c),H=(c,n=w)=>{if(c||(c={}),c["Caller-Type"]="operator",!n)return c;const o="_csrf=",i="X-CSRF-TOKEN";try{let l=document.cookie.split(";").find(f=>f.includes(o));l&&!c[i]&&(l=l.trim().slice(o.length),c[i]=l)}catch(u){console.error(u)}return c},K=(c,n)=>c?c.replace("%namespace%",n):"",X=c=>{var l,f;let n="";const o=(l=P(W).data)==null?void 0:l.webUrl,i=o&&c,u=((f=globalThis==null?void 0:globalThis.AppConfig)==null?void 0:f.apiUrl)&&c;return i?n=o:u?(console.warn("Using fallback api url, web url not found"),n=K(globalThis.AppConfig.apiUrl,c)):n=S(),n.endsWith("/")&&(n=n.slice(0,-1)),n=`${n}${O}`,n},D=c=>(c.startsWith("/")&&(c=c.slice(1)),`/api/v1/${c}`),G=(c,n)=>`${X(n)}${c}`,J=c=>Object.keys(c??{}).reduce((n,o)=>(n[o]=encodeURIComponent(encodeURIComponent(c[o])),n),{namespace:"",workflowId:"",scheduleId:"",runId:"",queue:"",activityId:""});function M(c,n,o=!0){o&&(n=J(n));const i={cluster:"/cluster","events.ascending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/events`,"events.descending":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/events/reverse`,namespaces:"/namespaces",namespace:`/namespaces/${n==null?void 0:n.namespace}`,query:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/query`,"schedule.delete":`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}`,schedule:`/namespaces/${n==null?void 0:n.namespace}/schedules/${n==null?void 0:n.scheduleId}`,schedules:`/namespaces/${n==null?void 0:n.namespace}/schedules`,"search-attributes":`/namespaces/${n.namespace}/search-attributes`,settings:"/settings","task-queue":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}`,"task-queue.compatibility":`/namespaces/${n==null?void 0:n.namespace}/task-queues/${n==null?void 0:n.queue}/compatibility`,user:"/me","worker-task-reachability":`/namespaces/${n==null?void 0:n.namespace}/worker-task-reachability`,"workflow.terminate":`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}/terminate`,"workflow.cancel":`/namespaces/${n.namespace}/workflows/${n.workflowId}/runs/${n.runId}/cancel`,"workflow.signal":`/namespaces/${n.namespace}/workflows/${n.workflowId}/runs/${n.runId}/signal`,"workflow.reset":`/namespaces/${n.namespace}/workflows/${n.workflowId}/runs/${n.runId}/reset`,workflow:`/namespaces/${n==null?void 0:n.namespace}/workflows/${n==null?void 0:n.workflowId}/runs/${n==null?void 0:n.runId}`,"workflows.archived":`/namespaces/${n==null?void 0:n.namespace}/workflows/archived`,workflows:`/namespaces/${n==null?void 0:n.namespace}/workflows`,"workflows.count":`/namespaces/${n==null?void 0:n.namespace}/workflows/count`,"activity.complete":`/namespaces/${n.namespace}/workflows/${n.workflowId}/runs/${n.runId}/activities/${n.activityId}/complete`,"activity.fail":`/namespaces/${n.namespace}/workflows/${n.workflowId}/runs/${n.runId}/activities/${n.activityId}/fail`,"batch-operations":`/namespaces/${n.namespace}/batch-operations`,"batch-operation.describe":`/namespaces/${n.namespace}/batch-operations/describe`};return D(i[c])}function un(c,n,o=!0){const i=M(c,n,o);return G(i,n==null?void 0:n.namespace)}export{sn as a,X as b,cn as c,v as d,on as e,S as g,_ as h,e as i,N as n,M as p,un as r};
