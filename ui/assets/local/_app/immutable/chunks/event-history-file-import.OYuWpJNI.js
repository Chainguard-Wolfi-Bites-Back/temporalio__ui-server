import{s as B,a as y,e as C,h as b,b as L,j as u,k as d,m as N,g as v,c as U,t as j,f as x,v as G}from"./scheduler.IHo1m08M.js";import{S as H,i as T,c as E,a as w,m as S,t as F,b as I,d as k}from"./index.4UXyTqh8.js";import{g as q}from"./entry.C5GYw_WG.js";import{B as P}from"./button.2xCJIiLt.js";import{L as R}from"./label.ZA26rOjn.js";import{t as _}from"./translate.HrioCK44.js";import{g as W}from"./index.l2_xiHIw.js";import{t as z}from"./index.Oz6yGyED.js";import{i as D,a as J}from"./import-events.DeWxdnbo.js";import{l as K}from"./namespaces.21MRE01_.js";import{t as A}from"./toaster.rvCWogo3.js";import{p as M}from"./parse-with-big-int.e3oI4SEy.js";import{r as O}from"./route-for.mBAp5rjI.js";function Q(l){let a=_("common.import")+"",r;return{c(){r=j(a)},l(e){r=x(e,a)},m(e,n){d(e,r,n)},p:G,d(e){e&&v(r)}}}function V(l){let a,r,e,n,s,p,c,i;return a=new R({props:{hidden:!0,for:"import-event-history-file-upload",label:_("events.import-event-history-file-upload")}}),s=new P({props:{leadingIcon:"file-upload",disabled:!l[0],$$slots:{default:[Q]},$$scope:{ctx:l}}}),s.$on("click",l[2]),{c(){E(a.$$.fragment),r=y(),e=C("input"),n=y(),E(s.$$.fragment),this.h()},l(t){w(a.$$.fragment,t),r=b(t),e=L(t,"INPUT",{id:!0,class:!0,type:!0,accept:!0}),n=b(t),w(s.$$.fragment,t),this.h()},h(){u(e,"id","import-event-history-file-upload"),u(e,"class","import-input block rounded-md border border-slate-200 p-2"),u(e,"type","file"),u(e,"accept",".json")},m(t,o){S(a,t,o),d(t,r,o),d(t,e,o),d(t,n,o),S(s,t,o),p=!0,c||(i=N(e,"change",l[1]),c=!0)},p(t,[o]){const m={};o&1&&(m.disabled=!t[0]),o&32&&(m.$$scope={dirty:o,ctx:t}),s.$set(m)},i(t){p||(F(a.$$.fragment,t),F(s.$$.fragment,t),p=!0)},o(t){I(a.$$.fragment,t),I(s.$$.fragment,t),p=!1},d(t){t&&(v(r),v(e),v(n)),k(a,t),k(s,t),c=!1,i()}}}function X(l,a,r){let e;U(l,K,i=>r(4,e=i));let n,s=!1;return[s,async i=>{var t;const o=i.target,m=(t=o==null?void 0:o.files)===null||t===void 0?void 0:t[0],f=new FileReader;m&&(f.readAsText(m),f.onload=()=>{var $,h;try{const g=(h=($=f==null?void 0:f.result)===null||$===void 0?void 0:$.toString())!==null&&h!==void 0?h:"";n=M(g),r(0,s=!0)}catch{A.push({variant:"error",message:_("events.event-history-load-error")}),r(0,s=!1)}})},async()=>{try{const i=await z(Array.isArray(n)?n:n==null?void 0:n.events),t=W(i);D.set(i),J.set(t),r(0,s=!1);const o=O(e,"feed");q(o)}catch(i){console.error(i),A.push({variant:"error",message:_("events.event-history-import-error")})}}]}class ft extends H{constructor(a){super(),T(this,a,X,V,B,{})}}export{ft as E};
