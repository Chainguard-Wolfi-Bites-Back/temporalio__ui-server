import{j as r,w as d}from"./singletons.aaba601a.js";import{p as c}from"./stores.c3b6e99b.js";import{a as R}from"./auth-user.25856955.js";import{r as y}from"./workflow-run.4edd018b.js";import{l as u}from"./route-for.7bd63cd0.js";import{G as S}from"./is-event-type.4dbe973b.js";import{e as F}from"./event-view.292e7254.js";import{t as f}from"./index.a7003932.js";import{b as q}from"./parse-with-big-int.441ec82f.js";import{p as h}from"./paginated.153db702.js";import{r as v,a as l}from"./route-for-api.e8eb9c78.js";const A=r([c],([t])=>t.params.namespace?u(t.params.namespace):""),H=r([c],([t])=>t.params.workflow?u(t.params.workflow):""),P=r([c],([t])=>t.params.run?u(t.params.run):""),b=r([c],([t])=>{var e;return(e=t.data)==null?void 0:e.settings}),T=r([R],([t])=>t==null?void 0:t.accessToken),x=r([A,H,P,F],([t,e,s,n])=>({namespace:t,workflowId:e,runId:s,sort:n}));r([x,b,T,y],([t,e,s,n])=>({...t,settings:e,accessToken:s,refresh:y,$refresh:n}));const j={start:[],end:[]},V=d(j),W=d(null),z=d([]),X=r(z,t=>t.filter(S)),k=t=>!q(t)||t==="descending"?"events.descending":t==="ascending"?"events.ascending":"events.descending",Y=async({namespace:t,workflowId:e,runId:s,sort:n,onStart:o,onUpdate:a,onComplete:i})=>{const m=k(n),p=v(m,{namespace:t,workflowId:e,runId:s});return(await h(async E=>l(p,{token:E,request:fetch}),{onStart:o,onUpdate:a,onComplete:i})).history.events},Z=async({namespace:t,workflowId:e,runId:s,sort:n,onStart:o,onUpdate:a,onComplete:i})=>{const m=k(n),p=v(m,{namespace:t,workflowId:e,runId:s}),w=await h(async I=>l(p,{token:I,request:fetch}),{onStart:o,onUpdate:a,onComplete:i});return await f(w.history.events)},g=async({namespace:t,workflowId:e,runId:s,sort:n})=>{const o=v(`events.${n}`,{namespace:t,workflowId:e,runId:s});try{return(await l(o,{request:fetch,params:{maximumPageSize:"20"}})).history.events}catch{return[]}},_=async t=>{const e=await g({...t,sort:"ascending"}),s=await g({...t,sort:"descending"}),[n,o]=await Promise.all([f(e),f(s)]);return{start:n,end:o}};export{Z as a,Y as b,z as c,V as e,_ as f,j as i,X as r,W as t};
