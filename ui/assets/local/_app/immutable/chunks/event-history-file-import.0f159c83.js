import{S as w,b as F,a as S,m as T,c as U,C,p as x,d as A,D as B,u as g,f as y,E as I,T as N,j,g as G,k as b,F as H,K as h,w as q,x as D,n as K}from"./index.f15f06ee.js";import{g as L}from"./navigation.9ea8303a.js";import{p as P}from"./stores.18c05fc6.js";import{B as R}from"./button.1334115e.js";import{t as E}from"./translate.4ba462db.js";import{g as W}from"./index.9920da39.js";import{t as z}from"./index.bfa7d87b.js";import{a as J}from"./auth-user.9088cf7d.js";import{i as M,a as O}from"./import-events.fb8986a1.js";import{l as Q}from"./namespaces.43fd8926.js";import{t as k}from"./toaster.926220f2.js";import{p as V}from"./parse-with-big-int.bccd89af.js";import{d as X}from"./route-for.4dc66680.js";function Y(r){let o=E("import")+"",s;return{c(){s=q(o)},l(e){s=D(e,o)},m(e,a){y(e,s,a)},p:K,d(e){e&&b(s)}}}function Z(r){let o,s,e,a,m,n;return e=new R({props:{icon:"file-upload",disabled:!r[0],$$slots:{default:[Y]},$$scope:{ctx:r}}}),e.$on("click",r[2]),{c(){o=T("input"),s=U(),C(e.$$.fragment),this.h()},l(t){o=x(t,"INPUT",{class:!0,type:!0,accept:!0}),s=A(t),B(e.$$.fragment,t),this.h()},h(){g(o,"class","import-input block rounded-md border border-gray-200 p-2"),g(o,"type","file"),g(o,"accept",".json")},m(t,l){y(t,o,l),y(t,s,l),I(e,t,l),a=!0,m||(n=N(o,"change",r[1]),m=!0)},p(t,[l]){const f={};l&1&&(f.disabled=!t[0]),l&128&&(f.$$scope={dirty:l,ctx:t}),e.$set(f)},i(t){a||(j(e.$$.fragment,t),a=!0)},o(t){G(e.$$.fragment,t),a=!1},d(t){t&&b(o),t&&b(s),H(e,t),m=!1,n()}}}function tt(r,o,s){let e,a,m;h(r,Q,i=>s(4,e=i)),h(r,J,i=>s(5,a=i)),h(r,P,i=>s(6,m=i));let n,t=!1;return[t,async i=>{var p;const c=i.target,d=(p=c==null?void 0:c.files)===null||p===void 0?void 0:p[0],u=new FileReader;d&&(u.readAsText(d),u.onload=()=>{var v,_;try{const $=(_=(v=u==null?void 0:u.result)===null||v===void 0?void 0:v.toString())!==null&&_!==void 0?_:"";n=V($),s(0,t=!0)}catch{k.push({variant:"error",message:E("events","event-history-load-error")}),s(0,t=!1)}})},async()=>{const{settings:i}=m.data;try{const p=await z({response:Array.isArray(n)?n:n==null?void 0:n.events,namespace:e,settings:i,accessToken:a.accessToken}),c=W(p);M.set(p),O.set(c),s(0,t=!1);const d=X(e,"feed");L(d)}catch(p){console.error(p),k.push({variant:"error",message:E("events","event-history-import-error")})}}]}class dt extends w{constructor(o){super(),F(this,o,tt,Z,S,{})}}export{dt as E};
