import{h as c,r as m,w as n}from"./singletons.426f19a7.js";import{p as u}from"./stores.1904ba37.js";import{t as d}from"./translate.fa4eeabe.js";import{R as w,aj as k}from"./index.df672b57.js";import{r as f,a as p}from"./route-for-api.a7e645b7.js";import{g as h,h as g}from"./workflow-service.1a855244.js";const E=async(o,r,t=fetch)=>{let s=0;try{const e=f("workflows.count",{namespace:o}),a=await p(e,{params:r?{query:r}:{},onError:w,handleError:w,request:t});s=parseInt((a==null?void 0:a.count)||"0")}catch{}return{count:s}},j=async({namespace:o,query:r})=>{const t="GROUP BY ExecutionStatus",s=f("workflows.count",{namespace:o}),{count:e,groups:a}=await p(s,{params:{query:r?`${r} ${t}`:`${t}`},notifyOnError:!1});return{count:e??"0",groups:a}},b=300,C=async(o,r,t)=>{r.set(!0);try{await t()}catch(s){console.error(s)}o.set(!1),setTimeout(()=>{r.set(!1)},b)},W=c([u],([o])=>{var r,t,s;return!!((s=(t=(r=o.data)==null?void 0:r.systemInfo)==null?void 0:t.capabilities)!=null&&s.countGroupByExecutionStatus)}),A=n(0),B=c([u],([o])=>{var r,t;return(t=(r=o.data)==null?void 0:r.settings)==null?void 0:t.hideWorkflowQueryErrors}),q=c([u],([o])=>o.params.namespace),v=c([u],([o])=>o.url.searchParams.get("query")),Q=c([q,v,A,h,B],([o,r,t,s,e])=>({namespace:o,query:r,refresh:t,supportsAdvancedVisibility:s,hideWorkflowQueryErrors:e})),x=o=>{I.set({...o,newCount:0})},P=o=>Q.subscribe(({namespace:r,query:t,supportsAdvancedVisibility:s,hideWorkflowQueryErrors:e})=>{C(S,R,async()=>{const{workflows:a,error:l}=await g(r,{query:t});if(o(a),s&&!k(W)){const y=await E(r,t);x(y)}l?e?i.set(d("workflows.workflows-error-querying")):i.set(l):i.set("")})}),L=n(""),R=n(!0),S=n(!0),I=n({count:0,newCount:0}),i=n(""),T=m([],P),U=n("");export{I as a,U as b,i as c,T as d,j as f,W as g,S as l,A as r,R as u,L as w};
