import{d as z}from"./decode-payload.bfde7091.js";import{W as Q,n as d}from"./index.a36c9cb0.js";import{s as U}from"./settings.34723850.js";import{s as $}from"./simplify-attributes.ba9bcd12.js";import{r as l,a as f,b as B,i as R,c as q}from"./route-for-api.cbb05678.js";import{t as _}from"./list-workflow-query.687d10c8.js";import{s as E}from"./parse-with-big-int.0036a80a.js";import{f as D}from"./route-for.f39f2e15.js";import{v as L}from"./toaster.16c48a98.js";const N=(o=U)=>!Q(o).disableWriteActions,j=(o=[])=>o.map(t=>{const n=$(t,!0),r=t.activityId;return{...n,id:r}}),I=o=>{var x,g,b,T,W,A;const{searchAttributes:t,memo:n}=z(o==null?void 0:o.workflowExecutionInfo),r=o.workflowExecutionInfo.type.name,e=o.workflowExecutionInfo.execution.workflowId,i=o.workflowExecutionInfo.execution.runId,a=o.workflowExecutionInfo.startTime,c=o.workflowExecutionInfo.closeTime,u=o.workflowExecutionInfo.status,w=o.workflowExecutionInfo.status==="Running",h=o.workflowExecutionInfo.historyLength,y=o.workflowExecutionInfo.historySizeBytes,s=`/workflows/${e}/${i}`,k=((g=(x=o==null?void 0:o.executionConfig)==null?void 0:x.taskQueue)==null?void 0:g.name)||((b=o==null?void 0:o.workflowExecutionInfo)==null?void 0:b.taskQueue),m=(T=o==null?void 0:o.workflowExecutionInfo)==null?void 0:T.parentNamespaceId,v=(W=o==null?void 0:o.workflowExecutionInfo)==null?void 0:W.parentExecution,C=o.workflowExecutionInfo.stateTransitionCount,F=(A=o.executionConfig)==null?void 0:A.defaultWorkflowTaskTimeout,O=j(o.pendingActivities),p=(o==null?void 0:o.pendingChildren)??[];return{name:r,id:e,runId:i,startTime:a,endTime:c,status:u,historyEvents:h,historySizeBytes:y,searchAttributes:t,memo:n,url:s,taskQueue:k,pendingActivities:O,pendingChildren:p,parentNamespaceId:m,parent:v,stateTransitionCount:C,isRunning:w,defaultWorkflowTaskTimeout:F,get canBeTerminated(){return w&&N()}}},S=o=>(o.executions||[]).map(t=>I({workflowExecutionInfo:t})),G=o=>window.btoa(encodeURIComponent(o).replace(/%([0-9A-F]{2})/g,(t,n)=>String.fromCharCode(parseInt(n,16)))),P=(o,t=D)=>t?G(o):o,no=async(o,t,n=fetch)=>{let r=0,e=0;try{const i=l("workflows.count",{namespace:o});if(t){const a=f(i,{params:{query:t},onError:d,handleError:d,request:n}),c=f(i,{params:{query:""},onError:d,handleError:d,request:n}),[u,w]=await Promise.all([a,c]);e=u==null?void 0:u.count,r=w==null?void 0:w.count}else{const a=await f(i,{params:{},onError:d,handleError:d,request:n});r=a==null?void 0:a.count}}catch{}return{count:e,totalCount:r}},H=async(o,t,n=fetch,r=!1)=>{const e=t.query||_(t,r);let i;try{i=decodeURIComponent(e)}catch{i=e}const a=r?"workflows.archived":"workflows";let c="";const u=s=>{var k,m;B(s),(k=s==null?void 0:s.body)!=null&&k.message||s!=null&&s.status?c=((m=s==null?void 0:s.body)==null?void 0:m.message)??`Error fetching workflows: ${s.status}: ${s.statusText}`:c="Error fetching workflows: Server failed to respond"},w=l(a,{namespace:o}),{executions:h,nextPageToken:y}=await f(w,{params:{query:i},onError:u,handleError:u,request:n})??{executions:[],nextPageToken:""};return{workflows:S({executions:h}),nextPageToken:String(y),error:c}},ro=async(o,t=fetch)=>{var u;const{namespace:n,workflowId:r}=o,i=l("workflows",{namespace:n}),{executions:a}=await f(i,{params:{query:`WorkflowId="${r}"`,pageSize:"1"},request:t})??{executions:[]},c=(u=S({executions:a}))==null?void 0:u[0];return{runId:c==null?void 0:c.runId}},eo=async(o,t=fetch,n=!1)=>{const r=n?"workflows.archived":"workflows";let e=!0;const i=c=>{(R(c)||q(c))&&(e=!1)},a=l(r,{namespace:o});return await f(a,{params:{pageSize:"1"},onError:i,handleError:i,request:t}),{authorized:e}},io=async(o,t,n=fetch)=>H(o,t,n,!0);async function ao(o,t=fetch){const n=l("workflow",o);return f(n,{request:t}).then(I)}async function co({workflow:o,namespace:t,reason:n}){const r=l("workflow.terminate",{namespace:t,workflowId:o.id,runId:o.runId});return await f(r,{options:{method:"POST",body:E({reason:n})},shouldRetry:!1,notifyOnError:!1})}async function so({namespace:o,workflowId:t,runId:n},r=fetch){const e=l("workflow.cancel",{namespace:o,workflowId:t,runId:n});return f(e,{request:r,notifyOnError:!1,options:{method:"POST"}})}async function fo({namespace:o,workflowId:t,runId:n,signalName:r,signalInput:e}){const i=l("workflow.signal",{namespace:o,workflowId:t,runId:n});return f(i,{notifyOnError:!1,options:{method:"POST",body:E({signalName:r,input:{payloads:e?[{metadata:{encoding:P("json/plain")},data:P(e)}]:null}})}})}async function uo({namespace:o,workflowId:t,runId:n,eventId:r,reason:e}){const i=l("workflow.reset",{namespace:o,workflowId:t,runId:n}),a={workflowExecution:{workflowId:t,runId:n},workflowTaskFinishEventId:r,requestId:L(),reason:e};return f(i,{notifyOnError:!1,options:{method:"POST",body:E(a)}})}async function lo(o,t=fetch){const n=e=>{console.error(e)},r=l("workflow",o);return f(r,{request:t,onError:n,handleError:n}).then(I)}export{H as a,no as b,so as c,eo as d,io as e,ao as f,lo as g,ro as h,uo as r,fo as s,co as t,N as w};
