import{S as w,b as F,a as S,m as T,c as U,C,p as x,d as A,D as B,u as g,f as y,E as I,T as N,j,g as G,k as b,F as H,K as h,w as q,x as D,n as K}from"./index.e1c99c2b.js";import{d as L}from"./route-for.bb4abe2c.js";import{g as P}from"./navigation.d5a58e6b.js";import{B as R}from"./button.7361447c.js";import{t as W}from"./index.93e7613f.js";import{t as k}from"./toaster.7dc81cff.js";import{i as z,a as J}from"./import-events.ded7c9a1.js";import{p as M}from"./parse-with-big-int.bccd89af.js";import{g as O}from"./index.78939e02.js";import{p as Q}from"./stores.22cb3cc5.js";import{a as V}from"./auth-user.1c993420.js";import{l as X}from"./namespaces.1143d223.js";import{t as E}from"./translate.4ba462db.js";function Y(r){let o=E("import")+"",s;return{c(){s=q(o)},l(e){s=D(e,o)},m(e,a){y(e,s,a)},p:K,d(e){e&&b(s)}}}function Z(r){let o,s,e,a,m,n;return e=new R({props:{icon:"file-upload",disabled:!r[0],$$slots:{default:[Y]},$$scope:{ctx:r}}}),e.$on("click",r[2]),{c(){o=T("input"),s=U(),C(e.$$.fragment),this.h()},l(t){o=x(t,"INPUT",{class:!0,type:!0,accept:!0}),s=A(t),B(e.$$.fragment,t),this.h()},h(){g(o,"class","import-input block rounded-md border border-gray-200 p-2"),g(o,"type","file"),g(o,"accept",".json")},m(t,l){y(t,o,l),y(t,s,l),I(e,t,l),a=!0,m||(n=N(o,"change",r[1]),m=!0)},p(t,[l]){const f={};l&1&&(f.disabled=!t[0]),l&128&&(f.$$scope={dirty:l,ctx:t}),e.$set(f)},i(t){a||(j(e.$$.fragment,t),a=!0)},o(t){G(e.$$.fragment,t),a=!1},d(t){t&&b(o),t&&b(s),H(e,t),m=!1,n()}}}function tt(r,o,s){let e,a,m;h(r,X,i=>s(4,e=i)),h(r,V,i=>s(5,a=i)),h(r,Q,i=>s(6,m=i));let n,t=!1;return[t,async i=>{var p;const c=i.target,d=(p=c==null?void 0:c.files)===null||p===void 0?void 0:p[0],u=new FileReader;d&&(u.readAsText(d),u.onload=()=>{var v,_;try{const $=(_=(v=u==null?void 0:u.result)===null||v===void 0?void 0:v.toString())!==null&&_!==void 0?_:"";n=M($),s(0,t=!0)}catch{k.push({variant:"error",message:E("events","event-history-load-error")}),s(0,t=!1)}})},async()=>{const{settings:i}=m.data;try{const p=await W({response:Array.isArray(n)?n:n==null?void 0:n.events,namespace:e,settings:i,accessToken:a.accessToken}),c=O(p);z.set(p),J.set(c),s(0,t=!1);const d=L(e,"feed");P(d)}catch(p){console.error(p),k.push({variant:"error",message:E("events","event-history-import-error")})}}]}class dt extends w{constructor(o){super(),F(this,o,tt,Z,S,{})}}export{dt as E};
