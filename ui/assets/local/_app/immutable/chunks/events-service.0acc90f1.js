import{d as r,w as u}from"./index.c0615b9d.js";import{p as m}from"./stores.3892283d.js";import{a as S}from"./auth-user.58d364c3.js";import{r as y}from"./workflow-run.b0b7432d.js";import{k as v}from"./route-for.2a94a5e2.js";import{G as F}from"./is-event-type.4dbe973b.js";import{e as q}from"./event-view.62b44238.js";import{t as f}from"./index.bde020e8.js";import{b as A}from"./is.ba28a1ea.js";import{p as h}from"./paginated.cdcd38c5.js";import{r as l,a as w}from"./route-for-api.0d358789.js";const H=r([m],([t])=>t.params.namespace?v(t.params.namespace):""),P=r([m],([t])=>t.params.workflow?v(t.params.workflow):""),T=r([m],([t])=>t.params.run?v(t.params.run):""),b=r([m],([t])=>{var e;return(e=t.data)==null?void 0:e.settings}),x=r([S],([t])=>t==null?void 0:t.accessToken),z=r([H,P,T,q],([t,e,s,n])=>({namespace:t,workflowId:e,runId:s,sort:n}));r([z,b,x,y],([t,e,s,n])=>({...t,settings:e,accessToken:s,refresh:y,$refresh:n}));const G={start:[],end:[]},X=u(G),Y=u(null),j=u([]),Z=r(j,t=>t.filter(F)),k=t=>!A(t)||t==="descending"?"events.descending":t==="ascending"?"events.ascending":"events.descending",_=async({namespace:t,workflowId:e,runId:s,sort:n,onStart:o,onUpdate:a,onComplete:c})=>{const i=k(n),p=l(i,{namespace:t,workflowId:e,runId:s});return(await h(async d=>w(p,{token:d,request:fetch}),{onStart:o,onUpdate:a,onComplete:c})).history.events},U=async({namespace:t,workflowId:e,runId:s,sort:n,settings:o,accessToken:a,onStart:c,onUpdate:i,onComplete:p})=>{const E=k(n),d=l(E,{namespace:t,workflowId:e,runId:s}),I=await h(async R=>w(d,{token:R,request:fetch}),{onStart:c,onUpdate:i,onComplete:p});return await f({response:I.history.events,namespace:t,settings:o,accessToken:a})},g=async({namespace:t,workflowId:e,runId:s,sort:n})=>{const o=l(`events.${n}`,{namespace:t,workflowId:e,runId:s});try{return(await w(o,{request:fetch,params:{maximumPageSize:"20"}})).history.events}catch{return[]}},$=async t=>{const{settings:e,namespace:s,accessToken:n}=t,o=await g({...t,sort:"ascending"}),a=await g({...t,sort:"descending"}),[c,i]=await Promise.all([f({response:o,namespace:s,settings:e,accessToken:n}),f({response:a,namespace:s,settings:e,accessToken:n})]);return{start:c,end:i}};export{U as a,_ as b,j as c,X as e,$ as f,G as i,Z as r,Y as t};
