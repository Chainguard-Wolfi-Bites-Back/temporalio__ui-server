import{d as r,w as u}from"./index.9af4d667.js";import{p as m}from"./stores.3160f878.js";import{a as S}from"./auth-user.9088cf7d.js";import{r as y}from"./workflow-run.c5b9c1b0.js";import{k as v}from"./route-for.abf067f0.js";import{E as F}from"./is-event-type.9acd04c8.js";import{e as q}from"./event-view.c67db675.js";import{t as f}from"./index.d2705f43.js";import{b as A}from"./is.ba28a1ea.js";import{p as h}from"./paginated.e27395dc.js";import{r as l,a as w}from"./route-for-api.8e8540b7.js";const H=r([m],([t])=>t.params.namespace?v(t.params.namespace):""),P=r([m],([t])=>t.params.workflow?v(t.params.workflow):""),T=r([m],([t])=>t.params.run?v(t.params.run):""),b=r([m],([t])=>{var e;return(e=t.data)==null?void 0:e.settings}),x=r([S],([t])=>t==null?void 0:t.accessToken),z=r([H,P,T,q],([t,e,s,n])=>({namespace:t,workflowId:e,runId:s,sort:n}));r([z,b,x,y],([t,e,s,n])=>({...t,settings:e,accessToken:s,refresh:y,$refresh:n}));const j={start:[],end:[]},X=u(j),Y=u(null),B=u([]),Z=r(B,t=>t.filter(F)),k=t=>!A(t)||t==="descending"?"events.descending":t==="ascending"?"events.ascending":"events.descending",_=async({namespace:t,workflowId:e,runId:s,sort:n,onStart:o,onUpdate:a,onComplete:c})=>{const i=k(n),p=l(i,{namespace:t,workflowId:e,runId:s});return(await h(async d=>w(p,{token:d,request:fetch}),{onStart:o,onUpdate:a,onComplete:c})).history.events},U=async({namespace:t,workflowId:e,runId:s,sort:n,settings:o,accessToken:a,onStart:c,onUpdate:i,onComplete:p})=>{const E=k(n),d=l(E,{namespace:t,workflowId:e,runId:s}),I=await h(async R=>w(d,{token:R,request:fetch}),{onStart:c,onUpdate:i,onComplete:p});return await f({response:I.history.events,namespace:t,settings:o,accessToken:a})},g=async({namespace:t,workflowId:e,runId:s,sort:n})=>{const o=l(`events.${n}`,{namespace:t,workflowId:e,runId:s});try{return(await w(o,{request:fetch,params:{maximumPageSize:"20"}})).history.events}catch{return[]}},$=async t=>{const{settings:e,namespace:s,accessToken:n}=t,o=await g({...t,sort:"ascending"}),a=await g({...t,sort:"descending"}),[c,i]=await Promise.all([f({response:o,namespace:s,settings:e,accessToken:n}),f({response:a,namespace:s,settings:e,accessToken:n})]);return{start:c,end:i}};export{U as a,_ as b,B as c,X as e,$ as f,j as i,Z as r,Y as t};
