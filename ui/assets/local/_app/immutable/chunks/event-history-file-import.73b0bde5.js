import{S as w,i as C,s as I,k as $,q as F,a as g,y as k,l as E,m as H,r as S,h as d,c as A,z as L,n as f,b as _,F as N,A as U,H as q,g as x,d as G,B as R,C as T,R as j}from"./index.df672b57.js";import{g as z}from"./navigation.ac2620dd.js";import{B as P}from"./button.10c12074.js";import{t as y}from"./translate.fa4eeabe.js";import{g as W}from"./index.99a6b2a9.js";import{t as D}from"./index.8d472de3.js";import{i as J,a as K}from"./import-events.ffec25ed.js";import{l as M}from"./namespaces.510a9f29.js";import{t as B}from"./toaster.7e0ad65c.js";import{p as O}from"./parse-with-big-int.b2dd742c.js";import{f as Q}from"./route-for.8510bd21.js";function V(m){let o=y("common.import")+"",n;return{c(){n=F(o)},l(i){n=S(i,o)},m(i,r){_(i,n,r)},p:j,d(i){i&&d(n)}}}function X(m){let o,n=y("events.import-event-history-file-upload")+"",i,r,s,v,l,a,p,c;return l=new P({props:{leadingIcon:"file-upload",disabled:!m[0],$$slots:{default:[V]},$$scope:{ctx:m}}}),l.$on("click",m[2]),{c(){o=$("label"),i=F(n),r=g(),s=$("input"),v=g(),k(l.$$.fragment),this.h()},l(t){o=E(t,"LABEL",{class:!0,for:!0});var e=H(o);i=S(e,n),e.forEach(d),r=A(t),s=E(t,"INPUT",{id:!0,class:!0,type:!0,accept:!0}),v=A(t),L(l.$$.fragment,t),this.h()},h(){f(o,"class","sr-only"),f(o,"for","import-event-history-file-upload"),f(s,"id","import-event-history-file-upload"),f(s,"class","import-input block rounded-md border border-slate-200 p-2"),f(s,"type","file"),f(s,"accept",".json")},m(t,e){_(t,o,e),N(o,i),_(t,r,e),_(t,s,e),_(t,v,e),U(l,t,e),a=!0,p||(c=q(s,"change",m[1]),p=!0)},p(t,[e]){const u={};e&1&&(u.disabled=!t[0]),e&32&&(u.$$scope={dirty:e,ctx:t}),l.$set(u)},i(t){a||(x(l.$$.fragment,t),a=!0)},o(t){G(l.$$.fragment,t),a=!1},d(t){t&&d(o),t&&d(r),t&&d(s),t&&d(v),R(l,t),p=!1,c()}}}function Y(m,o,n){let i;T(m,M,a=>n(4,i=a));let r,s=!1;return[s,async a=>{var p;const c=a.target,t=(p=c==null?void 0:c.files)===null||p===void 0?void 0:p[0],e=new FileReader;t&&(e.readAsText(t),e.onload=()=>{var u,h;try{const b=(h=(u=e==null?void 0:e.result)===null||u===void 0?void 0:u.toString())!==null&&h!==void 0?h:"";r=O(b),n(0,s=!0)}catch{B.push({variant:"error",message:y("events.event-history-load-error")}),n(0,s=!1)}})},async()=>{try{const a=await D(Array.isArray(r)?r:r==null?void 0:r.events),p=W(a);J.set(a),K.set(p),n(0,s=!1);const c=Q(i,"feed");z(c)}catch(a){console.error(a),B.push({variant:"error",message:y("events.event-history-import-error")})}}]}class mt extends w{constructor(o){super(),C(this,o,Y,X,I,{})}}export{mt as E};
