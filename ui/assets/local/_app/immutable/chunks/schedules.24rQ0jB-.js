import{s as O,x as I,k as Q,v as F,g as v,z,A as T,e as C,a as H,b as M,d as b,h as L,j,l as N}from"./scheduler.AWtTlMeO.js";import{S as P,i as U,g as V,b as S,e as G,t as w,c as J,a as K,m as R,d as X}from"./index.91lpp7Ff.js";import{C as Y}from"./code-block.xA7h_1CH.js";import{t as y}from"./translate.HrioCK44.js";import{s as W}from"./parse-with-big-int.e3oI4SEy.js";import{w as E,g as q}from"./entry.Wg5yVBd4.js";import{c as Z,e as x}from"./schedule-service.4Ov5-CJO.js";import{e as A}from"./encode-payload.FIkSHqiW.js";import{h as $,i as ee}from"./route-for.x0P84ofB.js";function D(s){let e,n,r=y("common.timezone",{timezone:s[2]})+"",a,t,i,l;return t=new Y({props:{copyable:!0,inline:s[3],testId:"schedule-calendar",language:"json",content:W(s[0]||s[1])}}),{c(){e=C("div"),n=C("p"),a=H(),J(t.$$.fragment),this.h()},l(o){e=M(o,"DIV",{class:!0});var c=b(e);n=M(c,"P",{});var u=b(n);u.forEach(v),a=L(c),K(t.$$.fragment,c),c.forEach(v),this.h()},h(){j(e,"class",i="flex flex-col "+s[4].class)},m(o,c){Q(o,e,c),N(e,n),n.innerHTML=r,N(e,a),R(t,e,null),l=!0},p(o,c){(!l||c&4)&&r!==(r=y("common.timezone",{timezone:o[2]})+"")&&(n.innerHTML=r);const u={};c&8&&(u.inline=o[3]),c&3&&(u.content=W(o[0]||o[1])),t.$set(u),(!l||c&16&&i!==(i="flex flex-col "+o[4].class))&&j(e,"class",i)},i(o){l||(w(t.$$.fragment,o),l=!0)},o(o){S(t.$$.fragment,o),l=!1},d(o){o&&v(e),X(t)}}}function te(s){let e=[s[0],s[1]],n,r,a=D(s);return{c(){a.c(),n=I()},l(t){a.l(t),n=I()},m(t,i){a.m(t,i),Q(t,n,i),r=!0},p(t,[i]){i&3&&O(e,e=[t[0],t[1]])?(V(),S(a,1,1,F),G(),a=D(t),a.c(),w(a,1),a.m(n.parentNode,n)):a.p(t,i)},i(t){r||(w(a),r=!0)},o(t){S(a),r=!1},d(t){t&&v(n),a.d(t)}}}function ne(s,e,n){let{calendar:r=void 0}=e,{interval:a=void 0}=e,{timezoneName:t="UTC"}=e,{inline:i=!1}=e;return s.$$set=l=>{n(4,e=z(z({},e),T(l))),"calendar"in l&&n(0,r=l.calendar),"interval"in l&&n(1,a=l.interval),"timezoneName"in l&&n(2,t=l.timezoneName),"inline"in l&&n(3,i=l.inline)},e=T(e),[r,a,t,i,e]}class he extends P{constructor(e){super(),U(this,e,ne,te,O,{calendar:0,interval:1,timezoneName:2,inline:3})}}const _=s=>s?parseInt(s):0,se=(s,e,n,r)=>`${_(s)*60*60*24+_(e)*60*60+_(n)*60+_(r)}s`,ae=({months:s=[],daysOfMonth:e=[],daysOfWeek:n=[]})=>{var l,o;const r=s.sort((c,u)=>parseInt(c)-parseInt(u)).join(","),a=e.sort((c,u)=>c-u).join(","),i=(((o=(l=n==null?void 0:n[0])==null?void 0:l.split(","))==null?void 0:o.length)>1?n[0].split(","):n).sort((c,u)=>parseInt(c)-parseInt(u)).join(",");return{month:r,dayOfMonth:a,dayOfWeek:i}},B=(s,e,n)=>{const{hour:r,minute:a,second:t,phase:i,cronString:l}=e,{preset:o,months:c,days:u,daysOfMonth:d,daysOfWeek:f}=n;if(o==="string"){const m=`${l}#${l}`;s.schedule.spec.cronString=[m],s.schedule.spec.calendar=[],s.schedule.spec.interval=[]}else if(o==="interval"){const m=se(u,r,a,t);s.schedule.spec.interval=[{interval:m,phase:i||"0s"}],s.schedule.spec.cronString=[],s.schedule.spec.calendar=[]}else{const{month:m,dayOfMonth:k,dayOfWeek:g}=ae({months:c,daysOfMonth:d,daysOfWeek:f});s.schedule.spec.calendar=[{year:"*",month:o==="month"?m:"",dayOfMonth:o==="month"?k:"",dayOfWeek:o==="week"?g:"",hour:r,minute:a,second:t}],s.schedule.spec.interval=[],s.schedule.spec.cronString=[]}},pe=async({action:s,spec:e,presets:n})=>{const{namespace:r,name:a,workflowId:t,workflowType:i,taskQueue:l,input:o}=s;let c;if(o)try{c=await A(o)}catch(f){p.set(`${y("data-encoder.encode-error")}: ${f==null?void 0:f.message}`);return}const u={schedule_id:a.trim(),schedule:{spec:{calendar:[],interval:[],cronString:[]},action:{startWorkflow:{workflowId:t,workflowType:{name:i},taskQueue:{name:l},input:c?{payloads:c}:null}}}};B(u,e,n),h.set(!0);const{error:d}=await Z({scheduleId:a,namespace:r,body:u});d?(p.set(d),h.set(!1)):setTimeout(()=>{p.set(""),h.set(!1),q($({namespace:r}))},2e3)},ge=async({action:s,spec:e,presets:n},r,a)=>{const{namespace:t,name:i,workflowId:l,workflowType:o,taskQueue:c,input:u}=s;let d;if(u)try{d=await A(u)}catch(g){p.set(`${y("data-encoder.encode-error")}: ${g==null?void 0:g.message}`);return}const{preset:f}=n,m={schedule_id:a,schedule:{...r,action:{startWorkflow:{...r.action.startWorkflow,workflowId:l,workflowType:{name:o},taskQueue:{name:c},input:d?{payloads:d}:null}}}};f==="existing"?m.schedule.spec=r.spec:(B(m,e,n),m.schedule.spec.structuredCalendar=[]),h.set(!0);const{error:k}=await x({namespace:t,scheduleId:a,body:m});k?(p.set(k),h.set(!1)):setTimeout(()=>{q(ee({namespace:t,scheduleId:i})),p.set(""),h.set(!1)},2e3)},h=E(!1),p=E("");export{he as S,pe as a,p as e,h as l,ge as s};
