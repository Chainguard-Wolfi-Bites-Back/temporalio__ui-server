import{ac as m}from"./index.9b814669.js";import{t as p}from"./translate.c28e5b4f.js";import{b as E,r as T,t as x}from"./time-format.988773f8.js";import{c}from"./format-camel-case.887ffc78.js";import{i as I}from"./index.15ffb41c.js";import{h as f,i as k}from"./has.0120f47d.js";import{C as S}from"./is-event-type.4dbe973b.js";const b={key:"",value:""},g=new Set(["activityId","attempt","binaryChecksum","identity","parentInitiatedEventId","requestId","scheduledEventId","startedEventId","lastHeartbeatTime","scheduledTime","expirationTime"]),X=t=>g.has(t),j=new Set(["suggestContinueAsNew","historySizeBytes"]),y=(t,e)=>!(e===null||e===void 0||e===""||e==="0s"||t==="type"||(!e||e==="0")&&j.has(t)),D=t=>!(t===null||t===void 0||t===""||Array.isArray(t)&&!t.length),Y=t=>typeof t=="string"?t:[t==null?void 0:t.payloads,t==null?void 0:t.indexedFields,t==null?void 0:t.points,t].find(e=>e!==void 0),O=t=>{if(k(t)){if(f(t,"stackTrace")&&t.stackTrace)return t.stackTrace;for(const e in t)if(k(t[e]))return O(t[e])}},R=["baseRunId","continuedExecutionRunId","firstExecutionRunId","newExecutionRunId","newRunId","originalExecutionRunId"],Z=t=>{for(const e of R)if(t===e)return!0;return!1},L=["taskQueueName"],tt=t=>{for(const e of L)if(t===e)return!0;return!1},G=["workflowExecutionWorkflowId","workflowExecutionRunId"],et=(t,e)=>{const r=Boolean((e==null?void 0:e.workflowExecutionWorkflowId)&&(e==null?void 0:e.workflowExecutionRunId));for(const o of G)if(t===o&&r)return!0;return!1},u=(t,e)=>{if(typeof e=="object"){const[r]=Object.keys(e);return r==="payloads"?{key:t,value:e}:{key:t+c(r),value:e[r]}}else return{key:t,value:e.toString()}},N=["failure","input","activityType","parentInitiatedEventId","workflowExecution","workflowType","taskQueue"],Q=({attributes:t})=>{for(const[e,r]of Object.entries(t))if(y(e,r))return u(e,r)},A=t=>{if(f(t,"ActivityType"))return t.ActivityType;if(f(t,"activity_type"))return t.activity_type},w=t=>{var r,o,n,s;const e=Q(t);if(S(t)){const i=(s=(n=(o=(r=t.markerRecordedEventAttributes)==null?void 0:r.details)==null?void 0:o.data)==null?void 0:n.payloads)==null?void 0:s[0],a=A(i);if(a)return u("ActivityType",a)}for(const[i,a]of Object.entries(t.attributes))for(const h of N)if(i===h&&y(i,a))return u(i,a);return e},F=({lastEvent:t})=>w(t),rt=t=>t?I(t)?F(t):w(t):b,K=new Set(["header"]),W=new Set(["taskQueue","retryPolicy","parentWorkflowExecution","workflowExecution","meta"]),v=new Set(["maximumAttempts"]),l=p("workflows.unlimited"),C=p("workflows.no-expiration"),ot=(t,e)=>t===0?C:e,nt=(t,e)=>t?t-e:l,st=t=>t||l,P=(t,e)=>t==="maximumAttempts"&&!e?l:e,V=(t,e)=>{if(W.has(e)&&typeof t[e]=="object"){for(const[r,o]of Object.entries(t[e]))D(o)&&(v.has(r)?t[`${e}${c(r)}`]=P(r,o):t[`${e}${c(r)}`]=o);delete t[e]}},it=(t,{compact:e}={compact:!1})=>{const r={};e&&(r.eventTime=E(t.eventTime,m(x),{relative:m(T)}));for(const[o,n]of Object.entries(t.attributes)){const s=y(o,n);!K.has(o)&&s&&(r[o]=n),V(r,o)}return r},d=["summary","parent","activity","taskQueue","schedule","retryPolicy","workflow"],at={activity:{label:"events.attribute-group.activity"},parent:{label:"events.attribute-group.parent"},retryPolicy:{label:"events.attribute-group.retry-policy"},schedule:{label:"events.attribute-group.schedule"},summary:{label:"events.attribute-group.summary"},taskQueue:{label:"events.attribute-group.task-queue"},workflow:{label:"events.attribute-group.workflow"}},_=(t,e)=>{var r,o;t.category==="activity"&&((r=e==null?void 0:e.activity)!=null&&r.length)&&(e.summary=[...e.activity,...e.summary],e.activity=[]),t.category==="activity"&&((o=e==null?void 0:e.workflow)!=null&&o.length)&&(e.summary=[...e.summary,...e.workflow],e.workflow=[])},$=t=>{const e=new Set(["summary"]);for(const[r,o]of Object.entries(t))o.length===1&&!e.has(r)&&(t.summary=[...t.summary,...o],t[r]=[])},ct=(t,e)=>{const r={};d.forEach(o=>{o==="summary"?r[o]=Object.keys(e).filter(n=>n!=="searchAttributes"):r[o]=[]});for(const o in e){const n=d.find(s=>o.includes(s));n&&(r[n]=[o,...r[n]],r.summary=r.summary.filter(s=>s!==o))}return _(t,r),$(r),r};export{at as a,O as b,et as c,tt as d,X as e,it as f,Y as g,ct as h,rt as i,ot as j,nt as k,st as l,Z as s};
