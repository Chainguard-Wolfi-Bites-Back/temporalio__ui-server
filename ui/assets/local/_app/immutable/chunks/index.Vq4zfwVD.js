import{h as m,b as C}from"./has.88qJpRyK.js";import{j as F,k as O,l as H,m as V,n as L,o as _,c as v,e as R,p as J,q as $,r as G,s as D,t as X,d as j,u as Y,f as K,v as Z,w as tt,x as it,y as rt,b as et,z as st,A as nt,B as ot,C as at,D as dt,E as ut,i as y,F as h,G as g,H as I,I as x,J as b,K as w,L as k,M as ct}from"./is-event-type.Bb50wJi-.js";import{d as ft}from"./format-time.cN3FqhbO.js";import{c as lt}from"./format-camel-case.GLYQBque.js";import{h as Et}from"./decode-payload.tJblEpZj.js";const N=t=>F(t)||O(t)||H(t)||V(t)||L(t)||_(t)||v(t)||R(t)||J(t)||$(t),jt=t=>T(t)?t.isFailureOrTimedOut:N(t),q=t=>G(t)||D(t)||X(t)||j(t),Kt=t=>T(t)?t.isCanceled:q(t),B=t=>Y(t)||K(t),Nt=t=>T(t)?t.isTerminated:B(t),S=t=>Z(t)?String(t.activityTaskStartedEventAttributes.scheduledEventId):G(t)?String(t.activityTaskCanceledEventAttributes.scheduledEventId):tt(t)?String(t.activityTaskCancelRequestedEventAttributes.scheduledEventId):O(t)?String(t.activityTaskFailedEventAttributes.scheduledEventId):F(t)?String(t.activityTaskTimedOutEventAttributes.scheduledEventId):it(t)?String(t.activityTaskCompletedEventAttributes.scheduledEventId):rt(t)?String(t.childWorkflowExecutionStartedEventAttributes.initiatedEventId):K(t)?String(t.childWorkflowExecutionTerminatedEventAttributes.initiatedEventId):et(t)?String(t.childWorkflowExecutionCompletedEventAttributes.initiatedEventId):j(t)?String(t.childWorkflowExecutionCanceledEventAttributes.initiatedEventId):v(t)?String(t.childWorkflowExecutionFailedEventAttributes.initiatedEventId):R(t)?String(t.childWorkflowExecutionTimedOutEventAttributes.initiatedEventId):st(t)?String(t.timerFiredEventAttributes.startedEventId):D(t)?String(t.timerCanceledEventAttributes.startedEventId):nt(t)?String(t.workflowExecutionUpdateCompletedEventAttributes.acceptedEventId):ot(t)?String(t.externalWorkflowExecutionSignaledEventAttributes.initiatedEventId):at(t)?String(t.workflowTaskStartedEventAttributes.scheduledEventId):dt(t)?String(t.workflowTaskCompletedEventAttributes.scheduledEventId):ut(t)?String(t.workflowTaskFailedEventAttributes.scheduledEventId):L(t)?String(t.workflowTaskTimedOutEventAttributes.scheduledEventId):t.id,kt={key:"",value:""},pt=new Set(["activityId","attempt","binaryChecksum","identity","parentInitiatedEventId","requestId","scheduledEventId","startedEventId","lastHeartbeatTime","scheduledTime","expirationTime"]),qt=t=>pt.has(t),Q=new Set(["suggestContinueAsNew","historySizeBytes"]),U=(t,i)=>!(i===null||i===void 0||i===""||i==="0s"||t==="type"||(!i||i==="0")&&Q.has(t)),mt=["attempt","maximumAttempts","heartbeatDetails","lastHeartbeatTime","lastFailure","lastStartedTime","scheduledTime","expirationTime","lastWorkerIdentity"],Bt=t=>mt.includes(t),Qt=(t,i)=>!(i===null||i===void 0||i===""||i==="0s"||t==="type"||t==="workflowId"||t==="initiatedEventId"||t==="startedEventId"||t==="scheduledEventId"||t==="activityId"||t==="namespace"||t==="namespaceId"||t==="workflowTaskCompletedEventId"||t==="taskQueueKind"||(!i||i==="0")&&Q.has(t)),Ut=t=>!(t===null||t===void 0||t===""||Array.isArray(t)&&!t.length),Mt=t=>typeof t=="string"?t:[t==null?void 0:t.payloads,t==null?void 0:t.indexedFields,t==null?void 0:t.points,t].find(i=>i!==void 0),yt=t=>{if(C(t)){if(m(t,"stackTrace")&&t.stackTrace)return t.stackTrace;for(const i in t)if(C(t[i]))return yt(t[i])}},gt=["baseRunId","continuedExecutionRunId","firstExecutionRunId","newExecutionRunId","newRunId","originalExecutionRunId"],Pt=t=>{for(const i of gt)if(t===i)return!0;return!1},wt=["taskQueueName"],zt=t=>{for(const i of wt)if(t===i)return!0;return!1},Tt=["workflowExecutionWorkflowId","workflowExecutionRunId"],Ht=(t,i)=>{const r=!!(i!=null&&i.workflowExecutionWorkflowId&&(i!=null&&i.workflowExecutionRunId));for(const e of Tt)if(t===e&&r)return!0;return!1},p=(t,i)=>{if(typeof i=="object"){const[r]=Object.keys(i);return r==="payloads"?{key:t,value:i}:{key:t+lt(r),value:i[r]}}else return{key:t,value:i.toString()}},At=["failure","input","activityType","parentInitiatedEventId","workflowExecution","workflowType","taskQueue"],ht=({attributes:t})=>{for(const[i,r]of Object.entries(t))if(U(i,r))return p(i,r)},It=t=>{if(m(t,"ActivityType"))return t.ActivityType;if(m(t,"activity_type"))return t.activity_type},xt=t=>{var i,r,e;return!!((e=(r=(i=t.markerRecordedEventAttributes)==null?void 0:i.details)==null?void 0:r.type)!=null&&e.payloads)},W=t=>{var r,e,s,n,a,c;const i=ht(t);if(y(t)){const o=(((s=(e=(r=t.markerRecordedEventAttributes)==null?void 0:r.details)==null?void 0:e.data)==null?void 0:s.payloads)||((c=(a=(n=t.markerRecordedEventAttributes)==null?void 0:n.details)==null?void 0:a.type)==null?void 0:c.payloads)||[]).map(f=>Et(f)),u=o==null?void 0:o[0];if(xt(t)&&u)return p("ActivityType",u);const l=It(u);if(l)return p("ActivityType",l)}for(const[d,o]of Object.entries(t.attributes))for(const u of At)if(d===u&&U(d,o))return p(d,o);return i},bt=({lastEvent:t})=>W(t),Vt=t=>t?T(t)?bt(t):W(t):kt,M=t=>{var i,r,e,s,n,a,c,d,o,u,l,f;if(!t)return"";if(h(t))return(r=(i=t.activityTaskScheduledEventAttributes)==null?void 0:i.activityType)==null?void 0:r.name;if(g(t))return`${(e=t.timerStartedEventAttributes)==null?void 0:e.timerId} (${ft((s=t.timerStartedEventAttributes)==null?void 0:s.startToFireTimeout)})`;if(I(t))return(n=t.signalExternalWorkflowExecutionInitiatedEventAttributes)==null?void 0:n.signalName;if(x(t))return(a=t.workflowExecutionSignaledEventAttributes)==null?void 0:a.signalName;if(b(t))return y(t)?"Local Activity":(c=t.markerRecordedEventAttributes)==null?void 0:c.markerName;if(w(t))return(o=(d=t.startChildWorkflowExecutionInitiatedEventAttributes)==null?void 0:d.workflowType)==null?void 0:o.name;if(k(t))return(f=(l=(u=t.workflowExecutionUpdateAcceptedEventAttributes)==null?void 0:u.acceptedRequest)==null?void 0:l.input)==null?void 0:f.name},St=t=>{if(!t||h(t))return"";if(g(t))return"Timer";if(I(t))return"Signal";if(x(t))return"Signal received";if(b(t))return"Marker";if(w(t))return"Child Workflow";if(k(t))return""},Wt=t=>{var i,r;return t?y(t)?((r=(i=W(t))==null?void 0:i.value)==null?void 0:r.toString())??"Local Activity":M(t):""},A=({events:t})=>{let i=0,r;for(const e of t.values()){const s=Number(e.id);s>=i&&(i=s,r=e)}return r},Ct=(t,i)=>i!=null&&i.length&&k(t)?i.find(r=>{var e;return r.id===((e=t.workflowExecutionUpdateAcceptedEventAttributes)==null?void 0:e.acceptedRequestSequencingEventId.toString())}):t,E=(t,i)=>{const r=S(t),e=M(t),s=St(t),n=Wt(t),{timestamp:a,category:c,classification:d}=t,o=Ct(t,i),u=new Map,l=new Set;return o&&k(t)?(u.set(o.id,o),u.set(t.id,t),l.add(o.id),l.add(t.id)):(u.set(t.id,t),l.add(t.id)),{id:r,name:e,label:s,displayName:n,events:u,eventIds:l,initialEvent:o,timestamp:a,category:c,classification:d,level:void 0,pendingActivity:void 0,get eventTime(){var f;return(f=this.lastEvent)==null?void 0:f.eventTime},get attributes(){var f;return(f=A(this))==null?void 0:f.attributes},get eventList(){return Array.from(this.events,([f,z])=>z)},get lastEvent(){return A(this)},get finalClassification(){return A(this).classification},get isPending(){return this.pendingActivity||g(this.initialEvent)&&this.eventList.length===1||w(this.initialEvent)&&this.eventList.length===2},get isFailureOrTimedOut(){return!!this.eventList.find(N)},get isCanceled(){return!!this.eventList.find(q)},get isTerminated(){return!!this.eventList.find(B)}}},Ft=(t,i)=>{if(h(t)||w(t)||g(t)||I(t)||x(t))return E(t);if(b(t))return y(t),E(t);if(k(t))return E(t,i)},Ot=(t,i)=>{if(ct(t))return E(t,i)},P=(t,i,r=void 0)=>{t&&(t.events.set(i.id,i),t.eventIds.add(i.id),t.timestamp=i.timestamp,r&&(t.pendingActivity=r),t.pendingActivity&&t.eventList.length===3&&delete t.pendingActivity)},_t=(t,i="ascending",r=[])=>{const e={},s=n=>{const a=S(n),c=Ft(n,t),d=r.find(o=>o.activityId===n.id&&n.category==="activity");c?(e[c.id]=c,d&&(c.pendingActivity=d)):P(e[a],n,d)};if(i==="ascending")for(const n of t)s(n);else for(let n=t.length-1;n>=0;n--)s(t[n]);return i==="descending"?Object.values(e).reverse():Object.values(e)},T=t=>t==null?!1:m(t,"events"),Jt=(t,i="ascending")=>{const r={},e=s=>{const n=S(s),a=Ot(s,t);a?r[a.id]=a:P(r[n],s)};if(i==="ascending")for(const s of t)e(s);else for(let s=t.length-1;s>=0;s--)e(t[s]);return i==="descending"?Object.values(r).reverse():Object.values(r)};export{Ut as a,Qt as b,Bt as c,Mt as d,yt as e,Pt as f,_t as g,Ht as h,zt as i,qt as j,jt as k,Kt as l,Nt as m,T as n,Vt as o,mt as p,Jt as q,W as r,U as s};
