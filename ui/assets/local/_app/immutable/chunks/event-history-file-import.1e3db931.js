import{S as B,b as C,a as L,m as k,w as U,c as w,C as x,p as F,q as I,x as A,k as f,d as S,D as N,u,f as _,L as j,E as q,T as G,j as H,g as D,F as K,K as E,n as P}from"./index.f15f06ee.js";import{g as R}from"./navigation.ca6561c7.js";import{p as W}from"./stores.2eb4efb4.js";import{B as z}from"./button.1334115e.js";import{t as y}from"./translate.2e1ad657.js";import{g as J}from"./index.9920da39.js";import{t as M}from"./index.987dee7f.js";import{a as O}from"./auth-user.9088cf7d.js";import{i as Q,a as V}from"./import-events.fb8986a1.js";import{l as X}from"./namespaces.43fd8926.js";import{t as T}from"./toaster.926220f2.js";import{p as Y}from"./parse-with-big-int.bccd89af.js";import{d as Z}from"./route-for.81257f39.js";function tt(p){let o=y("import")+"",s;return{c(){s=U(o)},l(a){s=A(a,o)},m(a,m){_(a,s,m)},p:P,d(a){a&&f(s)}}}function et(p){let o,s=y("events","import-event-history-file-upload")+"",a,m,n,l,r,d,h,i;return r=new z({props:{icon:"file-upload",disabled:!p[0],$$slots:{default:[tt]},$$scope:{ctx:p}}}),r.$on("click",p[2]),{c(){o=k("label"),a=U(s),m=w(),n=k("input"),l=w(),x(r.$$.fragment),this.h()},l(t){o=F(t,"LABEL",{class:!0,for:!0});var e=I(o);a=A(e,s),e.forEach(f),m=S(t),n=F(t,"INPUT",{id:!0,class:!0,type:!0,accept:!0}),l=S(t),N(r.$$.fragment,t),this.h()},h(){u(o,"class","sr-only"),u(o,"for","import-event-history-file-upload"),u(n,"id","import-event-history-file-upload"),u(n,"class","import-input block rounded-md border border-gray-200 p-2"),u(n,"type","file"),u(n,"accept",".json")},m(t,e){_(t,o,e),j(o,a),_(t,m,e),_(t,n,e),_(t,l,e),q(r,t,e),d=!0,h||(i=G(n,"change",p[1]),h=!0)},p(t,[e]){const c={};e&1&&(c.disabled=!t[0]),e&128&&(c.$$scope={dirty:e,ctx:t}),r.$set(c)},i(t){d||(H(r.$$.fragment,t),d=!0)},o(t){D(r.$$.fragment,t),d=!1},d(t){t&&f(o),t&&f(m),t&&f(n),t&&f(l),K(r,t),h=!1,i()}}}function ot(p,o,s){let a,m,n;E(p,X,i=>s(4,a=i)),E(p,O,i=>s(5,m=i)),E(p,W,i=>s(6,n=i));let l,r=!1;return[r,async i=>{var t;const e=i.target,c=(t=e==null?void 0:e.files)===null||t===void 0?void 0:t[0],v=new FileReader;c&&(v.readAsText(c),v.onload=()=>{var b,g;try{const $=(g=(b=v==null?void 0:v.result)===null||b===void 0?void 0:b.toString())!==null&&g!==void 0?g:"";l=Y($),s(0,r=!0)}catch{T.push({variant:"error",message:y("events","event-history-load-error")}),s(0,r=!1)}})},async()=>{const{settings:i}=n.data;try{const t=await M({response:Array.isArray(l)?l:l==null?void 0:l.events,namespace:a,settings:i,accessToken:m.accessToken}),e=J(t);Q.set(t),V.set(e),s(0,r=!1);const c=Z(a,"feed");R(c)}catch(t){console.error(t),T.push({variant:"error",message:y("events","event-history-import-error")})}}]}class _t extends B{constructor(o){super(),C(this,o,ot,et,L,{})}}export{_t as E};
