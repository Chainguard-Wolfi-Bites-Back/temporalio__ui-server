import{j as i,r as k,w as c}from"./singletons.aae8f11e.js";import{p as f}from"./stores.9d4a2bb0.js";import{t as h}from"./translate.0a219ae4.js";import{n as u,ac as E}from"./index.09834243.js";import{r as d,a as l}from"./route-for-api.6f64f216.js";import{a as g,b}from"./workflow-service.56e6b262.js";const C=async(r,t,o=fetch)=>{let s=0,a=0;try{const e=d("workflows.count",{namespace:r});if(t){const n=l(e,{params:{query:t},onError:u,handleError:u,request:o}),w=l(e,{params:{query:""},onError:u,handleError:u,request:o}),[p,m]=await Promise.all([n,w]);a=parseInt((p==null?void 0:p.count)??"0"),s=parseInt(m==null?void 0:m.count)}else{const n=await l(e,{params:{},onError:u,handleError:u,request:o});s=parseInt(n==null?void 0:n.count)}}catch{}return{count:a,totalCount:s}},U=async({namespace:r,query:t})=>{try{const o="GROUP BY ExecutionStatus",s=d("workflows.count",{namespace:r}),{count:a,groups:e}=await l(s,{params:{query:t?`${t} ${o}`:`${o}`},notifyOnError:!1});return{count:a,groups:e}}catch{return{count:"0",groups:[]}}},W=300,P=async(r,t,o)=>{t.set(!0);try{await o()}catch(s){console.error(s)}r.set(!1),setTimeout(()=>{t.set(!1)},W)},A=i([f],([r])=>{var t,o,s;return Boolean((s=(o=(t=r.data)==null?void 0:t.systemInfo)==null?void 0:o.capabilities)==null?void 0:s.countGroupByExecutionStatus)}),B=c(0),v=i([f],([r])=>{var t,o;return(o=(t=r.data)==null?void 0:t.settings)==null?void 0:o.hideWorkflowQueryErrors}),I=i([f],([r])=>r.params.namespace),Q=i([f],([r])=>r.url.searchParams.get("query")),q=i([I,Q,B,g,v],([r,t,o,s,a])=>({namespace:r,query:t,refresh:o,supportsAdvancedVisibility:s,hideWorkflowQueryErrors:a})),x=r=>{F.set(r)},S=r=>q.subscribe(({namespace:t,query:o,supportsAdvancedVisibility:s,hideWorkflowQueryErrors:a})=>{P($,V,async()=>{const{workflows:e,error:n}=await b(t,{query:o});if(r(e),s&&!E(A)){const w=await C(t,o);x(w)}n?a?y.set(h("workflows","workflows-error-querying")):y.set(n):y.set("")})}),Y=c(""),V=c(!0),$=c(!0),F=c({count:0,totalCount:0}),y=c(""),z=k([],S),D=c("");export{D as a,F as b,y as c,z as d,U as f,A as g,$ as l,B as r,V as u,Y as w};
