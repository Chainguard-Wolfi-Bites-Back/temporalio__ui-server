import{j as c,r as m,w as n}from"./singletons.d67f4e6b.js";import{p as u}from"./stores.255470ec.js";import{t as d}from"./translate.135d909a.js";import{n as w,ac as k}from"./index.0942deb7.js";import{r as f,a as p}from"./route-for-api.4c8e7aa5.js";import{a as h,b as E}from"./workflow-service.bd668cd0.js";const b=async(o,r,t=fetch)=>{let s=0;try{const e=f("workflows.count",{namespace:o}),a=await p(e,{params:r?{query:r}:{},onError:w,handleError:w,request:t});s=parseInt((a==null?void 0:a.count)||"0")}catch{}return{count:s}},j=async({namespace:o,query:r})=>{const t="GROUP BY ExecutionStatus",s=f("workflows.count",{namespace:o}),{count:e,groups:a}=await p(s,{params:{query:r?`${r} ${t}`:`${t}`},notifyOnError:!1});return{count:e??"0",groups:a}},g=300,C=async(o,r,t)=>{r.set(!0);try{await t()}catch(s){console.error(s)}o.set(!1),setTimeout(()=>{r.set(!1)},g)},W=c([u],([o])=>{var r,t,s;return Boolean((s=(t=(r=o.data)==null?void 0:r.systemInfo)==null?void 0:t.capabilities)==null?void 0:s.countGroupByExecutionStatus)}),A=n(0),B=c([u],([o])=>{var r,t;return(t=(r=o.data)==null?void 0:r.settings)==null?void 0:t.hideWorkflowQueryErrors}),q=c([u],([o])=>o.params.namespace),v=c([u],([o])=>o.url.searchParams.get("query")),Q=c([q,v,A,h,B],([o,r,t,s,e])=>({namespace:o,query:r,refresh:t,supportsAdvancedVisibility:s,hideWorkflowQueryErrors:e})),x=o=>{R.set({...o,newCount:0})},P=o=>Q.subscribe(({namespace:r,query:t,supportsAdvancedVisibility:s,hideWorkflowQueryErrors:e})=>{C(I,S,async()=>{const{workflows:a,error:l}=await E(r,{query:t});if(o(a),s&&!k(W)){const y=await b(r,t);x(y)}l?e?i.set(d("workflows.workflows-error-querying")):i.set(l):i.set("")})}),L=n(""),S=n(!0),I=n(!0),R=n({count:0,newCount:0}),i=n(""),T=m([],P),U=n("");export{R as a,U as b,i as c,T as d,j as f,W as g,I as l,A as r,S as u,L as w};
