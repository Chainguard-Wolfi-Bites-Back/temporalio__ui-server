import{ac as h,n as m}from"./index.6779d4e2.js";import{t as U}from"./translate.64137fbc.js";import{b as j,e as q}from"./decode-payload.8f08cfe6.js";import{c as F}from"./is.ba28a1ea.js";import{s as K}from"./settings.b49a4593.js";import{s as _}from"./simplify-attributes.bbb8ccfe.js";import{l as L,d as J}from"./data-encoder-config.37ceca8b.js";import{B as G}from"./route-for.811be610.js";import{b as H,p as M,a as l,r as w,c as X,i as Y,d as Z}from"./route-for-api.5454e1ad.js";import{s as x}from"./parse-with-big-int.0036a80a.js";import{d as I}from"./index.1302fd9b.js";import{p as oo}from"./stores.6c389017.js";import{i as to}from"./version-check.d006b302.js";import{c as $}from"./cluster.cbce199d.js";import{t as no}from"./versions.6b1b4529.js";import{l as ro,m as eo,n as O,o as io}from"./format-time.8258873a.js";import{v as ao}from"./toaster.ef510498.js";const so=(o=K)=>!h(o).disableWriteActions,co=(o=[])=>o.map(t=>{const n=_(t,!0),r=t.activityId;return{...n,id:r}}),fo=o=>F(o)||F(o.indexedFields)?{}:{indexedFields:Object.entries(o.indexedFields).reduce((n,[r,e])=>({...n,[r]:j(e)}),{})},p=o=>{var b,g,T,W,S,A,C;const t=fo(o.workflowExecutionInfo.searchAttributes),n=o.workflowExecutionInfo.type.name,r=o.workflowExecutionInfo.execution.workflowId,e=o.workflowExecutionInfo.execution.runId,i=o.workflowExecutionInfo.startTime,a=o.workflowExecutionInfo.closeTime,s=o.workflowExecutionInfo.executionTime,f=o.workflowExecutionInfo.status,c=o.workflowExecutionInfo.status==="Running",d=o.workflowExecutionInfo.historyLength,E=o.workflowExecutionInfo.historySizeBytes,u=`/workflows/${r}/${e}`,k=((g=(b=o==null?void 0:o.executionConfig)==null?void 0:b.taskQueue)==null?void 0:g.name)||((T=o==null?void 0:o.workflowExecutionInfo)==null?void 0:T.taskQueue),y=(W=o==null?void 0:o.workflowExecutionInfo)==null?void 0:W.mostRecentWorkerVersionStamp,R=(S=o==null?void 0:o.workflowExecutionInfo)==null?void 0:S.parentNamespaceId,z=(A=o==null?void 0:o.workflowExecutionInfo)==null?void 0:A.parentExecution,V=o.workflowExecutionInfo.stateTransitionCount,D=(C=o.executionConfig)==null?void 0:C.defaultWorkflowTaskTimeout,N=co(o.pendingActivities),Q=(o==null?void 0:o.pendingChildren)??[];return{name:n,id:r,runId:e,startTime:i,endTime:a,executionTime:s,status:f,historyEvents:d,historySizeBytes:E,searchAttributes:t,url:u,taskQueue:k,mostRecentWorkerVersionStamp:y,pendingActivities:N,pendingChildren:Q,parentNamespaceId:R,parent:z,stateTransitionCount:V,isRunning:c,defaultWorkflowTaskTimeout:D,get canBeTerminated(){return c&&so()}}},v=o=>(o.executions||[]).map(t=>p({workflowExecutionInfo:t})),uo=o=>window.btoa(encodeURIComponent(o).replace(/%([0-9A-F]{2})/g,(t,n)=>String.fromCharCode(parseInt(n,16)))),P=(o,t=G)=>t?uo(o):o,lo=(o,t)=>{var n;return((n=o==null?void 0:o.visibilityStore)==null?void 0:n.includes("elasticsearch"))||to(t,"1.19")},wo=o=>{var t;return(t=o==null?void 0:o.visibilityStore)==null?void 0:t.includes("elasticsearch")},B=I([oo],([o])=>{var t,n,r;return(r=(n=(t=o.data)==null?void 0:t.settings)==null?void 0:n.runtimeEnvironment)==null?void 0:r.isCloud}),mo=I([$,no,B],([o,t,n])=>lo(o,t)||n);I([$,B],([o,t])=>wo(o)||t);const ko={workflowId:"WorkflowId",workflowType:"WorkflowType",timeRange:"StartTime",executionStatus:"ExecutionStatus",closeTime:"CloseTime"},yo=["workflowId","workflowType","timeRange","executionStatus","closeTime"],ho=o=>!(o===null||o===void 0||o===""||typeof o=="string"&&o==="undefined"),Eo=o=>{if(typeof o!="string")return!1;for(const t of yo)if(t===o)return!0;return!1},xo=(o,t,n)=>{const r=ko[o];return t==="All"?"":ro(t)||eo(t)?n||h(mo)?`${r} > "${O(t)}"`:`${r} BETWEEN "${O(t)}" AND "${io()}"`:`${r}="${t}"`},Io=(o,t)=>Object.entries(o).map(([n,r])=>{if(Eo(n)&&ho(r))return xo(n,r,t)}).filter(Boolean),po=(o,t=!1)=>Io(o,t).join(" and "),Qo=async(o,t,n=fetch)=>{let r=0,e=0;try{const i=w("workflows.count",{namespace:o});if(t){const a=l(i,{params:{query:t},onError:m,handleError:m,request:n}),s=l(i,{params:{query:""},onError:m,handleError:m,request:n}),[f,c]=await Promise.all([a,s]);e=parseInt((f==null?void 0:f.count)??"0"),r=parseInt(c==null?void 0:c.count)}else{const a=await l(i,{params:{},onError:m,handleError:m,request:n});r=parseInt(a==null?void 0:a.count)}}catch{}return{count:e,totalCount:r}},bo=async(o,t,n=fetch,r=!1)=>{const e=t.query||po(t,r);let i;try{i=decodeURIComponent(e)}catch{i=e}const a=r?"workflows.archived":"workflows";let s="";const f=u=>{var k,y;X(u),(k=u==null?void 0:u.body)!=null&&k.message||u!=null&&u.status?s=((y=u==null?void 0:u.body)==null?void 0:y.message)??`Error fetching workflows: ${u.status}: ${u.statusText}`:s="Error fetching workflows: Server failed to respond"},c=w(a,{namespace:o}),{executions:d,nextPageToken:E}=await l(c,{params:{query:i},onError:f,handleError:f,request:n})??{executions:[],nextPageToken:""};return{workflows:v({executions:d}),nextPageToken:String(E),error:s}},Uo=async({namespace:o,workflowId:t,url:n},r=fetch)=>{var d;const e="workflows",i=n??H(o),a=M(e,{namespace:o}),s=i+a,{executions:f}=await l(s,{params:{query:`WorkflowId="${t}"`,pageSize:"1"},request:r})??{executions:[]},c=(d=v({executions:f}))==null?void 0:d[0];return{runId:c==null?void 0:c.runId}},jo=async(o,t=fetch,n=!1)=>{const r=n?"workflows.archived":"workflows";let e=!0;const i=s=>{(Y(s)||Z(s))&&(e=!1)},a=w(r,{namespace:o});return await l(a,{params:{pageSize:"1"},onError:i,handleError:i,request:t}),{authorized:e}},qo=async(o,t,n=fetch)=>bo(o,t,n,!0);async function Ko(o,t=fetch){const n=w("workflow",o);return l(n,{request:t}).then(p)}async function _o({workflow:o,namespace:t,reason:n,identity:r}){const e=w("workflow.terminate",{namespace:t,workflowId:o.id,runId:o.runId});return await l(e,{options:{method:"POST",body:x({reason:n,...r&&{identity:r}})},notifyOnError:!1})}async function Lo({namespace:o,workflowId:t,runId:n},r=fetch){const e=w("workflow.cancel",{namespace:o,workflowId:t,runId:n});return l(e,{request:r,notifyOnError:!1,options:{method:"POST"}})}async function Jo({namespace:o,workflowId:t,runId:n,signalName:r,signalInput:e,settings:i,accessToken:a}){var c;const s=w("workflow.signal",{namespace:o,workflowId:t,runId:n});let f=null;if(e)if((c=i==null?void 0:i.codec)!=null&&c.endpoint){const d=await q({payloads:{payloads:[JSON.parse(e)]},namespace:o,settings:i,accessToken:a,encode:!0});if(h(L)==="error")throw new Error(h(J)||U("encode-failed"));f=(d==null?void 0:d.payloads)??null}else f=[{metadata:{encoding:P("json/plain")},data:P(e)}];return l(s,{notifyOnError:!1,options:{method:"POST",body:x({signalName:r,input:{payloads:f}})}})}async function Go({namespace:o,workflowId:t,runId:n,eventId:r,reason:e,resetReapplyType:i}){const a=w("workflow.reset",{namespace:o,workflowId:t,runId:n}),s={workflowExecution:{workflowId:t,runId:n},workflowTaskFinishEventId:r,resetReapplyType:i,requestId:ao(),reason:e};return l(a,{notifyOnError:!1,options:{method:"POST",body:x(s)}})}async function Ho(o,t=fetch){const n=e=>{console.error(e)},r=w("workflow",o);return l(r,{request:t,onError:n,handleError:n}).then(p)}export{mo as a,bo as b,Lo as c,Qo as d,jo as e,Ko as f,po as g,qo as h,Ho as i,B as j,Uo as k,Go as r,Jo as s,_o as t,so as w};
