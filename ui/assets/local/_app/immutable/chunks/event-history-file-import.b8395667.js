import{S as C,b as I,a as L,m as k,w as A,c as w,C as T,p as F,q as x,x as B,k as f,d as S,D as N,u,f as _,L as j,E as q,Q as G,j as H,g as D,F as K,K as E,n as P}from"./index.efded970.js";import{g as Q}from"./navigation.d47440ed.js";import{p as R}from"./stores.3892283d.js";import{B as W}from"./button.8e56bc18.js";import{t as y}from"./translate.dbc84c9f.js";import{g as z}from"./index.aabaaaa7.js";import{t as J}from"./index.bde020e8.js";import{a as M}from"./auth-user.58d364c3.js";import{i as O,a as V}from"./import-events.80234efc.js";import{l as X}from"./namespaces.2d966c62.js";import{t as U}from"./toaster.fd2b66a2.js";import{p as Y}from"./parse-with-big-int.0036a80a.js";import{d as Z}from"./route-for.2a94a5e2.js";function ee(p){let o=y("import")+"",s;return{c(){s=A(o)},l(a){s=B(a,o)},m(a,m){_(a,s,m)},p:P,d(a){a&&f(s)}}}function te(p){let o,s=y("events","import-event-history-file-upload")+"",a,m,n,l,r,d,h,i;return r=new W({props:{leadingIcon:"file-upload",disabled:!p[0],$$slots:{default:[ee]},$$scope:{ctx:p}}}),r.$on("click",p[2]),{c(){o=k("label"),a=A(s),m=w(),n=k("input"),l=w(),T(r.$$.fragment),this.h()},l(e){o=F(e,"LABEL",{class:!0,for:!0});var t=x(o);a=B(t,s),t.forEach(f),m=S(e),n=F(e,"INPUT",{id:!0,class:!0,type:!0,accept:!0}),l=S(e),N(r.$$.fragment,e),this.h()},h(){u(o,"class","sr-only"),u(o,"for","import-event-history-file-upload"),u(n,"id","import-event-history-file-upload"),u(n,"class","import-input block rounded-md border border-gray-200 p-2"),u(n,"type","file"),u(n,"accept",".json")},m(e,t){_(e,o,t),j(o,a),_(e,m,t),_(e,n,t),_(e,l,t),q(r,e,t),d=!0,h||(i=G(n,"change",p[1]),h=!0)},p(e,[t]){const c={};t&1&&(c.disabled=!e[0]),t&128&&(c.$$scope={dirty:t,ctx:e}),r.$set(c)},i(e){d||(H(r.$$.fragment,e),d=!0)},o(e){D(r.$$.fragment,e),d=!1},d(e){e&&f(o),e&&f(m),e&&f(n),e&&f(l),K(r,e),h=!1,i()}}}function oe(p,o,s){let a,m,n;E(p,X,i=>s(4,a=i)),E(p,M,i=>s(5,m=i)),E(p,R,i=>s(6,n=i));let l,r=!1;return[r,async i=>{var e;const t=i.target,c=(e=t==null?void 0:t.files)===null||e===void 0?void 0:e[0],v=new FileReader;c&&(v.readAsText(c),v.onload=()=>{var g,b;try{const $=(b=(g=v==null?void 0:v.result)===null||g===void 0?void 0:g.toString())!==null&&b!==void 0?b:"";l=Y($),s(0,r=!0)}catch{U.push({variant:"error",message:y("events","event-history-load-error")}),s(0,r=!1)}})},async()=>{const{settings:i}=n.data;try{const e=await J({response:Array.isArray(l)?l:l==null?void 0:l.events,namespace:a,settings:i,accessToken:m.accessToken}),t=z(e);O.set(e),V.set(t),s(0,r=!1);const c=Z(a,"feed");Q(c)}catch(e){console.error(e),U.push({variant:"error",message:y("events","event-history-import-error")})}}]}class _e extends C{constructor(o){super(),I(this,o,oe,te,L,{})}}export{_e as E};
