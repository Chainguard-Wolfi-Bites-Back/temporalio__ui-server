import{ab as P,n as m}from"./index.efded970.js";import{b as U}from"./decode-payload.14688abf.js";import{c as C}from"./is.ba28a1ea.js";import{s as j}from"./settings.f4bcc2b2.js";import{s as q}from"./simplify-attributes.d3ff8bf3.js";import{B as K}from"./route-for.9eb224c1.js";import{b as _,p as L,a as u,r as d,c as G,i as H,d as J}from"./route-for-api.d78c1524.js";import{s as E}from"./parse-with-big-int.bccd89af.js";import{d as x}from"./index.c0615b9d.js";import{p as M}from"./stores.6c5e9f21.js";import{i as X}from"./version-check.d006b302.js";import{c as $}from"./cluster.728f7d8f.js";import{t as Y}from"./versions.44d896b4.js";import{l as Z,m as oo,n as F,o as to}from"./format-time.8258873a.js";import{v as no}from"./toaster.fd2b66a2.js";const ro=(o=j)=>!P(o).disableWriteActions,eo=(o=[])=>o.map(t=>{const n=q(t,!0),r=t.activityId;return{...n,id:r}}),io=o=>C(o)||C(o.indexedFields)?{}:{indexedFields:Object.entries(o.indexedFields).reduce((n,[r,e])=>({...n,[r]:U(e)}),{})},I=o=>{var g,b,T,p,W,S,A;const t=io(o.workflowExecutionInfo.searchAttributes),n=o.workflowExecutionInfo.type.name,r=o.workflowExecutionInfo.execution.workflowId,e=o.workflowExecutionInfo.execution.runId,i=o.workflowExecutionInfo.startTime,a=o.workflowExecutionInfo.closeTime,s=o.workflowExecutionInfo.executionTime,l=o.workflowExecutionInfo.status,f=o.workflowExecutionInfo.status==="Running",w=o.workflowExecutionInfo.historyLength,y=o.workflowExecutionInfo.historySizeBytes,c=`/workflows/${r}/${e}`,k=((b=(g=o==null?void 0:o.executionConfig)==null?void 0:g.taskQueue)==null?void 0:b.name)||((T=o==null?void 0:o.workflowExecutionInfo)==null?void 0:T.taskQueue),h=(p=o==null?void 0:o.workflowExecutionInfo)==null?void 0:p.mostRecentWorkerVersionStamp,R=(W=o==null?void 0:o.workflowExecutionInfo)==null?void 0:W.parentNamespaceId,z=(S=o==null?void 0:o.workflowExecutionInfo)==null?void 0:S.parentExecution,V=o.workflowExecutionInfo.stateTransitionCount,Q=(A=o.executionConfig)==null?void 0:A.defaultWorkflowTaskTimeout,D=eo(o.pendingActivities),N=(o==null?void 0:o.pendingChildren)??[];return{name:n,id:r,runId:e,startTime:i,endTime:a,executionTime:s,status:l,historyEvents:w,historySizeBytes:y,searchAttributes:t,url:c,taskQueue:k,mostRecentWorkerVersionStamp:h,pendingActivities:D,pendingChildren:N,parentNamespaceId:R,parent:z,stateTransitionCount:V,isRunning:f,defaultWorkflowTaskTimeout:Q,get canBeTerminated(){return f&&ro()}}},v=o=>(o.executions||[]).map(t=>I({workflowExecutionInfo:t})),ao=o=>window.btoa(encodeURIComponent(o).replace(/%([0-9A-F]{2})/g,(t,n)=>String.fromCharCode(parseInt(n,16)))),O=(o,t=K)=>t?ao(o):o,so=(o,t)=>{var n;return((n=o==null?void 0:o.visibilityStore)==null?void 0:n.includes("elasticsearch"))||X(t,"1.19")},co=o=>{var t;return(t=o==null?void 0:o.visibilityStore)==null?void 0:t.includes("elasticsearch")},B=x([M],([o])=>{var t,n,r;return(r=(n=(t=o.data)==null?void 0:t.settings)==null?void 0:n.runtimeEnvironment)==null?void 0:r.isCloud}),fo=x([$,Y,B],([o,t,n])=>so(o,t)||n);x([$,B],([o,t])=>co(o)||t);const uo={workflowId:"WorkflowId",workflowType:"WorkflowType",timeRange:"StartTime",executionStatus:"ExecutionStatus",closeTime:"CloseTime"},lo=["workflowId","workflowType","timeRange","executionStatus","closeTime"],wo=o=>!(o===null||o===void 0||o===""||typeof o=="string"&&o==="undefined"),mo=o=>{if(typeof o!="string")return!1;for(const t of lo)if(t===o)return!0;return!1},ko=(o,t,n)=>{const r=uo[o];return t==="All"?"":Z(t)||oo(t)?n||P(fo)?`${r} > "${F(t)}"`:`${r} BETWEEN "${F(t)}" AND "${to()}"`:`${r}="${t}"`},ho=(o,t)=>Object.entries(o).map(([n,r])=>{if(mo(n)&&wo(r))return ko(n,r,t)}).filter(Boolean),yo=(o,t=!1)=>ho(o,t).join(" and "),Bo=async(o,t,n=fetch)=>{let r=0,e=0;try{const i=d("workflows.count",{namespace:o});if(t){const a=u(i,{params:{query:t},onError:m,handleError:m,request:n}),s=u(i,{params:{query:""},onError:m,handleError:m,request:n}),[l,f]=await Promise.all([a,s]);e=parseInt((l==null?void 0:l.count)??"0"),r=parseInt(f==null?void 0:f.count)}else{const a=await u(i,{params:{},onError:m,handleError:m,request:n});r=parseInt(a==null?void 0:a.count)}}catch{}return{count:e,totalCount:r}},Eo=async(o,t,n=fetch,r=!1)=>{const e=t.query||yo(t,r);let i;try{i=decodeURIComponent(e)}catch{i=e}const a=r?"workflows.archived":"workflows";let s="";const l=c=>{var k,h;G(c),(k=c==null?void 0:c.body)!=null&&k.message||c!=null&&c.status?s=((h=c==null?void 0:c.body)==null?void 0:h.message)??`Error fetching workflows: ${c.status}: ${c.statusText}`:s="Error fetching workflows: Server failed to respond"},f=d(a,{namespace:o}),{executions:w,nextPageToken:y}=await u(f,{params:{query:i},onError:l,handleError:l,request:n})??{executions:[],nextPageToken:""};return{workflows:v({executions:w}),nextPageToken:String(y),error:s}},Ro=async({namespace:o,workflowId:t,url:n},r=fetch)=>{var w;const e="workflows",i=n??_(o),a=L(e,{namespace:o}),s=i+a,{executions:l}=await u(s,{params:{query:`WorkflowId="${t}"`,pageSize:"1"},request:r})??{executions:[]},f=(w=v({executions:l}))==null?void 0:w[0];return{runId:f==null?void 0:f.runId}},zo=async(o,t=fetch,n=!1)=>{const r=n?"workflows.archived":"workflows";let e=!0;const i=s=>{(H(s)||J(s))&&(e=!1)},a=d(r,{namespace:o});return await u(a,{params:{pageSize:"1"},onError:i,handleError:i,request:t}),{authorized:e}},Vo=async(o,t,n=fetch)=>Eo(o,t,n,!0);async function Qo(o,t=fetch){const n=d("workflow",o);return u(n,{request:t}).then(I)}async function Do({workflow:o,namespace:t,reason:n,identity:r}){const e=d("workflow.terminate",{namespace:t,workflowId:o.id,runId:o.runId});return await u(e,{options:{method:"POST",body:E({reason:n,...r&&{identity:r}})},notifyOnError:!1})}async function No({namespace:o,workflowId:t,runId:n},r=fetch){const e=d("workflow.cancel",{namespace:o,workflowId:t,runId:n});return u(e,{request:r,notifyOnError:!1,options:{method:"POST"}})}async function Uo({namespace:o,workflowId:t,runId:n,signalName:r,signalInput:e}){const i=d("workflow.signal",{namespace:o,workflowId:t,runId:n});return u(i,{notifyOnError:!1,options:{method:"POST",body:E({signalName:r,input:{payloads:e?[{metadata:{encoding:O("json/plain")},data:O(e)}]:null}})}})}async function jo({namespace:o,workflowId:t,runId:n,eventId:r,reason:e,resetReapplyType:i}){const a=d("workflow.reset",{namespace:o,workflowId:t,runId:n}),s={workflowExecution:{workflowId:t,runId:n},workflowTaskFinishEventId:r,resetReapplyType:i,requestId:no(),reason:e};return u(a,{notifyOnError:!1,options:{method:"POST",body:E(s)}})}async function qo(o,t=fetch){const n=e=>{console.error(e)},r=d("workflow",o);return u(r,{request:t,onError:n,handleError:n}).then(I)}export{fo as a,Eo as b,No as c,Bo as d,zo as e,Qo as f,yo as g,Vo as h,qo as i,B as j,Ro as k,jo as r,Uo as s,Do as t,ro as w};
