import{s as H,e as v,b as S,d as y,g as p,j as b,k as T,t as O,f as R,l as k,n as j,p as Q,a as w,h as C,u as A,q as F,r as E}from"./scheduler.78ThUSKQ.js";import{S as M,i as z,g as G,b as _,e as J,t as g,c as D,a as L,m as N,d as q}from"./index.G2Max4V_.js";import{I as K}from"./icon.63Khk0lC.js";import{t as W}from"./tw-merge.NbP7EmZe.js";import{t as V}from"./translate.HrioCK44.js";import{r as I,a as h}from"./route-for-api.Jq3ZjHdD.js";const X=e=>({}),B=e=>({}),Z=e=>({}),P=e=>({});function $(e){let t,s,n,r;return s=new K({props:{name:"merge"}}),{c(){t=v("span"),D(s.$$.fragment),n=O(e[2]),this.h()},l(u){t=S(u,"SPAN",{class:!0});var o=y(t);L(s.$$.fragment,o),n=R(o,e[2]),o.forEach(p),this.h()},h(){b(t,"class","flex items-center gap-1 rounded border px-1 text-sm")},m(u,o){T(u,t,o),N(s,t,null),k(t,n),r=!0},p(u,o){(!r||o&4)&&j(n,u[2])},i(u){r||(g(s.$$.fragment,u),r=!0)},o(u){_(s.$$.fragment,u),r=!1},d(u){u&&p(t),q(s)}}}function x(e){let t,s,n,r,u,o,c;s=new K({props:{name:"merge"}});const a=e[4]["overall-default-worker"],i=Q(a,e,e[3],P),m=e[4]["default-worker"],f=Q(m,e,e[3],B);return{c(){t=v("span"),D(s.$$.fragment),n=O(e[2]),r=w(),i&&i.c(),u=w(),f&&f.c(),this.h()},l(l){t=S(l,"SPAN",{class:!0});var d=y(t);L(s.$$.fragment,d),n=R(d,e[2]),r=C(d),i&&i.l(d),u=C(d),f&&f.l(d),d.forEach(p),this.h()},h(){b(t,"class",o=W("flex items-center gap-1 rounded border px-1 text-sm",e[1]&&"border-green-100 bg-green-100 text-green-800"))},m(l,d){T(l,t,d),N(s,t,null),k(t,n),k(t,r),i&&i.m(t,null),k(t,u),f&&f.m(t,null),c=!0},p(l,d){(!c||d&4)&&j(n,l[2]),i&&i.p&&(!c||d&8)&&A(i,a,l,l[3],c?E(a,l[3],d,Z):F(l[3]),P),f&&f.p&&(!c||d&8)&&A(f,m,l,l[3],c?E(m,l[3],d,X):F(l[3]),B),(!c||d&2&&o!==(o=W("flex items-center gap-1 rounded border px-1 text-sm",l[1]&&"border-green-100 bg-green-100 text-green-800")))&&b(t,"class",o)},i(l){c||(g(s.$$.fragment,l),g(i,l),g(f,l),c=!0)},o(l){_(s.$$.fragment,l),_(i,l),_(f,l),c=!1},d(l){l&&p(t),q(s),i&&i.d(l),f&&f.d(l)}}}function ee(e){let t,s,n,r;const u=[x,$],o=[];function c(a,i){return a[0]&&a[2]?0:a[2]?1:-1}return~(s=c(e))&&(n=o[s]=u[s](e)),{c(){t=v("p"),n&&n.c(),this.h()},l(a){t=S(a,"P",{class:!0});var i=y(t);n&&n.l(i),i.forEach(p),this.h()},h(){b(t,"class","flex select-all gap-2 font-mono")},m(a,i){T(a,t,i),~s&&o[s].m(t,null),r=!0},p(a,[i]){let m=s;s=c(a),s===m?~s&&o[s].p(a,i):(n&&(G(),_(o[m],1,1,()=>{o[m]=null}),J()),~s?(n=o[s],n?n.p(a,i):(n=o[s]=u[s](a),n.c()),g(n,1),n.m(t,null)):n=null)},i(a){r||(g(n),r=!0)},o(a){_(n),r=!1},d(a){a&&p(t),~s&&o[s].d()}}}function te(e,t,s){let{$$slots:n={},$$scope:r}=t,{defaultVersion:u=!1}=t,{active:o=!1}=t,{buildId:c}=t;return e.$$set=a=>{"defaultVersion"in a&&s(0,u=a.defaultVersion),"active"in a&&s(1,o=a.active),"buildId"in a&&s(2,c=a.buildId),"$$scope"in a&&s(3,r=a.$$scope)},[u,o,c,r,n]}class ge extends M{constructor(t){super(),z(this,t,te,ee,H,{defaultVersion:0,active:1,buildId:2})}}const U=e=>(e!=null&&e.majorVersionSets?[...e.majorVersionSets]:[]).reverse(),Y=e=>{if(!(!e||!e.length))return e[e.length-1]},se=(e,t)=>{var n;const s=(n=e==null?void 0:e.majorVersionSets)==null?void 0:n.find(r=>{var u;return(u=r.buildIds)==null?void 0:u.includes(t)});return Y(s==null?void 0:s.buildIds)},pe=e=>e?e.slice(0,e.length-1).reverse():[],he=e=>{var n;const t=U(e);if(!t.length)return;const s=(n=t[0])==null?void 0:n.buildIds;if(s!=null&&s.length)return Y(t[0].buildIds)},ne=e=>{var t,s;if((t=e==null?void 0:e.mostRecentWorkerVersionStamp)!=null&&t.useVersioning)return((s=e.mostRecentWorkerVersionStamp)==null?void 0:s.buildId)||void 0},re=e=>{var t,s;if((t=e==null?void 0:e.workerVersionCapabilities)!=null&&t.useVersioning)return((s=e.workerVersionCapabilities)==null?void 0:s.buildId)||void 0},ae=e=>[...new Set(e==null?void 0:e.map(re).filter(Boolean))],ke=e=>e==null?void 0:e.some(t=>{var s;return(s=t==null?void 0:t.workerVersionCapabilities)==null?void 0:s.useVersioning}),be=(e,t,s)=>{const n=ne(e);if(!n)return!0;const r=se(s,n);return ae(t).includes(r)};async function Ie(e,t=fetch){var a;const s=I("task-queue",e),n=await h(s,{request:t,params:{taskQueueType:"1"}}),r=await h(s,{request:t,params:{taskQueueType:"2"}});n!=null&&n.pollers||(n.pollers=[]),r!=null&&r.pollers||(r.pollers=[]),r.pollers.forEach(i=>{i.taskQueueTypes=["ACTIVITY"]}),n.pollers.forEach(i=>{i.taskQueueTypes=["WORKFLOW"]});const u=i=>(m,f)=>{const l=m[f.identity]||{lastAccessTime:void 0,taskQueueTypes:[]};return m[f.identity]={lastAccessTime:!l.lastAccessTime||l.lastAccessTime<f.lastAccessTime?f.lastAccessTime:l.lastAccessTime,taskQueueTypes:l.taskQueueTypes.concat([i])},m};r.pollers.filter(i=>n.pollers.some(m=>{if(i.identity===m.identity)return i.taskQueueTypes=[...m.taskQueueTypes,...i.taskQueueTypes],i})),(a=r.pollers)==null||a.reduce(u("ACTIVITY"),n.pollers.reduce(u("WORKFLOW"),{}));const o=r.pollers.length?r.pollers:n.pollers,c=r.pollers.length?r.taskQueueStatus:n.taskQueueStatus;return{pollers:o,taskQueueStatus:c}}async function Ve(e,t=fetch){const s=await oe(e,t),n=await ie(e,t),r=U(n);return{rules:s,compatibility:n,versionSets:r}}async function oe(e,t=fetch){const s=I("task-queue.rules",e);return h(s,{request:t,handleError:n=>{}})}async function ie(e,t=fetch){const s=I("task-queue.compatibility",e);return h(s,{request:t,handleError:n=>{}})}async function ve(e,t=fetch){const{namespace:s,buildIds:n,queue:r}=e,u=I("worker-task-reachability",{namespace:s}),o=new URLSearchParams;if(n.length)for(const c of n)o.append("buildIds",c);else o.append("buildIds",""),o.append("taskQueues",r);return await h(u,{request:t,params:o,handleError:c=>({buildIdReachability:[]})})}function ue(e){return!e||!e.length?V("workers.ready-to-be-retired"):e.length===1&&e.includes("CLOSED")?V("common.maybe"):V("common.no")}function Se(e,t,s){var o,c;const n=(o=e==null?void 0:e.buildIdReachability)==null?void 0:o.find(a=>a.buildId===s);if(!n)return"";const r=(c=n==null?void 0:n.taskQueueReachability)==null?void 0:c.find(a=>(a==null?void 0:a.taskQueue)===t);if(!r)return"";const u=r==null?void 0:r.reachability;return ue(u)}export{ge as C,U as a,he as b,re as c,Se as d,Y as e,pe as f,Ie as g,ae as h,Ve as i,ve as j,ne as k,ke as p,be as w};
