import{s as le,a1 as ae,M as ie,e as k,a as j,t as J,b as L,d as I,g,h as q,f as z,j as D,k as P,l as _,n as re,T as fe,c as x,v as Q}from"../chunks/scheduler.GSXCNEL-.js";import{S as ue,i as me,f as de,c as C,a as N,m as M,t as V,b as T,d as U}from"../chunks/index.h9J8o6HM.js";import{g as oe}from"../chunks/entry.UNT5oMCP.js";import{p as pe}from"../chunks/stores.zGt0Q0P4.js";import{P as ge}from"../chunks/page-title.mJVmOqZ4.js";import{t as v}from"../chunks/translate.HrioCK44.js";import{B as y}from"../chunks/button.EqNcInoa.js";import{I as _e}from"../chunks/input.y4kiFgWl.js";import{L as he}from"../chunks/link.Dhprg7Wd.js";import{M as $e}from"../chunks/modal.X2fvV2vo.js";import{N as ve,e as be}from"../chunks/nexus-form.C8CJiG_D.js";import{j as ee,h as Ee}from"../chunks/route-for.EqIvsTgc.js";import{u as De,d as we}from"../chunks/nexus-service.vyd-rNZI.js";import{n as ke}from"../chunks/namespaces.6xDS7zFx.js";import{e as Le}from"../chunks/encode-payload.BOG4CB_1.js";function Ie(e){let a=v("nexus.back-to-endpoint")+"",t;return{c(){t=J(a)},l(n){t=z(n,a)},m(n,s){P(n,t,s)},p:Q,d(n){n&&g(t)}}}function Ce(e){let a=v("nexus.delete-endpoint")+"",t;return{c(){t=J(a)},l(n){t=z(n,a)},m(n,s){P(n,t,s)},p:Q,d(n){n&&g(t)}}}function Ne(e){let a=v("common.save")+"",t;return{c(){t=J(a)},l(n){t=z(n,a)},m(n,s){P(n,t,s)},p:Q,d(n){n&&g(t)}}}function Me(e){let a=v("common.save")+"",t;return{c(){t=J(a)},l(n){t=z(n,a)},m(n,s){P(n,t,s)},p:Q,d(n){n&&g(t)}}}function Ve(e){let a=v("common.cancel")+"",t;return{c(){t=J(a)},l(n){t=z(n,a)},m(n,s){P(n,t,s)},p:Q,d(n){n&&g(t)}}}function Te(e){let a,t=v("nexus.delete-modal-title")+"",n;return{c(){a=k("h3"),n=J(t),this.h()},l(s){a=L(s,"H3",{slot:!0});var o=I(a);n=z(o,t),o.forEach(g),this.h()},h(){D(a,"slot","title")},m(s,o){P(s,a,o),_(a,n)},p:Q,d(s){s&&g(a)}}}function Ue(e){let a,t,n=v("nexus.delete-modal-confirmation",{endpoint:e[0].id})+"",s,o,l,c,p;function h(f){e[12](f)}let $={id:"delete-endpoint",required:!0,label:v("nexus.delete-modal-confirmation-label",{endpoint:e[0].id})};return e[8]!==void 0&&($.value=e[8]),l=new _e({props:$}),ie.push(()=>de(l,"value",h)),{c(){a=k("div"),t=k("p"),s=J(n),o=j(),C(l.$$.fragment),this.h()},l(f){a=L(f,"DIV",{slot:!0,class:!0});var d=I(a);t=L(d,"P",{});var r=I(t);s=z(r,n),r.forEach(g),o=q(d),N(l.$$.fragment,d),d.forEach(g),this.h()},h(){D(a,"slot","content"),D(a,"class","flex flex-col gap-4")},m(f,d){P(f,a,d),_(a,t),_(t,s),_(a,o),M(l,a,null),p=!0},p(f,d){(!p||d&1)&&n!==(n=v("nexus.delete-modal-confirmation",{endpoint:f[0].id})+"")&&re(s,n);const r={};d&1&&(r.label=v("nexus.delete-modal-confirmation-label",{endpoint:f[0].id})),!c&&d&256&&(c=!0,r.value=f[8],fe(()=>c=!1)),l.$set(r)},i(f){p||(V(l.$$.fragment,f),p=!0)},o(f){T(l.$$.fragment,f),p=!1},d(f){f&&g(a),U(l)}}}function Pe(e){let a,t,n,s,o,l,c,p=e[0].spec.name+"",h,$,f,d,r,b,B,w,R,m,S,te,F,Y,E,ne,W;n=new he({props:{href:ee(e[9].params.id),icon:"chevron-left",$$slots:{default:[Ie]},$$scope:{ctx:e}}}),d=new y({props:{variant:"destructive",$$slots:{default:[Ce]},$$scope:{ctx:e}}}),d.$on("click",e[10]),b=new y({props:{loading:e[5],$$slots:{default:[Ne]},$$scope:{ctx:e}}}),b.$on("click",function(){ae(e[2])&&e[2].apply(this,arguments)}),w=new ve({props:{endpoint:e[0],namespaceList:e[1],error:e[4],isCloud:e[6],nameDisabled:!0}}),S=new y({props:{loading:e[5],$$slots:{default:[Me]},$$scope:{ctx:e}}}),S.$on("click",function(){ae(e[2])&&e[2].apply(this,arguments)}),F=new y({props:{variant:"ghost",$$slots:{default:[Ve]},$$scope:{ctx:e}}}),F.$on("click",e[11]);function ce(u){e[13](u)}let se={id:"delete-endpoint-modal",confirmType:"destructive",confirmText:v("common.delete"),cancelText:v("common.cancel"),confirmDisabled:e[8]!==`DELETE ${e[0].id}`,$$slots:{content:[Ue],title:[Te]},$$scope:{ctx:e}};return e[7]!==void 0&&(se.open=e[7]),E=new $e({props:se}),ie.push(()=>de(E,"open",ce)),E.$on("confirmModal",function(){ae(e[3])&&e[3].apply(this,arguments)}),E.$on("cancelModal",e[14]),{c(){a=k("div"),t=k("div"),C(n.$$.fragment),s=j(),o=k("div"),l=k("div"),c=k("h1"),h=J(p),$=j(),f=k("div"),C(d.$$.fragment),r=j(),C(b.$$.fragment),B=j(),C(w.$$.fragment),R=j(),m=k("div"),C(S.$$.fragment),te=j(),C(F.$$.fragment),Y=j(),C(E.$$.fragment),this.h()},l(u){a=L(u,"DIV",{class:!0});var i=I(a);t=L(i,"DIV",{class:!0});var K=I(t);N(n.$$.fragment,K),K.forEach(g),s=q(i),o=L(i,"DIV",{class:!0});var X=I(o);l=L(X,"DIV",{class:!0});var H=I(l);c=L(H,"H1",{"data-testid":!0,class:!0});var O=I(c);h=z(O,p),O.forEach(g),$=q(H),f=L(H,"DIV",{class:!0});var A=I(f);N(d.$$.fragment,A),r=q(A),N(b.$$.fragment,A),A.forEach(g),H.forEach(g),X.forEach(g),B=q(i),N(w.$$.fragment,i),R=q(i),m=L(i,"DIV",{class:!0});var G=I(m);N(S.$$.fragment,G),te=q(G),N(F.$$.fragment,G),G.forEach(g),i.forEach(g),Y=q(u),N(E.$$.fragment,u),this.h()},h(){D(t,"class","relative flex flex-col gap-4 text-sm"),D(c,"data-testid","namespace-selector-title"),D(c,"class","text-2xl"),D(f,"class","flex items-center gap-2"),D(l,"class","flex items-center justify-between"),D(o,"class","flex flex-col gap-1"),D(m,"class","flex items-center gap-4"),D(a,"class","flex flex-col gap-8")},m(u,i){P(u,a,i),_(a,t),M(n,t,null),_(a,s),_(a,o),_(o,l),_(l,c),_(c,h),_(l,$),_(l,f),M(d,f,null),_(f,r),M(b,f,null),_(a,B),M(w,a,null),_(a,R),_(a,m),M(S,m,null),_(m,te),M(F,m,null),P(u,Y,i),M(E,u,i),W=!0},p(u,[i]){e=u;const K={};i&512&&(K.href=ee(e[9].params.id)),i&32768&&(K.$$scope={dirty:i,ctx:e}),n.$set(K),(!W||i&1)&&p!==(p=e[0].spec.name+"")&&re(h,p);const X={};i&32768&&(X.$$scope={dirty:i,ctx:e}),d.$set(X);const H={};i&32&&(H.loading=e[5]),i&32768&&(H.$$scope={dirty:i,ctx:e}),b.$set(H);const O={};i&1&&(O.endpoint=e[0]),i&2&&(O.namespaceList=e[1]),i&16&&(O.error=e[4]),i&64&&(O.isCloud=e[6]),w.$set(O);const A={};i&32&&(A.loading=e[5]),i&32768&&(A.$$scope={dirty:i,ctx:e}),S.$set(A);const G={};i&32768&&(G.$$scope={dirty:i,ctx:e}),F.$set(G);const Z={};i&257&&(Z.confirmDisabled=e[8]!==`DELETE ${e[0].id}`),i&33025&&(Z.$$scope={dirty:i,ctx:e}),!ne&&i&128&&(ne=!0,Z.open=e[7],fe(()=>ne=!1)),E.$set(Z)},i(u){W||(V(n.$$.fragment,u),V(d.$$.fragment,u),V(b.$$.fragment,u),V(w.$$.fragment,u),V(S.$$.fragment,u),V(F.$$.fragment,u),V(E.$$.fragment,u),W=!0)},o(u){T(n.$$.fragment,u),T(d.$$.fragment,u),T(b.$$.fragment,u),T(w.$$.fragment,u),T(S.$$.fragment,u),T(F.$$.fragment,u),T(E.$$.fragment,u),W=!1},d(u){u&&(g(a),g(Y)),U(n),U(d),U(b),U(w),U(S),U(F),U(E,u)}}}function Se(e,a,t){let n;x(e,pe,m=>t(9,n=m));let{endpoint:s}=a,{namespaceList:o=[]}=a,{onUpdate:l}=a,{onDelete:c}=a,{error:p=void 0}=a,{loading:h=!1}=a,{isCloud:$=!1}=a,f=!1,d="";const r=()=>t(7,f=!0),b=()=>oe(ee(n.params.id));function B(m){d=m,t(8,d)}function w(m){f=m,t(7,f)}const R=()=>t(7,f=!1);return e.$$set=m=>{"endpoint"in m&&t(0,s=m.endpoint),"namespaceList"in m&&t(1,o=m.namespaceList),"onUpdate"in m&&t(2,l=m.onUpdate),"onDelete"in m&&t(3,c=m.onDelete),"error"in m&&t(4,p=m.error),"loading"in m&&t(5,h=m.loading),"isCloud"in m&&t(6,$=m.isCloud)},[s,o,l,c,p,h,$,f,d,n,r,b,B,w,R]}class Fe extends ue{constructor(a){super(),me(this,a,Se,Pe,le,{endpoint:0,namespaceList:1,onUpdate:2,onDelete:3,error:4,loading:5,isCloud:6})}}function je(e){let a,t,n,s;return a=new ge({props:{title:`Edit ${v("nexus.nexus-endpoint",{id:e[4].params.id})}`,url:e[4].url.href}}),n=new Fe({props:{endpoint:e[3],loading:e[1],namespaceList:e[2],onUpdate:e[5],onDelete:e[6],error:e[0]}}),{c(){C(a.$$.fragment),t=j(),C(n.$$.fragment)},l(o){N(a.$$.fragment,o),t=q(o),N(n.$$.fragment,o)},m(o,l){M(a,o,l),P(o,t,l),M(n,o,l),s=!0},p(o,[l]){const c={};l&16&&(c.title=`Edit ${v("nexus.nexus-endpoint",{id:o[4].params.id})}`),l&16&&(c.url=o[4].url.href),a.$set(c);const p={};l&8&&(p.endpoint=o[3]),l&2&&(p.loading=o[1]),l&4&&(p.namespaceList=o[2]),l&1&&(p.error=o[0]),n.$set(p)},i(o){s||(V(a.$$.fragment,o),V(n.$$.fragment,o),s=!0)},o(o){T(a.$$.fragment,o),T(n.$$.fragment,o),s=!1},d(o){o&&g(t),U(a,o),U(n,o)}}}function qe(e,a,t){let n,s,o,l,c;x(e,ke,r=>t(8,o=r)),x(e,be,r=>t(9,l=r)),x(e,pe,r=>t(4,c=r));let{data:p}=a,h,$=!1;const f=async()=>{t(0,h=void 0),t(1,$=!0);const r={...l};r.id=n.id,r.version=n.version;const b=await Le(JSON.stringify(r.spec.descriptionString));r.spec.description=b[0],delete r.spec.allowedCallerNamespaces,delete r.spec.descriptionString;try{await De(n.id,r),oe(ee(n.id),{invalidateAll:!0})}catch(B){t(0,h=B),console.error("Error updating endpoint",B)}finally{t(1,$=!1)}},d=async()=>{t(0,h=void 0),t(1,$=!0);try{await we(n.id,n.version),oe(Ee())}catch(r){t(0,h=r),console.error("Error deleting endpoint",r)}finally{t(1,$=!1)}};return e.$$set=r=>{"data"in r&&t(7,p=r.data)},e.$$.update=()=>{e.$$.dirty&128&&t(3,{endpoint:n}=p,n),e.$$.dirty&256&&t(2,s=o.map(r=>({namespace:r.namespaceInfo.name})))},[h,$,s,n,c,f,d,p,o]}class xe extends ue{constructor(a){super(),me(this,a,qe,je,le,{data:7})}}export{xe as component};
