import{s as G,a1 as U,e as B,a as D,t as A,b as j,d as q,g as h,h as F,f as H,j as S,k as I,l as $,c as y,v as O}from"../chunks/scheduler.GSXCNEL-.js";import{S as K,i as M,c as b,a as w,m as k,t as v,b as L,d as N}from"../chunks/index.h9J8o6HM.js";import{g as R}from"../chunks/entry.fGmfOCLy.js";import{p as W}from"../chunks/stores.d9nz1KUq.js";import{P as X}from"../chunks/page-title.mJVmOqZ4.js";import{t as P}from"../chunks/translate.HrioCK44.js";import{B as z}from"../chunks/button.0qtACnnP.js";import{L as Y}from"../chunks/link.WXwytpcE.js";import{N as Z,e as T}from"../chunks/nexus-form.eUCRahV2.js";import{h as Q}from"../chunks/route-for.JoP8UbUX.js";import{c as ee}from"../chunks/nexus-service.p1q8G2ra.js";import{n as te}from"../chunks/namespaces.Z1gi549n.js";import{e as ne}from"../chunks/encode-payload.QlZi4zPV.js";function ae(e){let t=P("nexus.back-to-endpoints")+"",n;return{c(){n=A(t)},l(a){n=H(a,t)},m(a,r){I(a,n,r)},p:O,d(a){a&&h(n)}}}function se(e){let t=P("nexus.create-endpoint")+"",n;return{c(){n=A(t)},l(a){n=H(a,t)},m(a,r){I(a,n,r)},p:O,d(a){a&&h(n)}}}function re(e){let t=P("common.cancel")+"",n;return{c(){n=A(t)},l(a){n=H(a,t)},m(a,r){I(a,n,r)},p:O,d(a){a&&h(n)}}}function oe(e){let t,n,a,r,s,m=P("nexus.create-endpoint")+"",p,f,u,i,o,d,J,g,V;return a=new Y({props:{href:Q(),icon:"chevron-left",$$slots:{default:[ae]},$$scope:{ctx:e}}}),u=new Z({props:{error:e[2],namespaceList:e[1],isCloud:e[4]}}),d=new z({props:{variant:"primary",disabled:e[5],loading:e[3],$$slots:{default:[se]},$$scope:{ctx:e}}}),d.$on("click",function(){U(e[0])&&e[0].apply(this,arguments)}),g=new z({props:{variant:"ghost",$$slots:{default:[re]},$$scope:{ctx:e}}}),g.$on("click",e[7]),{c(){t=B("div"),n=B("div"),b(a.$$.fragment),r=D(),s=B("h1"),p=A(m),f=D(),b(u.$$.fragment),i=D(),o=B("div"),b(d.$$.fragment),J=D(),b(g.$$.fragment),this.h()},l(c){t=j(c,"DIV",{class:!0});var l=q(t);n=j(l,"DIV",{class:!0});var E=q(n);w(a.$$.fragment,E),E.forEach(h),r=F(l),s=j(l,"H1",{"data-testid":!0,class:!0});var C=q(s);p=H(C,m),C.forEach(h),f=F(l),w(u.$$.fragment,l),i=F(l),o=j(l,"DIV",{class:!0});var _=q(o);w(d.$$.fragment,_),J=F(_),w(g.$$.fragment,_),_.forEach(h),l.forEach(h),this.h()},h(){S(n,"class","text-sm"),S(s,"data-testid","namespace-selector-title"),S(s,"class","text-2xl"),S(o,"class","flex items-center gap-4"),S(t,"class","flex w-full flex-col gap-8")},m(c,l){I(c,t,l),$(t,n),k(a,n,null),$(t,r),$(t,s),$(s,p),$(t,f),k(u,t,null),$(t,i),$(t,o),k(d,o,null),$(o,J),k(g,o,null),V=!0},p(c,[l]){e=c;const E={};l&256&&(E.$$scope={dirty:l,ctx:e}),a.$set(E);const C={};l&4&&(C.error=e[2]),l&2&&(C.namespaceList=e[1]),l&16&&(C.isCloud=e[4]),u.$set(C);const _={};l&32&&(_.disabled=e[5]),l&8&&(_.loading=e[3]),l&256&&(_.$$scope={dirty:l,ctx:e}),d.$set(_);const x={};l&256&&(x.$$scope={dirty:l,ctx:e}),g.$set(x)},i(c){V||(v(a.$$.fragment,c),v(u.$$.fragment,c),v(d.$$.fragment,c),v(g.$$.fragment,c),V=!0)},o(c){L(a.$$.fragment,c),L(u.$$.fragment,c),L(d.$$.fragment,c),L(g.$$.fragment,c),V=!1},d(c){c&&h(t),N(a),N(u),N(d),N(g)}}}function ie(e,t,n){let a,r;y(e,T,o=>n(6,r=o));let{onCreate:s}=t,{namespaceList:m=[]}=t,{error:p=void 0}=t,{loading:f=!1}=t,{isCloud:u=!1}=t;const i=()=>R(Q());return e.$$set=o=>{"onCreate"in o&&n(0,s=o.onCreate),"namespaceList"in o&&n(1,m=o.namespaceList),"error"in o&&n(2,p=o.error),"loading"in o&&n(3,f=o.loading),"isCloud"in o&&n(4,u=o.isCloud)},e.$$.update=()=>{e.$$.dirty&64&&n(5,a=r.spec.name===""||r.spec.target.worker.namespace===""||r.spec.target.worker.taskQueue==="")},[s,m,p,f,u,a,r,i]}class le extends K{constructor(t){super(),M(this,t,ie,oe,G,{onCreate:0,namespaceList:1,error:2,loading:3,isCloud:4})}}function me(e){let t,n,a,r;return t=new X({props:{title:P("nexus.create-endpoint"),url:e[3].url.href}}),a=new le({props:{onCreate:e[4],namespaceList:e[2],error:e[0],loading:e[1]}}),{c(){b(t.$$.fragment),n=D(),b(a.$$.fragment)},l(s){w(t.$$.fragment,s),n=F(s),w(a.$$.fragment,s)},m(s,m){k(t,s,m),I(s,n,m),k(a,s,m),r=!0},p(s,[m]){const p={};m&8&&(p.url=s[3].url.href),t.$set(p);const f={};m&4&&(f.namespaceList=s[2]),m&1&&(f.error=s[0]),m&2&&(f.loading=s[1]),a.$set(f)},i(s){r||(v(t.$$.fragment,s),v(a.$$.fragment,s),r=!0)},o(s){L(t.$$.fragment,s),L(a.$$.fragment,s),r=!1},d(s){s&&h(n),N(t,s),N(a,s)}}}function ce(e,t,n){let a,r,s,m;y(e,te,i=>n(5,r=i)),y(e,T,i=>n(6,s=i)),y(e,W,i=>n(3,m=i));let p,f=!1;const u=async()=>{n(1,f=!0);try{const i={...s},o=await ne(JSON.stringify(i.spec.descriptionString));i.spec.description=o[0],delete i.spec.allowedCallerNamespaces,delete i.spec.descriptionString,await ee(i),R(Q(),{invalidateAll:!0})}catch(i){n(0,p=i),console.error("Error creating endpoint",i)}finally{n(1,f=!1)}};return e.$$.update=()=>{e.$$.dirty&32&&n(2,a=r.map(i=>({namespace:i.namespaceInfo.name})))},[p,f,a,m,u,r]}class Le extends K{constructor(t){super(),M(this,t,ce,me,G,{})}}export{Le as component};
